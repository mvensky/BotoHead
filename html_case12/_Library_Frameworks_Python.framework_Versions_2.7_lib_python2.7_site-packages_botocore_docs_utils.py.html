source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/docs/utils.py</b><br>


file stats: <b>109 lines, 46 executed: 42.2% covered</b>
<pre>
<font color="black">   1. # Copyright 2015 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. import re</font>
<font color="green">  14. from collections import namedtuple</font>
<font color="black">  15. </font>
<font color="black">  16. </font>
<font color="green">  17. def py_type_name(type_name):</font>
<font color="black">  18.     &quot;&quot;&quot;Get the Python type name for a given model type.</font>
<font color="black">  19. </font>
<font color="black">  20.         &gt;&gt;&gt; py_type_name('list')</font>
<font color="black">  21.         'list'</font>
<font color="black">  22.         &gt;&gt;&gt; py_type_name('structure')</font>
<font color="black">  23.         'dict'</font>
<font color="black">  24. </font>
<font color="black">  25.     :rtype: string</font>
<font color="black">  26.     &quot;&quot;&quot;</font>
<font color="red">  27.     return {</font>
<font color="red">  28.         'blob': 'bytes',</font>
<font color="red">  29.         'character': 'string',</font>
<font color="red">  30.         'double': 'float',</font>
<font color="red">  31.         'long': 'integer',</font>
<font color="red">  32.         'map': 'dict',</font>
<font color="red">  33.         'structure': 'dict',</font>
<font color="red">  34.         'timestamp': 'datetime',</font>
<font color="red">  35.     }.get(type_name, type_name)</font>
<font color="black">  36. </font>
<font color="black">  37. </font>
<font color="green">  38. def py_default(type_name):</font>
<font color="black">  39.     &quot;&quot;&quot;Get the Python default value for a given model type.</font>
<font color="black">  40. </font>
<font color="black">  41.         &gt;&gt;&gt; py_default('string')</font>
<font color="black">  42.         '\'string\''</font>
<font color="black">  43.         &gt;&gt;&gt; py_default('list')</font>
<font color="black">  44.         '[...]'</font>
<font color="black">  45.         &gt;&gt;&gt; py_default('unknown')</font>
<font color="black">  46.         '...'</font>
<font color="black">  47. </font>
<font color="black">  48.     :rtype: string</font>
<font color="black">  49.     &quot;&quot;&quot;</font>
<font color="red">  50.     return {</font>
<font color="red">  51.         'double': '123.0',</font>
<font color="red">  52.         'long': '123',</font>
<font color="red">  53.         'integer': '123',</font>
<font color="red">  54.         'string': &quot;'string'&quot;,</font>
<font color="red">  55.         'blob': &quot;b'bytes'&quot;,</font>
<font color="red">  56.         'boolean': 'True|False',</font>
<font color="red">  57.         'list': '[...]',</font>
<font color="red">  58.         'map': '{...}',</font>
<font color="red">  59.         'structure': '{...}',</font>
<font color="red">  60.         'timestamp': 'datetime(2015, 1, 1)',</font>
<font color="red">  61.     }.get(type_name, '...')</font>
<font color="black">  62. </font>
<font color="black">  63. </font>
<font color="green">  64. def get_official_service_name(service_model):</font>
<font color="black">  65.     &quot;&quot;&quot;Generate the official name of an AWS Service</font>
<font color="black">  66. </font>
<font color="black">  67.     :param service_model: The service model representing the service</font>
<font color="black">  68.     &quot;&quot;&quot;</font>
<font color="red">  69.     official_name = service_model.metadata.get('serviceFullName')</font>
<font color="red">  70.     short_name = service_model.metadata.get('serviceAbbreviation', '')</font>
<font color="red">  71.     if short_name.startswith('Amazon'):</font>
<font color="red">  72.         short_name = short_name[7:]</font>
<font color="red">  73.     if short_name.startswith('AWS'):</font>
<font color="red">  74.         short_name = short_name[4:]</font>
<font color="red">  75.     if short_name and short_name.lower() not in official_name.lower():</font>
<font color="red">  76.         official_name += ' ({0})'.format(short_name)</font>
<font color="red">  77.     return official_name</font>
<font color="black">  78. </font>
<font color="black">  79. </font>
<font color="green">  80. _DocumentedShape = namedtuple(</font>
<font color="green">  81.     'DocumentedShape', ['name', 'type_name', 'documentation', 'metadata',</font>
<font color="green">  82.                         'members', 'required_members'])</font>
<font color="black">  83. </font>
<font color="black">  84. </font>
<font color="green">  85. class DocumentedShape (_DocumentedShape):</font>
<font color="green">  86.     &quot;&quot;&quot;Use this class to inject new shapes into a model for documentation&quot;&quot;&quot;</font>
<font color="green">  87.     def __new__(cls, name, type_name, documentation, metadata=None,</font>
<font color="green">  88.                 members=None, required_members=None):</font>
<font color="red">  89.         if metadata is None:</font>
<font color="red">  90.             metadata = []</font>
<font color="red">  91.         if members is None:</font>
<font color="red">  92.             members = []</font>
<font color="red">  93.         if required_members is None:</font>
<font color="red">  94.             required_members = []</font>
<font color="red">  95.         return super(DocumentedShape, cls).__new__(</font>
<font color="red">  96.             cls, name, type_name, documentation, metadata, members,</font>
<font color="red">  97.             required_members)</font>
<font color="black">  98. </font>
<font color="black">  99. </font>
<font color="green"> 100. class AutoPopulatedParam(object):</font>
<font color="green"> 101.     def __init__(self, name, param_description=None):</font>
<font color="green"> 102.         self.name = name</font>
<font color="green"> 103.         self.param_description = param_description</font>
<font color="green"> 104.         if param_description is None:</font>
<font color="black"> 105.             self.param_description = (</font>
<font color="green"> 106.                 'Please note that this parameter is automatically populated '</font>
<font color="black"> 107.                 'if it is not provided. Including this parameter is not '</font>
<font color="black"> 108.                 'required\n')</font>
<font color="black"> 109. </font>
<font color="green"> 110.     def document_auto_populated_param(self, event_name, section, **kwargs):</font>
<font color="black"> 111.         &quot;&quot;&quot;Documents auto populated parameters</font>
<font color="black"> 112. </font>
<font color="black"> 113.         It will remove any required marks for the parameter, remove the</font>
<font color="black"> 114.         parameter from the example, and add a snippet about the parameter</font>
<font color="black"> 115.         being autopopulated in the description.</font>
<font color="black"> 116.         &quot;&quot;&quot;</font>
<font color="red"> 117.         if event_name.startswith('docs.request-params'):</font>
<font color="red"> 118.             if self.name in section.available_sections:</font>
<font color="red"> 119.                 section = section.get_section(self.name)</font>
<font color="red"> 120.                 if 'is-required' in section.available_sections:</font>
<font color="red"> 121.                     section.delete_section('is-required')</font>
<font color="red"> 122.                 description_section = section.get_section(</font>
<font color="red"> 123.                     'param-documentation')</font>
<font color="red"> 124.                 description_section.writeln(self.param_description)</font>
<font color="red"> 125.         elif event_name.startswith('docs.request-example'):</font>
<font color="red"> 126.             section = section.get_section('structure-value')</font>
<font color="red"> 127.             if self.name in section.available_sections:</font>
<font color="red"> 128.                 section.delete_section(self.name)</font>
<font color="black"> 129. </font>
<font color="black"> 130. </font>
<font color="green"> 131. class HideParamFromOperations(object):</font>
<font color="black"> 132.     &quot;&quot;&quot;Hides a single parameter from multiple operations.</font>
<font color="black"> 133. </font>
<font color="black"> 134.     This method will remove a parameter from documentation and from</font>
<font color="black"> 135.     examples. This method is typically used for things that are</font>
<font color="black"> 136.     automatically populated because a user would be unable to provide</font>
<font color="green"> 137.     a value (e.g., a checksum of a serialized XML request body).&quot;&quot;&quot;</font>
<font color="green"> 138.     def __init__(self, service_name, parameter_name, operation_names):</font>
<font color="black"> 139.         &quot;&quot;&quot;</font>
<font color="black"> 140.         :type service_name: str</font>
<font color="black"> 141.         :param service_name: Name of the service to modify.</font>
<font color="black"> 142. </font>
<font color="black"> 143.         :type parameter_name: str</font>
<font color="black"> 144.         :param parameter_name: Name of the parameter to modify.</font>
<font color="black"> 145. </font>
<font color="black"> 146.         :type operation_names: list</font>
<font color="black"> 147.         :param operation_names: Operation names to modify.</font>
<font color="black"> 148.         &quot;&quot;&quot;</font>
<font color="green"> 149.         self._parameter_name = parameter_name</font>
<font color="green"> 150.         self._params_events = set()</font>
<font color="green"> 151.         self._example_events = set()</font>
<font color="black"> 152.         # Build up the sets of relevant event names.</font>
<font color="green"> 153.         param_template = 'docs.request-params.%s.%s.complete-section'</font>
<font color="green"> 154.         example_template = 'docs.request-example.%s.%s.complete-section'</font>
<font color="green"> 155.         for name in operation_names:</font>
<font color="green"> 156.             self._params_events.add(param_template % (service_name, name))</font>
<font color="green"> 157.             self._example_events.add(example_template % (service_name, name))</font>
<font color="black"> 158. </font>
<font color="green"> 159.     def hide_param(self, event_name, section, **kwargs):</font>
<font color="red"> 160.         if event_name in self._example_events:</font>
<font color="black"> 161.             # Modify the structure value for example events.</font>
<font color="red"> 162.             section = section.get_section('structure-value')</font>
<font color="red"> 163.         elif event_name not in self._params_events:</font>
<font color="red"> 164.             return</font>
<font color="red"> 165.         if self._parameter_name in section.available_sections:</font>
<font color="red"> 166.             section.delete_section(self._parameter_name)</font>
<font color="black"> 167. </font>
<font color="black"> 168. </font>
<font color="green"> 169. class AppendParamDocumentation(object):</font>
<font color="green"> 170.     &quot;&quot;&quot;Appends documentation to a specific parameter&quot;&quot;&quot;</font>
<font color="green"> 171.     def __init__(self, parameter_name, doc_string):</font>
<font color="green"> 172.         self._parameter_name = parameter_name</font>
<font color="green"> 173.         self._doc_string = doc_string</font>
<font color="black"> 174. </font>
<font color="green"> 175.     def append_documentation(self, event_name, section, **kwargs):</font>
<font color="red"> 176.         if self._parameter_name in section.available_sections:</font>
<font color="red"> 177.             section = section.get_section(self._parameter_name)</font>
<font color="red"> 178.             description_section = section.get_section(</font>
<font color="red"> 179.                 'param-documentation')</font>
<font color="red"> 180.             description_section.writeln(self._doc_string)</font>
<font color="black"> 181. </font>
<font color="black"> 182. </font>
<font color="green"> 183. _CONTROLS = {</font>
<font color="green"> 184.     '\n': '\\n',</font>
<font color="green"> 185.     '\r': '\\r',</font>
<font color="green"> 186.     '\t': '\\t',</font>
<font color="green"> 187.     '\b': '\\b',</font>
<font color="green"> 188.     '\f': '\\f',</font>
<font color="black"> 189. }</font>
<font color="black"> 190. # Combines all CONTROLS keys into a big or regular expression</font>
<font color="green"> 191. _ESCAPE_CONTROLS_RE = re.compile('|'.join(map(re.escape, _CONTROLS)))</font>
<font color="black"> 192. # Based on the match get the appropriate replacement from CONTROLS</font>
<font color="green"> 193. _CONTROLS_MATCH_HANDLER = lambda match: _CONTROLS[match.group(0)]</font>
<font color="black"> 194. </font>
<font color="black"> 195. </font>
<font color="green"> 196. def escape_controls(value):</font>
<font color="red"> 197.     return _ESCAPE_CONTROLS_RE.sub(_CONTROLS_MATCH_HANDLER, value)</font>
</pre>

