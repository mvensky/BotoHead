source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pyasn1/debug.py</b><br>


file stats: <b>84 lines, 36 executed: 42.9% covered</b>
<pre>
<font color="black">   1. #</font>
<font color="black">   2. # This file is part of pyasn1 software.</font>
<font color="black">   3. #</font>
<font color="black">   4. # Copyright (c) 2005-2017, Ilya Etingof &lt;etingof@gmail.com&gt;</font>
<font color="black">   5. # License: http://pyasn1.sf.net/license.html</font>
<font color="black">   6. #</font>
<font color="green">   7. import logging</font>
<font color="green">   8. from pyasn1.compat.octets import octs2ints</font>
<font color="green">   9. from pyasn1 import error</font>
<font color="green">  10. from pyasn1 import __version__</font>
<font color="black">  11. </font>
<font color="green">  12. __all__ = ['Debug', 'setLogger', 'hexdump']</font>
<font color="black">  13. </font>
<font color="green">  14. flagNone = 0x0000</font>
<font color="green">  15. flagEncoder = 0x0001</font>
<font color="green">  16. flagDecoder = 0x0002</font>
<font color="green">  17. flagAll = 0xffff</font>
<font color="black">  18. </font>
<font color="green">  19. flagMap = {</font>
<font color="green">  20.     'encoder': flagEncoder,</font>
<font color="green">  21.     'decoder': flagDecoder,</font>
<font color="green">  22.     'all': flagAll</font>
<font color="black">  23. }</font>
<font color="black">  24. </font>
<font color="black">  25. </font>
<font color="green">  26. class Printer(object):</font>
<font color="black">  27.     # noinspection PyShadowingNames</font>
<font color="green">  28.     def __init__(self, logger=None, handler=None, formatter=None):</font>
<font color="red">  29.         if logger is None:</font>
<font color="red">  30.             logger = logging.getLogger('pyasn1')</font>
<font color="red">  31.         logger.setLevel(logging.DEBUG)</font>
<font color="red">  32.         if handler is None:</font>
<font color="red">  33.             handler = logging.StreamHandler()</font>
<font color="red">  34.         if formatter is None:</font>
<font color="red">  35.             formatter = logging.Formatter('%(asctime)s %(name)s: %(message)s')</font>
<font color="red">  36.         handler.setFormatter(formatter)</font>
<font color="red">  37.         handler.setLevel(logging.DEBUG)</font>
<font color="red">  38.         logger.addHandler(handler)</font>
<font color="red">  39.         self.__logger = logger</font>
<font color="black">  40. </font>
<font color="green">  41.     def __call__(self, msg):</font>
<font color="red">  42.         self.__logger.debug(msg)</font>
<font color="black">  43. </font>
<font color="green">  44.     def __str__(self):</font>
<font color="red">  45.         return '&lt;python built-in logging&gt;'</font>
<font color="black">  46. </font>
<font color="black">  47. </font>
<font color="green">  48. if hasattr(logging, 'NullHandler'):</font>
<font color="green">  49.     NullHandler = logging.NullHandler</font>
<font color="black">  50. else:</font>
<font color="black">  51.     # Python 2.6 and older</font>
<font color="red">  52.     class NullHandler(logging.Handler):</font>
<font color="red">  53.         def emit(self, record):</font>
<font color="red">  54.             pass</font>
<font color="black">  55. </font>
<font color="black">  56. </font>
<font color="green">  57. class Debug(object):</font>
<font color="green">  58.     defaultPrinter = None</font>
<font color="black">  59. </font>
<font color="green">  60.     def __init__(self, *flags, **options):</font>
<font color="red">  61.         self._flags = flagNone</font>
<font color="red">  62.         if options.get('printer') is not None:</font>
<font color="red">  63.             self._printer = options.get('printer')</font>
<font color="red">  64.         elif self.defaultPrinter is not None:</font>
<font color="red">  65.             self._printer = self.defaultPrinter</font>
<font color="red">  66.         if 'loggerName' in options:</font>
<font color="black">  67.             # route our logs to parent logger</font>
<font color="red">  68.             self._printer = Printer(</font>
<font color="red">  69.                 logger=logging.getLogger(options['loggerName']),</font>
<font color="red">  70.                 handler=NullHandler()</font>
<font color="black">  71.             )</font>
<font color="black">  72.         else:</font>
<font color="red">  73.             self._printer = Printer()</font>
<font color="red">  74.         self('running pyasn1 version %s' % __version__)</font>
<font color="red">  75.         for f in flags:</font>
<font color="red">  76.             inverse = f and f[0] in ('!', '~')</font>
<font color="red">  77.             if inverse:</font>
<font color="red">  78.                 f = f[1:]</font>
<font color="red">  79.             try:</font>
<font color="red">  80.                 if inverse:</font>
<font color="red">  81.                     self._flags &amp;= ~flagMap[f]</font>
<font color="black">  82.                 else:</font>
<font color="red">  83.                     self._flags |= flagMap[f]</font>
<font color="red">  84.             except KeyError:</font>
<font color="red">  85.                 raise error.PyAsn1Error('bad debug flag %s' % f)</font>
<font color="black">  86. </font>
<font color="red">  87.             self('debug category \'%s\' %s' % (f, inverse and 'disabled' or 'enabled'))</font>
<font color="black">  88. </font>
<font color="green">  89.     def __str__(self):</font>
<font color="red">  90.         return 'logger %s, flags %x' % (self._printer, self._flags)</font>
<font color="black">  91. </font>
<font color="green">  92.     def __call__(self, msg):</font>
<font color="red">  93.         self._printer(msg)</font>
<font color="black">  94. </font>
<font color="green">  95.     def __and__(self, flag):</font>
<font color="red">  96.         return self._flags &amp; flag</font>
<font color="black">  97. </font>
<font color="green">  98.     def __rand__(self, flag):</font>
<font color="red">  99.         return flag &amp; self._flags</font>
<font color="black"> 100. </font>
<font color="black"> 101. </font>
<font color="green"> 102. logger = 0</font>
<font color="black"> 103. </font>
<font color="black"> 104. </font>
<font color="green"> 105. def setLogger(l):</font>
<font color="black"> 106.     global logger</font>
<font color="red"> 107.     logger = l</font>
<font color="black"> 108. </font>
<font color="black"> 109. </font>
<font color="green"> 110. def hexdump(octets):</font>
<font color="red"> 111.     return ' '.join(</font>
<font color="red"> 112.         ['%s%.2X' % (n % 16 == 0 and ('\n%.5d: ' % n) or '', x)</font>
<font color="red"> 113.          for n, x in zip(range(len(octets)), octs2ints(octets))]</font>
<font color="black"> 114.     )</font>
<font color="black"> 115. </font>
<font color="black"> 116. </font>
<font color="green"> 117. class Scope(object):</font>
<font color="green"> 118.     def __init__(self):</font>
<font color="green"> 119.         self._list = []</font>
<font color="black"> 120. </font>
<font color="green"> 121.     def __str__(self): return '.'.join(self._list)</font>
<font color="black"> 122. </font>
<font color="green"> 123.     def push(self, token):</font>
<font color="red"> 124.         self._list.append(token)</font>
<font color="black"> 125. </font>
<font color="green"> 126.     def pop(self):</font>
<font color="red"> 127.         return self._list.pop()</font>
<font color="black"> 128. </font>
<font color="black"> 129. </font>
<font color="green"> 130. scope = Scope()</font>
</pre>

