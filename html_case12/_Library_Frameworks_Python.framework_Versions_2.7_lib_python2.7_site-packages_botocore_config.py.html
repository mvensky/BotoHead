source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/config.py</b><br>


file stats: <b>67 lines, 43 executed: 64.2% covered</b>
<pre>
<font color="black">   1. # Copyright 2016 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. import copy</font>
<font color="green">  14. from botocore.compat import OrderedDict</font>
<font color="black">  15. </font>
<font color="green">  16. from botocore.endpoint import DEFAULT_TIMEOUT, MAX_POOL_CONNECTIONS</font>
<font color="green">  17. from botocore.exceptions import InvalidS3AddressingStyleError</font>
<font color="green">  18. from botocore.exceptions import InvalidRetryConfigurationError</font>
<font color="green">  19. from botocore.exceptions import InvalidMaxRetryAttemptsError</font>
<font color="black">  20. </font>
<font color="black">  21. </font>
<font color="green">  22. class Config(object):</font>
<font color="black">  23.     &quot;&quot;&quot;Advanced configuration for Botocore clients.</font>
<font color="black">  24. </font>
<font color="black">  25.     :type region_name: str</font>
<font color="black">  26.     :param region_name: The region to use in instantiating the client</font>
<font color="black">  27. </font>
<font color="black">  28.     :type signature_version: str</font>
<font color="black">  29.     :param signature_version: The signature version when signing requests.</font>
<font color="black">  30. </font>
<font color="black">  31.     :type user_agent: str</font>
<font color="black">  32.     :param user_agent: The value to use in the User-Agent header.</font>
<font color="black">  33. </font>
<font color="black">  34.     :type user_agent_extra: str</font>
<font color="black">  35.     :param user_agent_extra: The value to append to the current User-Agent</font>
<font color="black">  36.         header value.</font>
<font color="black">  37. </font>
<font color="black">  38.     :type connect_timeout: int</font>
<font color="black">  39.     :param connect_timeout: The time in seconds till a timeout exception is</font>
<font color="black">  40.         thrown when attempting to make a connection. The default is 60</font>
<font color="black">  41.         seconds.</font>
<font color="black">  42. </font>
<font color="black">  43.     :type read_timeout: int</font>
<font color="black">  44.     :param read_timeout: The time in seconds till a timeout exception is</font>
<font color="black">  45.         thrown when attempting to read from a connection. The default is</font>
<font color="black">  46.         60 seconds.</font>
<font color="black">  47. </font>
<font color="black">  48.     :type parameter_validation: bool</font>
<font color="black">  49.     :param parameter_validation: Whether parameter validation should occur</font>
<font color="black">  50.         when serializing requests. The default is True.  You can disable</font>
<font color="black">  51.         parameter validation for performance reasons.  Otherwise, it's</font>
<font color="black">  52.         recommended to leave parameter validation enabled.</font>
<font color="black">  53. </font>
<font color="black">  54.     :type max_pool_connections: int</font>
<font color="black">  55.     :param max_pool_connections: The maximum number of connections to</font>
<font color="black">  56.         keep in a connection pool.  If this value is not set, the default</font>
<font color="black">  57.         value of 10 is used.</font>
<font color="black">  58. </font>
<font color="black">  59.     :type proxies: dict</font>
<font color="black">  60.     :param proxies: A dictionary of proxy servers to use by protocol or</font>
<font color="black">  61.         endpoint, e.g.:</font>
<font color="black">  62.         {'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}.</font>
<font color="black">  63.         The proxies are used on each request.</font>
<font color="black">  64. </font>
<font color="black">  65.     :type s3: dict</font>
<font color="black">  66.     :param s3: A dictionary of s3 specific configurations.</font>
<font color="black">  67.         Valid keys are:</font>
<font color="black">  68. </font>
<font color="black">  69.         * 'use_accelerate_endpoint' -- Refers to whether to use the S3</font>
<font color="black">  70.           Accelerate endpoint. The value must be a boolean. If True, the</font>
<font color="black">  71.           client will use the S3 Accelerate endpoint. If the S3 Accelerate</font>
<font color="black">  72.           endpoint is being used then the addressing style will always</font>
<font color="black">  73.           be virtual.</font>
<font color="black">  74. </font>
<font color="black">  75.         * 'payload_signing_enabled' -- Refers to whether or not to SHA256</font>
<font color="black">  76.           sign sigv4 payloads. By default, this is disabled for streaming</font>
<font color="black">  77.           uploads (UploadPart and PutObject).</font>
<font color="black">  78. </font>
<font color="black">  79.         * 'addressing_style' -- Refers to the style in which to address</font>
<font color="black">  80.           s3 endpoints. Values must be a string that equals:</font>
<font color="black">  81. </font>
<font color="black">  82.           * auto -- Addressing style is chosen for user. Depending</font>
<font color="black">  83.             on the configuration of client, the endpoint may be addressed in</font>
<font color="black">  84.             the virtual or the path style. Note that this is the default</font>
<font color="black">  85.             behavior if no style is specified.</font>
<font color="black">  86. </font>
<font color="black">  87.           * virtual -- Addressing style is always virtual. The name of the</font>
<font color="black">  88.             bucket must be DNS compatible or an exception will be thrown.</font>
<font color="black">  89.             Endpoints will be addressed as such: mybucket.s3.amazonaws.com</font>
<font color="black">  90. </font>
<font color="black">  91.           * path -- Addressing style is always by path. Endpoints will be</font>
<font color="black">  92.             addressed as such: s3.amazonaws.com/mybucket</font>
<font color="black">  93. </font>
<font color="black">  94.     :type retries: dict</font>
<font color="black">  95.     :param retries: A dictionary for retry specific configurations.</font>
<font color="black">  96.         Valid keys are:</font>
<font color="black">  97. </font>
<font color="black">  98.         * 'max_attempts' -- An integer representing the maximum number of</font>
<font color="black">  99.           retry attempts that will be made on a single request. For</font>
<font color="black"> 100.           example, setting this value to 2 will result in the request</font>
<font color="black"> 101.           being retried at most two times after the initial request. Setting</font>
<font color="black"> 102.           this value to 0 will result in no retries ever being attempted on</font>
<font color="black"> 103.           the initial request. If not provided, the number of retries will</font>
<font color="black"> 104.           default to whatever is modeled, which is typically four retries.</font>
<font color="green"> 105.     &quot;&quot;&quot;</font>
<font color="green"> 106.     OPTION_DEFAULTS = OrderedDict([</font>
<font color="green"> 107.         ('region_name', None),</font>
<font color="green"> 108.         ('signature_version', None),</font>
<font color="green"> 109.         ('user_agent', None),</font>
<font color="green"> 110.         ('user_agent_extra', None),</font>
<font color="green"> 111.         ('connect_timeout', DEFAULT_TIMEOUT),</font>
<font color="green"> 112.         ('read_timeout', DEFAULT_TIMEOUT),</font>
<font color="green"> 113.         ('parameter_validation', True),</font>
<font color="green"> 114.         ('max_pool_connections', MAX_POOL_CONNECTIONS),</font>
<font color="green"> 115.         ('proxies', None),</font>
<font color="green"> 116.         ('s3', None),</font>
<font color="green"> 117.         ('retries', None)</font>
<font color="black"> 118.     ])</font>
<font color="black"> 119. </font>
<font color="green"> 120.     def __init__(self, *args, **kwargs):</font>
<font color="green"> 121.         self._user_provided_options = self._record_user_provided_options(</font>
<font color="green"> 122.             args, kwargs)</font>
<font color="black"> 123. </font>
<font color="black"> 124.         # Merge the user_provided options onto the default options</font>
<font color="green"> 125.         config_vars = copy.copy(self.OPTION_DEFAULTS)</font>
<font color="green"> 126.         config_vars.update(self._user_provided_options)</font>
<font color="black"> 127. </font>
<font color="black"> 128.         # Set the attributes based on the config_vars</font>
<font color="green"> 129.         for key, value in config_vars.items():</font>
<font color="green"> 130.             setattr(self, key, value)</font>
<font color="black"> 131. </font>
<font color="black"> 132.         # Validate the s3 options</font>
<font color="green"> 133.         self._validate_s3_configuration(self.s3)</font>
<font color="black"> 134. </font>
<font color="green"> 135.         self._validate_retry_configuration(self.retries)</font>
<font color="black"> 136. </font>
<font color="green"> 137.     def _record_user_provided_options(self, args, kwargs):</font>
<font color="green"> 138.         option_order = list(self.OPTION_DEFAULTS)</font>
<font color="green"> 139.         user_provided_options = {}</font>
<font color="black"> 140. </font>
<font color="black"> 141.         # Iterate through the kwargs passed through to the constructor and</font>
<font color="black"> 142.         # map valid keys to the dictionary</font>
<font color="green"> 143.         for key, value in kwargs.items():</font>
<font color="green"> 144.             if key in self.OPTION_DEFAULTS:</font>
<font color="green"> 145.                 user_provided_options[key] = value</font>
<font color="black"> 146.             # The key must exist in the available options</font>
<font color="black"> 147.             else:</font>
<font color="red"> 148.                 raise TypeError(</font>
<font color="red"> 149.                     'Got unexpected keyword argument \'%s\'' % key)</font>
<font color="black"> 150. </font>
<font color="black"> 151.         # The number of args should not be longer than the allowed</font>
<font color="black"> 152.         # options</font>
<font color="green"> 153.         if len(args) &gt; len(option_order):</font>
<font color="red"> 154.             raise TypeError(</font>
<font color="red"> 155.                 'Takes at most %s arguments (%s given)' % (</font>
<font color="red"> 156.                     len(option_order), len(args)))</font>
<font color="black"> 157. </font>
<font color="black"> 158.         # Iterate through the args passed through to the constructor and map</font>
<font color="black"> 159.         # them to appropriate keys.</font>
<font color="green"> 160.         for i, arg in enumerate(args):</font>
<font color="black"> 161.             # If it a kwarg was specified for the arg, then error out</font>
<font color="red"> 162.             if option_order[i] in user_provided_options:</font>
<font color="red"> 163.                 raise TypeError(</font>
<font color="red"> 164.                     'Got multiple values for keyword argument \'%s\'' % (</font>
<font color="red"> 165.                         option_order[i]))</font>
<font color="red"> 166.             user_provided_options[option_order[i]] = arg</font>
<font color="black"> 167. </font>
<font color="green"> 168.         return user_provided_options</font>
<font color="black"> 169. </font>
<font color="green"> 170.     def _validate_s3_configuration(self, s3):</font>
<font color="green"> 171.         if s3 is not None:</font>
<font color="red"> 172.             addressing_style = s3.get('addressing_style')</font>
<font color="red"> 173.             if addressing_style not in ['virtual', 'auto', 'path', None]:</font>
<font color="red"> 174.                 raise InvalidS3AddressingStyleError(</font>
<font color="red"> 175.                     s3_addressing_style=addressing_style)</font>
<font color="black"> 176. </font>
<font color="green"> 177.     def _validate_retry_configuration(self, retries):</font>
<font color="green"> 178.         if retries is not None:</font>
<font color="red"> 179.             for key in retries:</font>
<font color="red"> 180.                 if key not in ['max_attempts']:</font>
<font color="red"> 181.                     raise InvalidRetryConfigurationError(</font>
<font color="red"> 182.                         retry_config_option=key)</font>
<font color="red"> 183.                 if key == 'max_attempts' and retries[key] &lt; 0:</font>
<font color="red"> 184.                     raise InvalidMaxRetryAttemptsError(</font>
<font color="red"> 185.                         provided_max_attempts=retries[key]</font>
<font color="black"> 186.                     )</font>
<font color="black"> 187. </font>
<font color="green"> 188.     def merge(self, other_config):</font>
<font color="black"> 189.         &quot;&quot;&quot;Merges the config object with another config object</font>
<font color="black"> 190. </font>
<font color="black"> 191.         This will merge in all non-default values from the provided config</font>
<font color="black"> 192.         and return a new config object</font>
<font color="black"> 193. </font>
<font color="black"> 194.         :type other_config: botocore.config.Config</font>
<font color="black"> 195.         :param other config: Another config object to merge with. The values</font>
<font color="black"> 196.             in the provided config object will take precedence in the merging</font>
<font color="black"> 197. </font>
<font color="black"> 198.         :returns: A config object built from the merged values of both</font>
<font color="black"> 199.             config objects.</font>
<font color="black"> 200.         &quot;&quot;&quot;</font>
<font color="black"> 201.         # Make a copy of the current attributes in the config object.</font>
<font color="red"> 202.         config_options = copy.copy(self._user_provided_options)</font>
<font color="black"> 203. </font>
<font color="black"> 204.         # Merge in the user provided options from the other config</font>
<font color="red"> 205.         config_options.update(other_config._user_provided_options)</font>
<font color="black"> 206. </font>
<font color="black"> 207.         # Return a new config object with the merged properties.</font>
<font color="red"> 208.         return Config(**config_options)</font>
</pre>

