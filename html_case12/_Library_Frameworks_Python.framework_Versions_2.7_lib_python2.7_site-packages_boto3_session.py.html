source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/boto3/session.py</b><br>


file stats: <b>153 lines, 96 executed: 62.7% covered</b>
<pre>
<font color="black">   1. # Copyright 2014 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="black">  13. </font>
<font color="green">  14. import copy</font>
<font color="green">  15. import os</font>
<font color="black">  16. </font>
<font color="green">  17. import botocore.session</font>
<font color="green">  18. from botocore.client import Config</font>
<font color="green">  19. from botocore.exceptions import DataNotFoundError, UnknownServiceError</font>
<font color="black">  20. </font>
<font color="green">  21. import boto3</font>
<font color="green">  22. import boto3.utils</font>
<font color="green">  23. from boto3.exceptions import ResourceNotExistsError, UnknownAPIVersionError</font>
<font color="black">  24. </font>
<font color="green">  25. from .resources.factory import ResourceFactory</font>
<font color="black">  26. </font>
<font color="black">  27. </font>
<font color="green">  28. class Session(object):</font>
<font color="black">  29.     &quot;&quot;&quot;</font>
<font color="black">  30.     A session stores configuration state and allows you to create service</font>
<font color="black">  31.     clients and resources.</font>
<font color="black">  32. </font>
<font color="black">  33.     :type aws_access_key_id: string</font>
<font color="black">  34.     :param aws_access_key_id: AWS access key ID</font>
<font color="black">  35.     :type aws_secret_access_key: string</font>
<font color="black">  36.     :param aws_secret_access_key: AWS secret access key</font>
<font color="black">  37.     :type aws_session_token: string</font>
<font color="black">  38.     :param aws_session_token: AWS temporary session token</font>
<font color="black">  39.     :type region_name: string</font>
<font color="black">  40.     :param region_name: Default region when creating new connections</font>
<font color="black">  41.     :type botocore_session: botocore.session.Session</font>
<font color="black">  42.     :param botocore_session: Use this Botocore session instead of creating</font>
<font color="black">  43.                              a new default one.</font>
<font color="black">  44.     :type profile_name: string</font>
<font color="black">  45.     :param profile_name: The name of a profile to use. If not given, then</font>
<font color="black">  46.                          the default profile is used.</font>
<font color="green">  47.     &quot;&quot;&quot;</font>
<font color="green">  48.     def __init__(self, aws_access_key_id=None, aws_secret_access_key=None,</font>
<font color="green">  49.                  aws_session_token=None, region_name=None,</font>
<font color="green">  50.                  botocore_session=None, profile_name=None):</font>
<font color="green">  51.         if botocore_session is not None:</font>
<font color="red">  52.             self._session = botocore_session</font>
<font color="black">  53.         else:</font>
<font color="black">  54.             # Create a new default session</font>
<font color="green">  55.             self._session = botocore.session.get_session()</font>
<font color="black">  56. </font>
<font color="black">  57.         # Setup custom user-agent string if it isn't already customized</font>
<font color="green">  58.         if self._session.user_agent_name == 'Botocore':</font>
<font color="green">  59.             botocore_info = 'Botocore/{0}'.format(</font>
<font color="green">  60.                 self._session.user_agent_version)</font>
<font color="green">  61.             if self._session.user_agent_extra:</font>
<font color="red">  62.                 self._session.user_agent_extra += ' ' + botocore_info</font>
<font color="black">  63.             else:</font>
<font color="green">  64.                 self._session.user_agent_extra = botocore_info</font>
<font color="green">  65.             self._session.user_agent_name = 'Boto3'</font>
<font color="green">  66.             self._session.user_agent_version = boto3.__version__</font>
<font color="black">  67. </font>
<font color="green">  68.         if profile_name is not None:</font>
<font color="red">  69.             self._session.set_config_variable('profile', profile_name)</font>
<font color="black">  70. </font>
<font color="green">  71.         if aws_access_key_id or aws_secret_access_key or aws_session_token:</font>
<font color="red">  72.             self._session.set_credentials(</font>
<font color="red">  73.                 aws_access_key_id, aws_secret_access_key, aws_session_token)</font>
<font color="black">  74. </font>
<font color="green">  75.         if region_name is not None:</font>
<font color="red">  76.             self._session.set_config_variable('region', region_name)</font>
<font color="black">  77. </font>
<font color="green">  78.         self.resource_factory = ResourceFactory(</font>
<font color="green">  79.             self._session.get_component('event_emitter'))</font>
<font color="green">  80.         self._setup_loader()</font>
<font color="green">  81.         self._register_default_handlers()</font>
<font color="black">  82. </font>
<font color="green">  83.     def __repr__(self):</font>
<font color="red">  84.         return '{0}(region_name={1})'.format(</font>
<font color="red">  85.             self.__class__.__name__,</font>
<font color="red">  86.             repr(self._session.get_config_variable('region')))</font>
<font color="black">  87. </font>
<font color="green">  88.     @property</font>
<font color="black">  89.     def profile_name(self):</font>
<font color="black">  90.         &quot;&quot;&quot;</font>
<font color="black">  91.         The **read-only** profile name.</font>
<font color="black">  92.         &quot;&quot;&quot;</font>
<font color="red">  93.         return self._session.profile or 'default'</font>
<font color="black">  94. </font>
<font color="green">  95.     @property</font>
<font color="black">  96.     def region_name(self):</font>
<font color="black">  97.         &quot;&quot;&quot;</font>
<font color="black">  98.         The **read-only** region name.</font>
<font color="black">  99.         &quot;&quot;&quot;</font>
<font color="red"> 100.         return self._session.get_config_variable('region')</font>
<font color="black"> 101. </font>
<font color="green"> 102.     @property</font>
<font color="black"> 103.     def events(self):</font>
<font color="black"> 104.         &quot;&quot;&quot;</font>
<font color="black"> 105.         The event emitter for a session</font>
<font color="black"> 106.         &quot;&quot;&quot;</font>
<font color="green"> 107.         return self._session.get_component('event_emitter')</font>
<font color="black"> 108. </font>
<font color="green"> 109.     @property</font>
<font color="black"> 110.     def available_profiles(self):</font>
<font color="black"> 111.         &quot;&quot;&quot;</font>
<font color="black"> 112.         The profiles available to the session credentials</font>
<font color="black"> 113.         &quot;&quot;&quot;</font>
<font color="red"> 114.         return self._session.available_profiles</font>
<font color="black"> 115. </font>
<font color="green"> 116.     def _setup_loader(self):</font>
<font color="black"> 117.         &quot;&quot;&quot;</font>
<font color="black"> 118.         Setup loader paths so that we can load resources.</font>
<font color="black"> 119.         &quot;&quot;&quot;</font>
<font color="green"> 120.         self._loader = self._session.get_component('data_loader')</font>
<font color="green"> 121.         self._loader.search_paths.append(</font>
<font color="green"> 122.             os.path.join(os.path.dirname(__file__), 'data'))</font>
<font color="black"> 123. </font>
<font color="green"> 124.     def get_available_services(self):</font>
<font color="black"> 125.         &quot;&quot;&quot;</font>
<font color="black"> 126.         Get a list of available services that can be loaded as low-level</font>
<font color="black"> 127.         clients via :py:meth:`Session.client`.</font>
<font color="black"> 128. </font>
<font color="black"> 129.         :rtype: list</font>
<font color="black"> 130.         :return: List of service names</font>
<font color="black"> 131.         &quot;&quot;&quot;</font>
<font color="red"> 132.         return self._session.get_available_services()</font>
<font color="black"> 133. </font>
<font color="green"> 134.     def get_available_resources(self):</font>
<font color="black"> 135.         &quot;&quot;&quot;</font>
<font color="black"> 136.         Get a list of available services that can be loaded as resource</font>
<font color="black"> 137.         clients via :py:meth:`Session.resource`.</font>
<font color="black"> 138. </font>
<font color="black"> 139.         :rtype: list</font>
<font color="black"> 140.         :return: List of service names</font>
<font color="black"> 141.         &quot;&quot;&quot;</font>
<font color="red"> 142.         return self._loader.list_available_services(type_name='resources-1')</font>
<font color="black"> 143. </font>
<font color="green"> 144.     def get_available_partitions(self):</font>
<font color="black"> 145.         &quot;&quot;&quot;Lists the available partitions</font>
<font color="black"> 146. </font>
<font color="black"> 147.         :rtype: list</font>
<font color="black"> 148.         :return: Returns a list of partition names (e.g., [&quot;aws&quot;, &quot;aws-cn&quot;])</font>
<font color="black"> 149.         &quot;&quot;&quot;</font>
<font color="red"> 150.         return self._session.get_available_partitions()</font>
<font color="black"> 151. </font>
<font color="green"> 152.     def get_available_regions(self, service_name, partition_name='aws',</font>
<font color="green"> 153.                               allow_non_regional=False):</font>
<font color="black"> 154.         &quot;&quot;&quot;Lists the region and endpoint names of a particular partition.</font>
<font color="black"> 155. </font>
<font color="black"> 156.         :type service_name: string</font>
<font color="black"> 157.         :param service_name: Name of a service to list endpoint for (e.g., s3).</font>
<font color="black"> 158. </font>
<font color="black"> 159.         :type partition_name: string</font>
<font color="black"> 160.         :param partition_name: Name of the partition to limit endpoints to.</font>
<font color="black"> 161.             (e.g., aws for the public AWS endpoints, aws-cn for AWS China</font>
<font color="black"> 162.             endpoints, aws-us-gov for AWS GovCloud (US) Endpoints, etc.)</font>
<font color="black"> 163. </font>
<font color="black"> 164.         :type allow_non_regional: bool</font>
<font color="black"> 165.         :param allow_non_regional: Set to True to include endpoints that are</font>
<font color="black"> 166.              not regional endpoints (e.g., s3-external-1,</font>
<font color="black"> 167.              fips-us-gov-west-1, etc).</font>
<font color="black"> 168. </font>
<font color="black"> 169.         :return: Returns a list of endpoint names (e.g., [&quot;us-east-1&quot;]).</font>
<font color="black"> 170.         &quot;&quot;&quot;</font>
<font color="red"> 171.         return self._session.get_available_regions(</font>
<font color="red"> 172.             service_name=service_name, partition_name=partition_name,</font>
<font color="red"> 173.             allow_non_regional=allow_non_regional)</font>
<font color="black"> 174. </font>
<font color="green"> 175.     def get_credentials(self):</font>
<font color="black"> 176.         &quot;&quot;&quot;</font>
<font color="black"> 177.         Return the :class:`botocore.credential.Credential` object</font>
<font color="black"> 178.         associated with this session.  If the credentials have not</font>
<font color="black"> 179.         yet been loaded, this will attempt to load them.  If they</font>
<font color="black"> 180.         have already been loaded, this will return the cached</font>
<font color="black"> 181.         credentials.</font>
<font color="black"> 182.         &quot;&quot;&quot;</font>
<font color="red"> 183.         return self._session.get_credentials()</font>
<font color="black"> 184. </font>
<font color="green"> 185.     def client(self, service_name, region_name=None, api_version=None,</font>
<font color="green"> 186.                use_ssl=True, verify=None, endpoint_url=None,</font>
<font color="green"> 187.                aws_access_key_id=None, aws_secret_access_key=None,</font>
<font color="green"> 188.                aws_session_token=None, config=None):</font>
<font color="black"> 189.         &quot;&quot;&quot;</font>
<font color="black"> 190.         Create a low-level service client by name.</font>
<font color="black"> 191. </font>
<font color="black"> 192.         :type service_name: string</font>
<font color="black"> 193.         :param service_name: The name of a service, e.g. 's3' or 'ec2'. You</font>
<font color="black"> 194.             can get a list of available services via</font>
<font color="black"> 195.             :py:meth:`get_available_services`.</font>
<font color="black"> 196. </font>
<font color="black"> 197.         :type region_name: string</font>
<font color="black"> 198.         :param region_name: The name of the region associated with the client.</font>
<font color="black"> 199.             A client is associated with a single region.</font>
<font color="black"> 200. </font>
<font color="black"> 201.         :type api_version: string</font>
<font color="black"> 202.         :param api_version: The API version to use.  By default, botocore will</font>
<font color="black"> 203.             use the latest API version when creating a client.  You only need</font>
<font color="black"> 204.             to specify this parameter if you want to use a previous API version</font>
<font color="black"> 205.             of the client.</font>
<font color="black"> 206. </font>
<font color="black"> 207.         :type use_ssl: boolean</font>
<font color="black"> 208.         :param use_ssl: Whether or not to use SSL.  By default, SSL is used.</font>
<font color="black"> 209.             Note that not all services support non-ssl connections.</font>
<font color="black"> 210. </font>
<font color="black"> 211.         :type verify: boolean/string</font>
<font color="black"> 212.         :param verify: Whether or not to verify SSL certificates.  By default</font>
<font color="black"> 213.             SSL certificates are verified.  You can provide the following</font>
<font color="black"> 214.             values:</font>
<font color="black"> 215. </font>
<font color="black"> 216.             * False - do not validate SSL certificates.  SSL will still be</font>
<font color="black"> 217.               used (unless use_ssl is False), but SSL certificates</font>
<font color="black"> 218.               will not be verified.</font>
<font color="black"> 219.             * path/to/cert/bundle.pem - A filename of the CA cert bundle to</font>
<font color="black"> 220.               uses.  You can specify this argument if you want to use a</font>
<font color="black"> 221.               different CA cert bundle than the one used by botocore.</font>
<font color="black"> 222. </font>
<font color="black"> 223.         :type endpoint_url: string</font>
<font color="black"> 224.         :param endpoint_url: The complete URL to use for the constructed</font>
<font color="black"> 225.             client. Normally, botocore will automatically construct the</font>
<font color="black"> 226.             appropriate URL to use when communicating with a service.  You</font>
<font color="black"> 227.             can specify a complete URL (including the &quot;http/https&quot; scheme)</font>
<font color="black"> 228.             to override this behavior.  If this value is provided,</font>
<font color="black"> 229.             then ``use_ssl`` is ignored.</font>
<font color="black"> 230. </font>
<font color="black"> 231.         :type aws_access_key_id: string</font>
<font color="black"> 232.         :param aws_access_key_id: The access key to use when creating</font>
<font color="black"> 233.             the client.  This is entirely optional, and if not provided,</font>
<font color="black"> 234.             the credentials configured for the session will automatically</font>
<font color="black"> 235.             be used.  You only need to provide this argument if you want</font>
<font color="black"> 236.             to override the credentials used for this specific client.</font>
<font color="black"> 237. </font>
<font color="black"> 238.         :type aws_secret_access_key: string</font>
<font color="black"> 239.         :param aws_secret_access_key: The secret key to use when creating</font>
<font color="black"> 240.             the client.  Same semantics as aws_access_key_id above.</font>
<font color="black"> 241. </font>
<font color="black"> 242.         :type aws_session_token: string</font>
<font color="black"> 243.         :param aws_session_token: The session token to use when creating</font>
<font color="black"> 244.             the client.  Same semantics as aws_access_key_id above.</font>
<font color="black"> 245. </font>
<font color="black"> 246.         :type config: botocore.client.Config</font>
<font color="black"> 247.         :param config: Advanced client configuration options. If region_name</font>
<font color="black"> 248.             is specified in the client config, its value will take precedence</font>
<font color="black"> 249.             over environment variables and configuration values, but not over</font>
<font color="black"> 250.             a region_name value passed explicitly to the method. See</font>
<font color="black"> 251.             `botocore config documentation</font>
<font color="black"> 252.             &lt;https://botocore.readthedocs.io/en/stable/reference/config.html&gt;`_</font>
<font color="black"> 253.             for more details.</font>
<font color="black"> 254. </font>
<font color="black"> 255.         :return: Service client instance</font>
<font color="black"> 256. </font>
<font color="black"> 257.         &quot;&quot;&quot;</font>
<font color="green"> 258.         return self._session.create_client(</font>
<font color="green"> 259.             service_name, region_name=region_name, api_version=api_version,</font>
<font color="green"> 260.             use_ssl=use_ssl, verify=verify, endpoint_url=endpoint_url,</font>
<font color="green"> 261.             aws_access_key_id=aws_access_key_id,</font>
<font color="green"> 262.             aws_secret_access_key=aws_secret_access_key,</font>
<font color="green"> 263.             aws_session_token=aws_session_token, config=config)</font>
<font color="black"> 264. </font>
<font color="green"> 265.     def resource(self, service_name, region_name=None, api_version=None,</font>
<font color="green"> 266.                  use_ssl=True, verify=None, endpoint_url=None,</font>
<font color="green"> 267.                  aws_access_key_id=None, aws_secret_access_key=None,</font>
<font color="green"> 268.                  aws_session_token=None, config=None):</font>
<font color="black"> 269.         &quot;&quot;&quot;</font>
<font color="black"> 270.         Create a resource service client by name.</font>
<font color="black"> 271. </font>
<font color="black"> 272.         :type service_name: string</font>
<font color="black"> 273.         :param service_name: The name of a service, e.g. 's3' or 'ec2'. You</font>
<font color="black"> 274.             can get a list of available services via</font>
<font color="black"> 275.             :py:meth:`get_available_resources`.</font>
<font color="black"> 276. </font>
<font color="black"> 277.         :type region_name: string</font>
<font color="black"> 278.         :param region_name: The name of the region associated with the client.</font>
<font color="black"> 279.             A client is associated with a single region.</font>
<font color="black"> 280. </font>
<font color="black"> 281.         :type api_version: string</font>
<font color="black"> 282.         :param api_version: The API version to use.  By default, botocore will</font>
<font color="black"> 283.             use the latest API version when creating a client.  You only need</font>
<font color="black"> 284.             to specify this parameter if you want to use a previous API version</font>
<font color="black"> 285.             of the client.</font>
<font color="black"> 286. </font>
<font color="black"> 287.         :type use_ssl: boolean</font>
<font color="black"> 288.         :param use_ssl: Whether or not to use SSL.  By default, SSL is used.</font>
<font color="black"> 289.             Note that not all services support non-ssl connections.</font>
<font color="black"> 290. </font>
<font color="black"> 291.         :type verify: boolean/string</font>
<font color="black"> 292.         :param verify: Whether or not to verify SSL certificates.  By default</font>
<font color="black"> 293.             SSL certificates are verified.  You can provide the following</font>
<font color="black"> 294.             values:</font>
<font color="black"> 295. </font>
<font color="black"> 296.             * False - do not validate SSL certificates.  SSL will still be</font>
<font color="black"> 297.               used (unless use_ssl is False), but SSL certificates</font>
<font color="black"> 298.               will not be verified.</font>
<font color="black"> 299.             * path/to/cert/bundle.pem - A filename of the CA cert bundle to</font>
<font color="black"> 300.               uses.  You can specify this argument if you want to use a</font>
<font color="black"> 301.               different CA cert bundle than the one used by botocore.</font>
<font color="black"> 302. </font>
<font color="black"> 303.         :type endpoint_url: string</font>
<font color="black"> 304.         :param endpoint_url: The complete URL to use for the constructed</font>
<font color="black"> 305.             client. Normally, botocore will automatically construct the</font>
<font color="black"> 306.             appropriate URL to use when communicating with a service.  You</font>
<font color="black"> 307.             can specify a complete URL (including the &quot;http/https&quot; scheme)</font>
<font color="black"> 308.             to override this behavior.  If this value is provided,</font>
<font color="black"> 309.             then ``use_ssl`` is ignored.</font>
<font color="black"> 310. </font>
<font color="black"> 311.         :type aws_access_key_id: string</font>
<font color="black"> 312.         :param aws_access_key_id: The access key to use when creating</font>
<font color="black"> 313.             the client.  This is entirely optional, and if not provided,</font>
<font color="black"> 314.             the credentials configured for the session will automatically</font>
<font color="black"> 315.             be used.  You only need to provide this argument if you want</font>
<font color="black"> 316.             to override the credentials used for this specific client.</font>
<font color="black"> 317. </font>
<font color="black"> 318.         :type aws_secret_access_key: string</font>
<font color="black"> 319.         :param aws_secret_access_key: The secret key to use when creating</font>
<font color="black"> 320.             the client.  Same semantics as aws_access_key_id above.</font>
<font color="black"> 321. </font>
<font color="black"> 322.         :type aws_session_token: string</font>
<font color="black"> 323.         :param aws_session_token: The session token to use when creating</font>
<font color="black"> 324.             the client.  Same semantics as aws_access_key_id above.</font>
<font color="black"> 325. </font>
<font color="black"> 326.         :type config: botocore.client.Config</font>
<font color="black"> 327.         :param config: Advanced client configuration options. If region_name</font>
<font color="black"> 328.             is specified in the client config, its value will take precedence</font>
<font color="black"> 329.             over environment variables and configuration values, but not over</font>
<font color="black"> 330.             a region_name value passed explicitly to the method.  If</font>
<font color="black"> 331.             user_agent_extra is specified in the client config, it overrides</font>
<font color="black"> 332.             the default user_agent_extra provided by the resource API. See</font>
<font color="black"> 333.             `botocore config documentation</font>
<font color="black"> 334.             &lt;https://botocore.readthedocs.io/en/stable/reference/config.html&gt;`_</font>
<font color="black"> 335.             for more details.</font>
<font color="black"> 336. </font>
<font color="black"> 337.         :return: Subclass of :py:class:`~boto3.resources.base.ServiceResource`</font>
<font color="black"> 338.         &quot;&quot;&quot;</font>
<font color="red"> 339.         try:</font>
<font color="red"> 340.             resource_model = self._loader.load_service_model(</font>
<font color="red"> 341.                 service_name, 'resources-1', api_version)</font>
<font color="red"> 342.         except UnknownServiceError:</font>
<font color="red"> 343.             available = self.get_available_resources()</font>
<font color="black"> 344.             has_low_level_client = (</font>
<font color="red"> 345.                 service_name in self.get_available_services())</font>
<font color="red"> 346.             raise ResourceNotExistsError(service_name, available,</font>
<font color="red"> 347.                                          has_low_level_client)</font>
<font color="red"> 348.         except DataNotFoundError:</font>
<font color="black"> 349.             # This is because we've provided an invalid API version.</font>
<font color="red"> 350.             available_api_versions = self._loader.list_api_versions(</font>
<font color="red"> 351.                 service_name, 'resources-1')</font>
<font color="red"> 352.             raise UnknownAPIVersionError(</font>
<font color="red"> 353.                 service_name, api_version, ', '.join(available_api_versions))</font>
<font color="black"> 354. </font>
<font color="red"> 355.         if api_version is None:</font>
<font color="black"> 356.             # Even though botocore's load_service_model() can handle</font>
<font color="black"> 357.             # using the latest api_version if not provided, we need</font>
<font color="black"> 358.             # to track this api_version in boto3 in order to ensure</font>
<font color="black"> 359.             # we're pairing a resource model with a client model</font>
<font color="black"> 360.             # of the same API version.  It's possible for the latest</font>
<font color="black"> 361.             # API version of a resource model in boto3 to not be</font>
<font color="black"> 362.             # the same API version as a service model in botocore.</font>
<font color="black"> 363.             # So we need to look up the api_version if one is not</font>
<font color="black"> 364.             # provided to ensure we load the same API version of the</font>
<font color="black"> 365.             # client.</font>
<font color="black"> 366.             #</font>
<font color="black"> 367.             # Note: This is relying on the fact that</font>
<font color="black"> 368.             #   loader.load_service_model(..., api_version=None)</font>
<font color="black"> 369.             # and loader.determine_latest_version(..., 'resources-1')</font>
<font color="black"> 370.             # both load the same api version of the file.</font>
<font color="red"> 371.             api_version = self._loader.determine_latest_version(</font>
<font color="red"> 372.                 service_name, 'resources-1')</font>
<font color="black"> 373. </font>
<font color="black"> 374.         # Creating a new resource instance requires the low-level client</font>
<font color="black"> 375.         # and service model, the resource version and resource JSON data.</font>
<font color="black"> 376.         # We pass these to the factory and get back a class, which is</font>
<font color="black"> 377.         # instantiated on top of the low-level client.</font>
<font color="red"> 378.         if config is not None:</font>
<font color="red"> 379.             if config.user_agent_extra is None:</font>
<font color="red"> 380.                 config = copy.deepcopy(config)</font>
<font color="red"> 381.                 config.user_agent_extra = 'Resource'</font>
<font color="black"> 382.         else:</font>
<font color="red"> 383.             config = Config(user_agent_extra='Resource')</font>
<font color="red"> 384.         client = self.client(</font>
<font color="red"> 385.             service_name, region_name=region_name, api_version=api_version,</font>
<font color="red"> 386.             use_ssl=use_ssl, verify=verify, endpoint_url=endpoint_url,</font>
<font color="red"> 387.             aws_access_key_id=aws_access_key_id,</font>
<font color="red"> 388.             aws_secret_access_key=aws_secret_access_key,</font>
<font color="red"> 389.             aws_session_token=aws_session_token, config=config)</font>
<font color="red"> 390.         service_model = client.meta.service_model</font>
<font color="black"> 391. </font>
<font color="black"> 392.         # Create a ServiceContext object to serve as a reference to</font>
<font color="black"> 393.         # important read-only information about the general service.</font>
<font color="red"> 394.         service_context = boto3.utils.ServiceContext(</font>
<font color="red"> 395.                 service_name=service_name, service_model=service_model,</font>
<font color="red"> 396.                 resource_json_definitions=resource_model['resources'],</font>
<font color="red"> 397.                 service_waiter_model=boto3.utils.LazyLoadedWaiterModel(</font>
<font color="red"> 398.                     self._session, service_name, api_version)</font>
<font color="black"> 399.         )</font>
<font color="black"> 400. </font>
<font color="black"> 401.         # Create the service resource class.</font>
<font color="red"> 402.         cls = self.resource_factory.load_from_definition(</font>
<font color="red"> 403.             resource_name=service_name,</font>
<font color="red"> 404.             single_resource_json_definition=resource_model['service'],</font>
<font color="red"> 405.             service_context=service_context</font>
<font color="black"> 406.         )</font>
<font color="black"> 407. </font>
<font color="red"> 408.         return cls(client=client)</font>
<font color="black"> 409. </font>
<font color="green"> 410.     def _register_default_handlers(self):</font>
<font color="black"> 411. </font>
<font color="black"> 412.         # S3 customizations</font>
<font color="green"> 413.         self._session.register(</font>
<font color="green"> 414.             'creating-client-class.s3',</font>
<font color="green"> 415.             boto3.utils.lazy_call(</font>
<font color="green"> 416.                 'boto3.s3.inject.inject_s3_transfer_methods'))</font>
<font color="green"> 417.         self._session.register(</font>
<font color="green"> 418.             'creating-resource-class.s3.Bucket',</font>
<font color="green"> 419.             boto3.utils.lazy_call(</font>
<font color="green"> 420.                 'boto3.s3.inject.inject_bucket_methods'))</font>
<font color="green"> 421.         self._session.register(</font>
<font color="green"> 422.             'creating-resource-class.s3.Object',</font>
<font color="green"> 423.             boto3.utils.lazy_call(</font>
<font color="green"> 424.                 'boto3.s3.inject.inject_object_methods'))</font>
<font color="green"> 425.         self._session.register(</font>
<font color="green"> 426.             'creating-resource-class.s3.ObjectSummary',</font>
<font color="green"> 427.             boto3.utils.lazy_call(</font>
<font color="green"> 428.                 'boto3.s3.inject.inject_object_summary_methods'))</font>
<font color="black"> 429. </font>
<font color="black"> 430.         # DynamoDb customizations</font>
<font color="green"> 431.         self._session.register(</font>
<font color="green"> 432.             'creating-resource-class.dynamodb',</font>
<font color="green"> 433.             boto3.utils.lazy_call(</font>
<font color="green"> 434.                 'boto3.dynamodb.transform.register_high_level_interface'),</font>
<font color="green"> 435.             unique_id='high-level-dynamodb')</font>
<font color="green"> 436.         self._session.register(</font>
<font color="green"> 437.             'creating-resource-class.dynamodb.Table',</font>
<font color="green"> 438.             boto3.utils.lazy_call(</font>
<font color="green"> 439.                 'boto3.dynamodb.table.register_table_methods'),</font>
<font color="green"> 440.             unique_id='high-level-dynamodb-table')</font>
<font color="black"> 441. </font>
<font color="black"> 442.         # EC2 Customizations</font>
<font color="green"> 443.         self._session.register(</font>
<font color="green"> 444.             'creating-resource-class.ec2.ServiceResource',</font>
<font color="green"> 445.             boto3.utils.lazy_call(</font>
<font color="green"> 446.                 'boto3.ec2.createtags.inject_create_tags'))</font>
<font color="black"> 447. </font>
<font color="green"> 448.         self._session.register(</font>
<font color="green"> 449.             'creating-resource-class.ec2.Instance',</font>
<font color="green"> 450.             boto3.utils.lazy_call(</font>
<font color="green"> 451.                 'boto3.ec2.deletetags.inject_delete_tags',</font>
<font color="green"> 452.                 event_emitter=self.events))</font>
</pre>

