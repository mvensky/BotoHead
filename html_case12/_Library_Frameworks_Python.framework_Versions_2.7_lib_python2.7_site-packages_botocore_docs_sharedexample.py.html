source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/docs/sharedexample.py</b><br>


file stats: <b>148 lines, 20 executed: 13.5% covered</b>
<pre>
<font color="black">   1. # Copyright 2015 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. import re</font>
<font color="green">  14. import numbers</font>
<font color="green">  15. from botocore.utils import parse_timestamp</font>
<font color="green">  16. from botocore.docs.utils import escape_controls</font>
<font color="green">  17. from botocore.compat import six</font>
<font color="black">  18. </font>
<font color="black">  19. </font>
<font color="green">  20. class SharedExampleDocumenter(object):</font>
<font color="green">  21.     def document_shared_example(self, example, prefix, section,</font>
<font color="black">  22.                                 operation_model):</font>
<font color="black">  23.         &quot;&quot;&quot;Documents a single shared example based on its definition.</font>
<font color="black">  24. </font>
<font color="black">  25.         :param example: The model of the example</font>
<font color="black">  26. </font>
<font color="black">  27.         :param prefix: The prefix to use in the method example.</font>
<font color="black">  28. </font>
<font color="black">  29.         :param section: The section to write to.</font>
<font color="black">  30. </font>
<font color="black">  31.         :param operation_model: The model of the operation used in the example</font>
<font color="black">  32.         &quot;&quot;&quot;</font>
<font color="red">  33.         section.style.new_paragraph()</font>
<font color="red">  34.         section.write(example.get('description'))</font>
<font color="red">  35.         section.style.new_line()</font>
<font color="red">  36.         self.document_input(section, example, prefix,</font>
<font color="red">  37.                             operation_model.input_shape)</font>
<font color="red">  38.         self.document_output(section, example, operation_model.output_shape)</font>
<font color="black">  39. </font>
<font color="green">  40.     def document_input(self, section, example, prefix, shape):</font>
<font color="red">  41.         input_section = section.add_new_section('input')</font>
<font color="red">  42.         input_section.style.start_codeblock()</font>
<font color="red">  43.         if prefix is not None:</font>
<font color="red">  44.             input_section.write(prefix)</font>
<font color="red">  45.         params = example.get('input', {})</font>
<font color="red">  46.         comments = example.get('comments')</font>
<font color="red">  47.         if comments:</font>
<font color="red">  48.             comments = comments.get('input')</font>
<font color="red">  49.         param_section = input_section.add_new_section('parameters')</font>
<font color="red">  50.         self._document_params(param_section, params, comments, [], shape)</font>
<font color="red">  51.         closing_section = input_section.add_new_section('input-close')</font>
<font color="red">  52.         closing_section.style.new_line()</font>
<font color="red">  53.         closing_section.style.new_line()</font>
<font color="red">  54.         closing_section.write('print(response)')</font>
<font color="red">  55.         closing_section.style.end_codeblock()</font>
<font color="black">  56. </font>
<font color="green">  57.     def document_output(self, section, example, shape):</font>
<font color="red">  58.         output_section = section.add_new_section('output')</font>
<font color="red">  59.         output_section.style.new_line()</font>
<font color="red">  60.         output_section.write('Expected Output:')</font>
<font color="red">  61.         output_section.style.new_line()</font>
<font color="red">  62.         output_section.style.start_codeblock()</font>
<font color="red">  63.         params = example.get('output', {})</font>
<font color="black">  64. </font>
<font color="black">  65.         # There might not be an output, but we will return metadata anyway</font>
<font color="red">  66.         params['ResponseMetadata'] = {&quot;...&quot;: &quot;...&quot;}</font>
<font color="red">  67.         comments = example.get('comments')</font>
<font color="red">  68.         if comments:</font>
<font color="red">  69.             comments = comments.get('output')</font>
<font color="red">  70.         self._document_dict(output_section, params, comments, [], shape, True)</font>
<font color="red">  71.         closing_section = output_section.add_new_section('output-close')</font>
<font color="red">  72.         closing_section.style.end_codeblock()</font>
<font color="black">  73. </font>
<font color="green">  74.     def _document(self, section, value, comments, path, shape):</font>
<font color="black">  75.         &quot;&quot;&quot;</font>
<font color="black">  76.         :param section: The section to add the docs to.</font>
<font color="black">  77. </font>
<font color="black">  78.         :param value: The input / output values representing the parameters that</font>
<font color="black">  79.                       are included in the example.</font>
<font color="black">  80. </font>
<font color="black">  81.         :param comments: The dictionary containing all the comments to be</font>
<font color="black">  82.                          applied to the example.</font>
<font color="black">  83. </font>
<font color="black">  84.         :param path: A list describing where the documenter is in traversing the</font>
<font color="black">  85.                      parameters. This is used to find the equivalent location</font>
<font color="black">  86.                      in the comments dictionary.</font>
<font color="black">  87.         &quot;&quot;&quot;</font>
<font color="red">  88.         if isinstance(value, dict):</font>
<font color="red">  89.             self._document_dict(section, value, comments, path, shape)</font>
<font color="red">  90.         elif isinstance(value, list):</font>
<font color="red">  91.             self._document_list(section, value, comments, path, shape)</font>
<font color="red">  92.         elif isinstance(value, numbers.Number):</font>
<font color="red">  93.             self._document_number(section, value, path)</font>
<font color="red">  94.         elif shape and shape.type_name == 'timestamp':</font>
<font color="red">  95.             self._document_datetime(section, value, path)</font>
<font color="black">  96.         else:</font>
<font color="red">  97.             self._document_str(section, value, path)</font>
<font color="black">  98. </font>
<font color="black">  99.     def _document_dict(self, section, value, comments, path, shape,</font>
<font color="green"> 100.                        top_level=False):</font>
<font color="red"> 101.         dict_section = section.add_new_section('dict-value')</font>
<font color="red"> 102.         self._start_nested_value(dict_section, '{')</font>
<font color="red"> 103.         for key, val in value.items():</font>
<font color="red"> 104.             path.append('.%s' % key)</font>
<font color="red"> 105.             item_section = dict_section.add_new_section(key)</font>
<font color="red"> 106.             item_section.style.new_line()</font>
<font color="red"> 107.             item_comment = self._get_comment(path, comments)</font>
<font color="red"> 108.             if item_comment:</font>
<font color="red"> 109.                 item_section.write(item_comment)</font>
<font color="red"> 110.                 item_section.style.new_line()</font>
<font color="red"> 111.             item_section.write(&quot;'%s': &quot; % key)</font>
<font color="black"> 112. </font>
<font color="black"> 113.             # Shape could be none if there is no output besides ResponseMetadata</font>
<font color="red"> 114.             item_shape = None</font>
<font color="red"> 115.             if shape:</font>
<font color="red"> 116.                 if shape.type_name == 'structure':</font>
<font color="red"> 117.                     item_shape = shape.members.get(key)</font>
<font color="red"> 118.                 elif shape.type_name == 'map':</font>
<font color="red"> 119.                     item_shape = shape.value</font>
<font color="red"> 120.             self._document(item_section, val, comments, path, item_shape)</font>
<font color="red"> 121.             path.pop()</font>
<font color="red"> 122.         dict_section_end = dict_section.add_new_section('ending-brace')</font>
<font color="red"> 123.         self._end_nested_value(dict_section_end, '}')</font>
<font color="red"> 124.         if not top_level:</font>
<font color="red"> 125.             dict_section_end.write(',')</font>
<font color="black"> 126. </font>
<font color="green"> 127.     def _document_params(self, section, value, comments, path, shape):</font>
<font color="red"> 128.         param_section = section.add_new_section('param-values')</font>
<font color="red"> 129.         self._start_nested_value(param_section, '(')</font>
<font color="red"> 130.         for key, val in value.items():</font>
<font color="red"> 131.             path.append('.%s' % key)</font>
<font color="red"> 132.             item_section = param_section.add_new_section(key)</font>
<font color="red"> 133.             item_section.style.new_line()</font>
<font color="red"> 134.             item_comment = self._get_comment(path, comments)</font>
<font color="red"> 135.             if item_comment:</font>
<font color="red"> 136.                 item_section.write(item_comment)</font>
<font color="red"> 137.                 item_section.style.new_line()</font>
<font color="red"> 138.             item_section.write(key + '=')</font>
<font color="black"> 139. </font>
<font color="black"> 140.             # Shape could be none if there are no input parameters</font>
<font color="red"> 141.             item_shape = None</font>
<font color="red"> 142.             if shape:</font>
<font color="red"> 143.                 item_shape = shape.members.get(key)</font>
<font color="red"> 144.             self._document(item_section, val, comments, path, item_shape)</font>
<font color="red"> 145.             path.pop()</font>
<font color="red"> 146.         param_section_end = param_section.add_new_section('ending-parenthesis')</font>
<font color="red"> 147.         self._end_nested_value(param_section_end, ')')</font>
<font color="black"> 148. </font>
<font color="green"> 149.     def _document_list(self, section, value, comments, path, shape):</font>
<font color="red"> 150.         list_section = section.add_new_section('list-section')</font>
<font color="red"> 151.         self._start_nested_value(list_section, '[')</font>
<font color="red"> 152.         item_shape = shape.member</font>
<font color="red"> 153.         for index, val in enumerate(value):</font>
<font color="red"> 154.             item_section = list_section.add_new_section(index)</font>
<font color="red"> 155.             item_section.style.new_line()</font>
<font color="red"> 156.             path.append('[%s]' % index)</font>
<font color="red"> 157.             item_comment = self._get_comment(path, comments)</font>
<font color="red"> 158.             if item_comment:</font>
<font color="red"> 159.                 item_section.write(item_comment)</font>
<font color="red"> 160.                 item_section.style.new_line()</font>
<font color="red"> 161.             self._document(item_section, val, comments, path, item_shape)</font>
<font color="red"> 162.             path.pop()</font>
<font color="red"> 163.         list_section_end = list_section.add_new_section('ending-bracket')</font>
<font color="red"> 164.         self._end_nested_value(list_section_end, '],')</font>
<font color="black"> 165. </font>
<font color="green"> 166.     def _document_str(self, section, value, path):</font>
<font color="black"> 167.         # We do the string conversion because this might accept a type that</font>
<font color="black"> 168.         # we don't specifically address.</font>
<font color="red"> 169.         safe_value = escape_controls(value)</font>
<font color="red"> 170.         section.write(u&quot;'%s',&quot; % six.text_type(safe_value))</font>
<font color="black"> 171. </font>
<font color="green"> 172.     def _document_number(self, section, value, path):</font>
<font color="red"> 173.         section.write(&quot;%s,&quot; % str(value))</font>
<font color="black"> 174. </font>
<font color="green"> 175.     def _document_datetime(self, section, value, path):</font>
<font color="red"> 176.         datetime_tuple = parse_timestamp(value).timetuple()</font>
<font color="red"> 177.         datetime_str = str(datetime_tuple[0])</font>
<font color="red"> 178.         for i in range(1, len(datetime_tuple)):</font>
<font color="red"> 179.             datetime_str += &quot;, &quot; + str(datetime_tuple[i])</font>
<font color="red"> 180.         section.write(&quot;datetime(%s),&quot; % datetime_str)</font>
<font color="black"> 181. </font>
<font color="green"> 182.     def _get_comment(self, path, comments):</font>
<font color="red"> 183.         key = re.sub(r'^\.', '', ''.join(path))</font>
<font color="red"> 184.         if comments and key in comments:</font>
<font color="red"> 185.             return '# ' + comments[key]</font>
<font color="black"> 186.         else:</font>
<font color="red"> 187.             return ''</font>
<font color="black"> 188. </font>
<font color="green"> 189.     def _start_nested_value(self, section, start):</font>
<font color="red"> 190.         section.write(start)</font>
<font color="red"> 191.         section.style.indent()</font>
<font color="red"> 192.         section.style.indent()</font>
<font color="black"> 193. </font>
<font color="green"> 194.     def _end_nested_value(self, section, end):</font>
<font color="red"> 195.         section.style.dedent()</font>
<font color="red"> 196.         section.style.dedent()</font>
<font color="red"> 197.         section.style.new_line()</font>
<font color="red"> 198.         section.write(end)</font>
<font color="black"> 199. </font>
<font color="black"> 200. </font>
<font color="green"> 201. def document_shared_examples(section, operation_model, example_prefix,</font>
<font color="black"> 202.                              shared_examples):</font>
<font color="black"> 203.     &quot;&quot;&quot;Documents the shared examples</font>
<font color="black"> 204. </font>
<font color="black"> 205.     :param section: The section to write to.</font>
<font color="black"> 206. </font>
<font color="black"> 207.     :param operation_model: The model of the operation.</font>
<font color="black"> 208. </font>
<font color="black"> 209.     :param example_prefix: The prefix to use in the method example.</font>
<font color="black"> 210. </font>
<font color="black"> 211.     :param shared_examples: The shared JSON examples from the model.</font>
<font color="black"> 212.     &quot;&quot;&quot;</font>
<font color="red"> 213.     container_section = section.add_new_section('shared-examples')</font>
<font color="red"> 214.     container_section.style.new_paragraph()</font>
<font color="red"> 215.     container_section.style.bold('Examples')</font>
<font color="red"> 216.     documenter = SharedExampleDocumenter()</font>
<font color="red"> 217.     for example in shared_examples:</font>
<font color="red"> 218.         documenter.document_shared_example(</font>
<font color="red"> 219.             example=example,</font>
<font color="red"> 220.             section=container_section.add_new_section(example['id']),</font>
<font color="red"> 221.             prefix=example_prefix,</font>
<font color="red"> 222.             operation_model=operation_model</font>
<font color="black"> 223.         )</font>
</pre>

