source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/history.py</b><br>


file stats: <b>28 lines, 18 executed: 64.3% covered</b>
<pre>
<font color="black">   1. # Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. import logging</font>
<font color="black">  14. </font>
<font color="black">  15. </font>
<font color="green">  16. HISTORY_RECORDER = None</font>
<font color="green">  17. logger = logging.getLogger(__name__)</font>
<font color="black">  18. </font>
<font color="black">  19. </font>
<font color="green">  20. class BaseHistoryHandler(object):</font>
<font color="green">  21.     def emit(self, event_type, payload, source):</font>
<font color="red">  22.         raise NotImplementedError('emit()')</font>
<font color="black">  23. </font>
<font color="black">  24. </font>
<font color="green">  25. class HistoryRecorder(object):</font>
<font color="green">  26.     def __init__(self):</font>
<font color="green">  27.         self._enabled = False</font>
<font color="green">  28.         self._handlers = []</font>
<font color="black">  29. </font>
<font color="green">  30.     def enable(self):</font>
<font color="red">  31.         self._enabled = True</font>
<font color="black">  32. </font>
<font color="green">  33.     def disable(self):</font>
<font color="red">  34.         self._enabled = False</font>
<font color="black">  35. </font>
<font color="green">  36.     def add_handler(self, handler):</font>
<font color="red">  37.         self._handlers.append(handler)</font>
<font color="black">  38. </font>
<font color="green">  39.     def record(self, event_type, payload, source='BOTOCORE'):</font>
<font color="green">  40.         if self._enabled and self._handlers:</font>
<font color="red">  41.             for handler in self._handlers:</font>
<font color="red">  42.                 try:</font>
<font color="red">  43.                     handler.emit(event_type, payload, source)</font>
<font color="red">  44.                 except Exception:</font>
<font color="black">  45.                     # Never let the process die because we had a failure in</font>
<font color="black">  46.                     # a record collection handler.</font>
<font color="red">  47.                     logger.debug(&quot;Exception raised in %s.&quot;, handler,</font>
<font color="red">  48.                                  exc_info=True)</font>
<font color="black">  49. </font>
<font color="black">  50. </font>
<font color="green">  51. def get_global_history_recorder():</font>
<font color="black">  52.     global HISTORY_RECORDER</font>
<font color="green">  53.     if HISTORY_RECORDER is None:</font>
<font color="green">  54.         HISTORY_RECORDER = HistoryRecorder()</font>
<font color="green">  55.     return HISTORY_RECORDER</font>
</pre>

