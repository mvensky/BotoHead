source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/boto3/docs/service.py</b><br>


file stats: <b>92 lines, 18 executed: 19.6% covered</b>
<pre>
<font color="black">   1. # Copyright 2015 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. import os</font>
<font color="black">  14. </font>
<font color="green">  15. import boto3</font>
<font color="green">  16. from botocore.exceptions import DataNotFoundError</font>
<font color="green">  17. from botocore.docs.service import ServiceDocumenter as BaseServiceDocumenter</font>
<font color="green">  18. from botocore.docs.bcdoc.restdoc import DocumentStructure</font>
<font color="black">  19. </font>
<font color="green">  20. from boto3.utils import ServiceContext</font>
<font color="green">  21. from boto3.docs.client import Boto3ClientDocumenter</font>
<font color="green">  22. from boto3.docs.resource import ResourceDocumenter</font>
<font color="green">  23. from boto3.docs.resource import ServiceResourceDocumenter</font>
<font color="black">  24. </font>
<font color="black">  25. </font>
<font color="green">  26. class ServiceDocumenter(BaseServiceDocumenter):</font>
<font color="black">  27.     # The path used to find examples</font>
<font color="green">  28.     EXAMPLE_PATH = os.path.join(os.path.dirname(boto3.__file__), 'examples')</font>
<font color="black">  29. </font>
<font color="green">  30.     def __init__(self, service_name, session):</font>
<font color="red">  31.         self._service_name = service_name</font>
<font color="red">  32.         self._boto3_session = session</font>
<font color="black">  33.         # I know that this is an internal attribute, but the botocore session</font>
<font color="black">  34.         # is needed to load the paginator and waiter models.</font>
<font color="red">  35.         self._session = session._session</font>
<font color="red">  36.         self._client = self._boto3_session.client(service_name)</font>
<font color="red">  37.         self._service_resource = None</font>
<font color="red">  38.         if self._service_name in self._boto3_session.get_available_resources():</font>
<font color="red">  39.             self._service_resource = self._boto3_session.resource(service_name)</font>
<font color="black">  40.         self.sections = [</font>
<font color="red">  41.             'title',</font>
<font color="red">  42.             'table-of-contents',</font>
<font color="red">  43.             'client',</font>
<font color="red">  44.             'paginators',</font>
<font color="red">  45.             'waiters',</font>
<font color="red">  46.             'service-resource',</font>
<font color="red">  47.             'resources',</font>
<font color="red">  48.             'examples'</font>
<font color="black">  49.         ]</font>
<font color="black">  50. </font>
<font color="green">  51.     def document_service(self):</font>
<font color="black">  52.         &quot;&quot;&quot;Documents an entire service.</font>
<font color="black">  53. </font>
<font color="black">  54.         :returns: The reStructured text of the documented service.</font>
<font color="black">  55.         &quot;&quot;&quot;</font>
<font color="red">  56.         doc_structure = DocumentStructure(</font>
<font color="red">  57.             self._service_name, section_names=self.sections,</font>
<font color="red">  58.             target='html')</font>
<font color="red">  59.         self.title(doc_structure.get_section('title'))</font>
<font color="red">  60.         self.table_of_contents(doc_structure.get_section('table-of-contents'))</font>
<font color="black">  61. </font>
<font color="red">  62.         self.client_api(doc_structure.get_section('client'))</font>
<font color="red">  63.         self.paginator_api(doc_structure.get_section('paginators'))</font>
<font color="red">  64.         self.waiter_api(doc_structure.get_section('waiters'))</font>
<font color="red">  65.         if self._service_resource:</font>
<font color="red">  66.             self._document_service_resource(</font>
<font color="red">  67.                 doc_structure.get_section('service-resource'))</font>
<font color="red">  68.             self._document_resources(doc_structure.get_section('resources'))</font>
<font color="red">  69.         self._document_examples(doc_structure.get_section('examples'))</font>
<font color="red">  70.         return doc_structure.flush_structure()</font>
<font color="black">  71. </font>
<font color="green">  72.     def client_api(self, section):</font>
<font color="red">  73.         examples = None</font>
<font color="red">  74.         try:</font>
<font color="red">  75.             examples = self.get_examples(self._service_name)</font>
<font color="red">  76.         except DataNotFoundError:</font>
<font color="red">  77.             pass</font>
<font color="black">  78. </font>
<font color="red">  79.         Boto3ClientDocumenter(self._client, examples).document_client(section)</font>
<font color="black">  80. </font>
<font color="green">  81.     def _document_service_resource(self, section):</font>
<font color="red">  82.         ServiceResourceDocumenter(</font>
<font color="red">  83.             self._service_resource, self._session).document_resource(</font>
<font color="red">  84.                 section)</font>
<font color="black">  85. </font>
<font color="green">  86.     def _document_resources(self, section):</font>
<font color="red">  87.         temp_identifier_value = 'foo'</font>
<font color="red">  88.         loader = self._session.get_component('data_loader')</font>
<font color="red">  89.         json_resource_model = loader.load_service_model(</font>
<font color="red">  90.             self._service_name, 'resources-1')</font>
<font color="red">  91.         service_model = self._service_resource.meta.client.meta.service_model</font>
<font color="red">  92.         for resource_name in json_resource_model['resources']:</font>
<font color="red">  93.             resource_model = json_resource_model['resources'][resource_name]</font>
<font color="red">  94.             resource_cls = self._boto3_session.resource_factory.\</font>
<font color="black">  95.                 load_from_definition(</font>
<font color="red">  96.                     resource_name=resource_name,</font>
<font color="red">  97.                     single_resource_json_definition=resource_model,</font>
<font color="red">  98.                     service_context=ServiceContext(</font>
<font color="red">  99.                         service_name=self._service_name,</font>
<font color="red"> 100.                         resource_json_definitions=json_resource_model[</font>
<font color="red"> 101.                             'resources'],</font>
<font color="red"> 102.                         service_model=service_model,</font>
<font color="red"> 103.                         service_waiter_model=None</font>
<font color="black"> 104.                     )</font>
<font color="black"> 105.                 )</font>
<font color="red"> 106.             identifiers = resource_cls.meta.resource_model.identifiers</font>
<font color="red"> 107.             args = []</font>
<font color="red"> 108.             for _ in identifiers:</font>
<font color="red"> 109.                 args.append(temp_identifier_value)</font>
<font color="red"> 110.             resource = resource_cls(*args, client=self._client)</font>
<font color="red"> 111.             ResourceDocumenter(</font>
<font color="red"> 112.                 resource, self._session).document_resource(</font>
<font color="red"> 113.                     section.add_new_section(resource.meta.resource_model.name))</font>
<font color="black"> 114. </font>
<font color="green"> 115.     def _get_example_file(self):</font>
<font color="red"> 116.         return os.path.realpath(</font>
<font color="red"> 117.             os.path.join(self.EXAMPLE_PATH,</font>
<font color="red"> 118.                          self._service_name + '.rst'))</font>
<font color="black"> 119. </font>
<font color="green"> 120.     def _document_examples(self, section):</font>
<font color="red"> 121.         examples_file = self._get_example_file()</font>
<font color="red"> 122.         if os.path.isfile(examples_file):</font>
<font color="red"> 123.             section.style.h2('Examples')</font>
<font color="red"> 124.             section.style.new_line()</font>
<font color="red"> 125.             section.write(&quot;.. contents::\n    :local:\n    :depth: 1&quot;)</font>
<font color="red"> 126.             section.style.new_line()</font>
<font color="red"> 127.             section.style.new_line()</font>
<font color="red"> 128.             with open(examples_file, 'r') as f:</font>
<font color="red"> 129.                 section.write(f.read())</font>
</pre>

