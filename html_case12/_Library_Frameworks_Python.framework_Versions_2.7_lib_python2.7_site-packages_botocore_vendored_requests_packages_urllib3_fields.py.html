source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/vendored/requests/packages/urllib3/fields.py</b><br>


file stats: <b>72 lines, 14 executed: 19.4% covered</b>
<pre>
<font color="green">   1. import email.utils</font>
<font color="green">   2. import mimetypes</font>
<font color="black">   3. </font>
<font color="green">   4. from .packages import six</font>
<font color="black">   5. </font>
<font color="black">   6. </font>
<font color="green">   7. def guess_content_type(filename, default='application/octet-stream'):</font>
<font color="black">   8.     &quot;&quot;&quot;</font>
<font color="black">   9.     Guess the &quot;Content-Type&quot; of a file.</font>
<font color="black">  10. </font>
<font color="black">  11.     :param filename:</font>
<font color="black">  12.         The filename to guess the &quot;Content-Type&quot; of using :mod:`mimetypes`.</font>
<font color="black">  13.     :param default:</font>
<font color="black">  14.         If no &quot;Content-Type&quot; can be guessed, default to `default`.</font>
<font color="black">  15.     &quot;&quot;&quot;</font>
<font color="red">  16.     if filename:</font>
<font color="red">  17.         return mimetypes.guess_type(filename)[0] or default</font>
<font color="red">  18.     return default</font>
<font color="black">  19. </font>
<font color="black">  20. </font>
<font color="green">  21. def format_header_param(name, value):</font>
<font color="black">  22.     &quot;&quot;&quot;</font>
<font color="black">  23.     Helper function to format and quote a single header parameter.</font>
<font color="black">  24. </font>
<font color="black">  25.     Particularly useful for header parameters which might contain</font>
<font color="black">  26.     non-ASCII values, like file names. This follows RFC 2231, as</font>
<font color="black">  27.     suggested by RFC 2388 Section 4.4.</font>
<font color="black">  28. </font>
<font color="black">  29.     :param name:</font>
<font color="black">  30.         The name of the parameter, a string expected to be ASCII only.</font>
<font color="black">  31.     :param value:</font>
<font color="black">  32.         The value of the parameter, provided as a unicode string.</font>
<font color="black">  33.     &quot;&quot;&quot;</font>
<font color="red">  34.     if not any(ch in value for ch in '&quot;\\\r\n'):</font>
<font color="red">  35.         result = '%s=&quot;%s&quot;' % (name, value)</font>
<font color="red">  36.         try:</font>
<font color="red">  37.             result.encode('ascii')</font>
<font color="red">  38.         except UnicodeEncodeError:</font>
<font color="red">  39.             pass</font>
<font color="black">  40.         else:</font>
<font color="red">  41.             return result</font>
<font color="red">  42.     if not six.PY3:  # Python 2:</font>
<font color="red">  43.         value = value.encode('utf-8')</font>
<font color="red">  44.     value = email.utils.encode_rfc2231(value, 'utf-8')</font>
<font color="red">  45.     value = '%s*=%s' % (name, value)</font>
<font color="red">  46.     return value</font>
<font color="black">  47. </font>
<font color="black">  48. </font>
<font color="green">  49. class RequestField(object):</font>
<font color="black">  50.     &quot;&quot;&quot;</font>
<font color="black">  51.     A data container for request body parameters.</font>
<font color="black">  52. </font>
<font color="black">  53.     :param name:</font>
<font color="black">  54.         The name of this request field.</font>
<font color="black">  55.     :param data:</font>
<font color="black">  56.         The data/value body.</font>
<font color="black">  57.     :param filename:</font>
<font color="black">  58.         An optional filename of the request field.</font>
<font color="black">  59.     :param headers:</font>
<font color="black">  60.         An optional dict-like object of headers to initially use for the field.</font>
<font color="green">  61.     &quot;&quot;&quot;</font>
<font color="green">  62.     def __init__(self, name, data, filename=None, headers=None):</font>
<font color="red">  63.         self._name = name</font>
<font color="red">  64.         self._filename = filename</font>
<font color="red">  65.         self.data = data</font>
<font color="red">  66.         self.headers = {}</font>
<font color="red">  67.         if headers:</font>
<font color="red">  68.             self.headers = dict(headers)</font>
<font color="black">  69. </font>
<font color="green">  70.     @classmethod</font>
<font color="black">  71.     def from_tuples(cls, fieldname, value):</font>
<font color="black">  72.         &quot;&quot;&quot;</font>
<font color="black">  73.         A :class:`~urllib3.fields.RequestField` factory from old-style tuple parameters.</font>
<font color="black">  74. </font>
<font color="black">  75.         Supports constructing :class:`~urllib3.fields.RequestField` from</font>
<font color="black">  76.         parameter of key/value strings AND key/filetuple. A filetuple is a</font>
<font color="black">  77.         (filename, data, MIME type) tuple where the MIME type is optional.</font>
<font color="black">  78.         For example::</font>
<font color="black">  79. </font>
<font color="black">  80.             'foo': 'bar',</font>
<font color="black">  81.             'fakefile': ('foofile.txt', 'contents of foofile'),</font>
<font color="black">  82.             'realfile': ('barfile.txt', open('realfile').read()),</font>
<font color="black">  83.             'typedfile': ('bazfile.bin', open('bazfile').read(), 'image/jpeg'),</font>
<font color="black">  84.             'nonamefile': 'contents of nonamefile field',</font>
<font color="black">  85. </font>
<font color="black">  86.         Field names and filenames must be unicode.</font>
<font color="black">  87.         &quot;&quot;&quot;</font>
<font color="red">  88.         if isinstance(value, tuple):</font>
<font color="red">  89.             if len(value) == 3:</font>
<font color="red">  90.                 filename, data, content_type = value</font>
<font color="black">  91.             else:</font>
<font color="red">  92.                 filename, data = value</font>
<font color="red">  93.                 content_type = guess_content_type(filename)</font>
<font color="black">  94.         else:</font>
<font color="red">  95.             filename = None</font>
<font color="red">  96.             content_type = None</font>
<font color="red">  97.             data = value</font>
<font color="black">  98. </font>
<font color="red">  99.         request_param = cls(fieldname, data, filename=filename)</font>
<font color="red"> 100.         request_param.make_multipart(content_type=content_type)</font>
<font color="black"> 101. </font>
<font color="red"> 102.         return request_param</font>
<font color="black"> 103. </font>
<font color="green"> 104.     def _render_part(self, name, value):</font>
<font color="black"> 105.         &quot;&quot;&quot;</font>
<font color="black"> 106.         Overridable helper function to format a single header parameter.</font>
<font color="black"> 107. </font>
<font color="black"> 108.         :param name:</font>
<font color="black"> 109.             The name of the parameter, a string expected to be ASCII only.</font>
<font color="black"> 110.         :param value:</font>
<font color="black"> 111.             The value of the parameter, provided as a unicode string.</font>
<font color="black"> 112.         &quot;&quot;&quot;</font>
<font color="red"> 113.         return format_header_param(name, value)</font>
<font color="black"> 114. </font>
<font color="green"> 115.     def _render_parts(self, header_parts):</font>
<font color="black"> 116.         &quot;&quot;&quot;</font>
<font color="black"> 117.         Helper function to format and quote a single header.</font>
<font color="black"> 118. </font>
<font color="black"> 119.         Useful for single headers that are composed of multiple items. E.g.,</font>
<font color="black"> 120.         'Content-Disposition' fields.</font>
<font color="black"> 121. </font>
<font color="black"> 122.         :param header_parts:</font>
<font color="black"> 123.             A sequence of (k, v) typles or a :class:`dict` of (k, v) to format</font>
<font color="black"> 124.             as `k1=&quot;v1&quot;; k2=&quot;v2&quot;; ...`.</font>
<font color="black"> 125.         &quot;&quot;&quot;</font>
<font color="red"> 126.         parts = []</font>
<font color="red"> 127.         iterable = header_parts</font>
<font color="red"> 128.         if isinstance(header_parts, dict):</font>
<font color="red"> 129.             iterable = header_parts.items()</font>
<font color="black"> 130. </font>
<font color="red"> 131.         for name, value in iterable:</font>
<font color="red"> 132.             if value:</font>
<font color="red"> 133.                 parts.append(self._render_part(name, value))</font>
<font color="black"> 134. </font>
<font color="red"> 135.         return '; '.join(parts)</font>
<font color="black"> 136. </font>
<font color="green"> 137.     def render_headers(self):</font>
<font color="black"> 138.         &quot;&quot;&quot;</font>
<font color="black"> 139.         Renders the headers for this request field.</font>
<font color="black"> 140.         &quot;&quot;&quot;</font>
<font color="red"> 141.         lines = []</font>
<font color="black"> 142. </font>
<font color="red"> 143.         sort_keys = ['Content-Disposition', 'Content-Type', 'Content-Location']</font>
<font color="red"> 144.         for sort_key in sort_keys:</font>
<font color="red"> 145.             if self.headers.get(sort_key, False):</font>
<font color="red"> 146.                 lines.append('%s: %s' % (sort_key, self.headers[sort_key]))</font>
<font color="black"> 147. </font>
<font color="red"> 148.         for header_name, header_value in self.headers.items():</font>
<font color="red"> 149.             if header_name not in sort_keys:</font>
<font color="red"> 150.                 if header_value:</font>
<font color="red"> 151.                     lines.append('%s: %s' % (header_name, header_value))</font>
<font color="black"> 152. </font>
<font color="red"> 153.         lines.append('\r\n')</font>
<font color="red"> 154.         return '\r\n'.join(lines)</font>
<font color="black"> 155. </font>
<font color="green"> 156.     def make_multipart(self, content_disposition=None, content_type=None,</font>
<font color="green"> 157.                        content_location=None):</font>
<font color="black"> 158.         &quot;&quot;&quot;</font>
<font color="black"> 159.         Makes this request field into a multipart request field.</font>
<font color="black"> 160. </font>
<font color="black"> 161.         This method overrides &quot;Content-Disposition&quot;, &quot;Content-Type&quot; and</font>
<font color="black"> 162.         &quot;Content-Location&quot; headers to the request parameter.</font>
<font color="black"> 163. </font>
<font color="black"> 164.         :param content_type:</font>
<font color="black"> 165.             The 'Content-Type' of the request body.</font>
<font color="black"> 166.         :param content_location:</font>
<font color="black"> 167.             The 'Content-Location' of the request body.</font>
<font color="black"> 168. </font>
<font color="black"> 169.         &quot;&quot;&quot;</font>
<font color="red"> 170.         self.headers['Content-Disposition'] = content_disposition or 'form-data'</font>
<font color="red"> 171.         self.headers['Content-Disposition'] += '; '.join([</font>
<font color="red"> 172.             '', self._render_parts(</font>
<font color="red"> 173.                 (('name', self._name), ('filename', self._filename))</font>
<font color="black"> 174.             )</font>
<font color="black"> 175.         ])</font>
<font color="red"> 176.         self.headers['Content-Type'] = content_type</font>
<font color="red"> 177.         self.headers['Content-Location'] = content_location</font>
</pre>

