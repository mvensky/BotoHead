source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/ndg/httpsclient/subj_alt_name.py</b><br>


file stats: <b>104 lines, 96 executed: 92.3% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;NDG HTTPS Client package</font>
<font color="black">   2. </font>
<font color="black">   3. Use pyasn1 to provide support for parsing ASN.1 formatted subjectAltName</font>
<font color="black">   4. content for SSL peer verification.  Code based on:</font>
<font color="black">   5. </font>
<font color="black">   6. http://stackoverflow.com/questions/5519958/how-do-i-parse-subjectaltname-extension-data-using-pyasn1</font>
<font color="green">   7. &quot;&quot;&quot;</font>
<font color="green">   8. __author__ = &quot;P J Kershaw&quot;</font>
<font color="green">   9. __date__ = &quot;01/02/12&quot;</font>
<font color="green">  10. __copyright__ = &quot;(C) 2012 Science and Technology Facilities Council&quot;</font>
<font color="green">  11. __license__ = &quot;BSD - see LICENSE file in top-level directory&quot;</font>
<font color="green">  12. __contact__ = &quot;Philip.Kershaw@stfc.ac.uk&quot;</font>
<font color="green">  13. __revision__ = '$Id$'</font>
<font color="green">  14. try:</font>
<font color="green">  15.     from pyasn1.type import univ, constraint, char, namedtype, tag</font>
<font color="black">  16. </font>
<font color="red">  17. except ImportError as e:</font>
<font color="red">  18.     import_error_msg = ('Error importing pyasn1, subjectAltName check for SSL '</font>
<font color="black">  19.                         'peer verification will be disabled.  Import error '</font>
<font color="red">  20.                         'is: %s' % e)</font>
<font color="red">  21.     import warnings</font>
<font color="red">  22.     warnings.warn(import_error_msg)</font>
<font color="red">  23.     class Pyasn1ImportError(ImportError):</font>
<font color="red">  24.         &quot;Raise for pyasn1 import error&quot;</font>
<font color="red">  25.     raise Pyasn1ImportError(import_error_msg)</font>
<font color="black">  26. </font>
<font color="black">  27. </font>
<font color="green">  28. MAX = 64</font>
<font color="black">  29. </font>
<font color="black">  30. </font>
<font color="green">  31. class DirectoryString(univ.Choice):</font>
<font color="green">  32.     &quot;&quot;&quot;ASN.1 Directory string class&quot;&quot;&quot;</font>
<font color="green">  33.     componentType = namedtype.NamedTypes(</font>
<font color="green">  34.         namedtype.NamedType(</font>
<font color="green">  35.             'teletexString', char.TeletexString().subtype(</font>
<font color="green">  36.                 subtypeSpec=constraint.ValueSizeConstraint(1, MAX))),</font>
<font color="green">  37.         namedtype.NamedType(</font>
<font color="green">  38.             'printableString', char.PrintableString().subtype(</font>
<font color="green">  39.                 subtypeSpec=constraint.ValueSizeConstraint(1, MAX))),</font>
<font color="green">  40.         namedtype.NamedType(</font>
<font color="green">  41.             'universalString', char.UniversalString().subtype(</font>
<font color="green">  42.                 subtypeSpec=constraint.ValueSizeConstraint(1, MAX))),</font>
<font color="green">  43.         namedtype.NamedType(</font>
<font color="green">  44.             'utf8String', char.UTF8String().subtype(</font>
<font color="green">  45.                 subtypeSpec=constraint.ValueSizeConstraint(1, MAX))),</font>
<font color="green">  46.         namedtype.NamedType(</font>
<font color="green">  47.             'bmpString', char.BMPString().subtype(</font>
<font color="green">  48.                 subtypeSpec=constraint.ValueSizeConstraint(1, MAX))),</font>
<font color="green">  49.         namedtype.NamedType(</font>
<font color="green">  50.             'ia5String', char.IA5String().subtype(</font>
<font color="green">  51.                 subtypeSpec=constraint.ValueSizeConstraint(1, MAX))),</font>
<font color="black">  52.         )</font>
<font color="black">  53. </font>
<font color="black">  54. </font>
<font color="green">  55. class AttributeValue(DirectoryString):</font>
<font color="green">  56.     &quot;&quot;&quot;ASN.1 Attribute value&quot;&quot;&quot;</font>
<font color="black">  57. </font>
<font color="black">  58. </font>
<font color="green">  59. class AttributeType(univ.ObjectIdentifier):</font>
<font color="green">  60.     &quot;&quot;&quot;ASN.1 Attribute type&quot;&quot;&quot;</font>
<font color="black">  61. </font>
<font color="black">  62. </font>
<font color="green">  63. class AttributeTypeAndValue(univ.Sequence):</font>
<font color="green">  64.     &quot;&quot;&quot;ASN.1 Attribute type and value class&quot;&quot;&quot;</font>
<font color="green">  65.     componentType = namedtype.NamedTypes(</font>
<font color="green">  66.         namedtype.NamedType('type', AttributeType()),</font>
<font color="green">  67.         namedtype.NamedType('value', AttributeValue()),</font>
<font color="black">  68.         )</font>
<font color="black">  69. </font>
<font color="black">  70. </font>
<font color="green">  71. class RelativeDistinguishedName(univ.SetOf):</font>
<font color="green">  72.     '''ASN.1 Realtive distinguished name'''</font>
<font color="green">  73.     componentType = AttributeTypeAndValue()</font>
<font color="black">  74. </font>
<font color="green">  75. class RDNSequence(univ.SequenceOf):</font>
<font color="green">  76.     '''ASN.1 RDN sequence class'''</font>
<font color="green">  77.     componentType = RelativeDistinguishedName()</font>
<font color="black">  78. </font>
<font color="black">  79. </font>
<font color="green">  80. class Name(univ.Choice):</font>
<font color="green">  81.     '''ASN.1 name class'''</font>
<font color="green">  82.     componentType = namedtype.NamedTypes(</font>
<font color="green">  83.         namedtype.NamedType('', RDNSequence()),</font>
<font color="black">  84.         )</font>
<font color="black">  85. </font>
<font color="black">  86. </font>
<font color="green">  87. class Extension(univ.Sequence):</font>
<font color="green">  88.     '''ASN.1 extension class'''</font>
<font color="green">  89.     componentType = namedtype.NamedTypes(</font>
<font color="green">  90.         namedtype.NamedType('extnID', univ.ObjectIdentifier()),</font>
<font color="green">  91.         namedtype.DefaultedNamedType('critical', univ.Boolean('False')),</font>
<font color="green">  92.         namedtype.NamedType('extnValue', univ.OctetString()),</font>
<font color="black">  93.         )</font>
<font color="black">  94. </font>
<font color="black">  95. </font>
<font color="green">  96. class Extensions(univ.SequenceOf):</font>
<font color="green">  97.     '''ASN.1 extensions class'''</font>
<font color="green">  98.     componentType = Extension()</font>
<font color="green">  99.     sizeSpec = univ.SequenceOf.sizeSpec + constraint.ValueSizeConstraint(1, MAX)</font>
<font color="black"> 100. </font>
<font color="black"> 101. </font>
<font color="green"> 102. class AnotherName(univ.Sequence):</font>
<font color="green"> 103.     componentType = namedtype.NamedTypes(</font>
<font color="green"> 104.         namedtype.NamedType('type-id', univ.ObjectIdentifier()),</font>
<font color="green"> 105.         namedtype.NamedType('value', univ.Any().subtype(</font>
<font color="green"> 106.                             explicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 107.                                                 tag.tagFormatSimple, 0)))</font>
<font color="black"> 108.         )</font>
<font color="black"> 109. </font>
<font color="black"> 110. </font>
<font color="green"> 111. class GeneralName(univ.Choice):</font>
<font color="green"> 112.     '''ASN.1 configuration for X.509 certificate subjectAltNames fields'''</font>
<font color="green"> 113.     componentType = namedtype.NamedTypes(</font>
<font color="green"> 114.         namedtype.NamedType('otherName', AnotherName().subtype(</font>
<font color="green"> 115.                             implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 116.                                                 tag.tagFormatSimple, 0))),</font>
<font color="green"> 117.         namedtype.NamedType('rfc822Name', char.IA5String().subtype(</font>
<font color="green"> 118.                             implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 119.                                                 tag.tagFormatSimple, 1))),</font>
<font color="green"> 120.         namedtype.NamedType('dNSName', char.IA5String().subtype(</font>
<font color="green"> 121.                             implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 122.                                                 tag.tagFormatSimple, 2))),</font>
<font color="black"> 123. #        namedtype.NamedType('x400Address', ORAddress().subtype(</font>
<font color="black"> 124. #                            implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="black"> 125. #                                                tag.tagFormatSimple, 3))),</font>
<font color="green"> 126.         namedtype.NamedType('directoryName', Name().subtype(</font>
<font color="green"> 127.                             implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 128.                                                 tag.tagFormatSimple, 4))),</font>
<font color="black"> 129. #        namedtype.NamedType('ediPartyName', EDIPartyName().subtype(</font>
<font color="black"> 130. #                            implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="black"> 131. #                                                tag.tagFormatSimple, 5))),</font>
<font color="green"> 132.         namedtype.NamedType('uniformResourceIdentifier', char.IA5String().subtype(</font>
<font color="green"> 133.                             implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 134.                                                 tag.tagFormatSimple, 6))),</font>
<font color="green"> 135.         namedtype.NamedType('iPAddress', univ.OctetString().subtype(</font>
<font color="green"> 136.                             implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 137.                                                 tag.tagFormatSimple, 7))),</font>
<font color="green"> 138.         namedtype.NamedType('registeredID', univ.ObjectIdentifier().subtype(</font>
<font color="green"> 139.                             implicitTag=tag.Tag(tag.tagClassContext,</font>
<font color="green"> 140.                                                 tag.tagFormatSimple, 8))),</font>
<font color="black"> 141.         )</font>
<font color="black"> 142. </font>
<font color="black"> 143. </font>
<font color="green"> 144. class GeneralNames(univ.SequenceOf):</font>
<font color="green"> 145.     '''Sequence of names for ASN.1 subjectAltNames settings'''</font>
<font color="green"> 146.     componentType = GeneralName()</font>
<font color="green"> 147.     sizeSpec = univ.SequenceOf.sizeSpec + constraint.ValueSizeConstraint(1, MAX)</font>
<font color="black"> 148. </font>
<font color="black"> 149. </font>
<font color="green"> 150. class SubjectAltName(GeneralNames):</font>
<font color="green"> 151.     '''ASN.1 implementation for subjectAltNames support'''</font>
<font color="black"> 152. </font>
<font color="black"> 153. </font>
</pre>

