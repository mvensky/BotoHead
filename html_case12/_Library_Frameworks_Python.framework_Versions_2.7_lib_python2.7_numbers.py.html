source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/numbers.py</b><br>


file stats: <b>137 lines, 82 executed: 59.9% covered</b>
<pre>
<font color="black">   1. # Copyright 2007 Google, Inc. All Rights Reserved.</font>
<font color="black">   2. # Licensed to PSF under a Contributor Agreement.</font>
<font color="black">   3. </font>
<font color="black">   4. &quot;&quot;&quot;Abstract Base Classes (ABCs) for numbers, according to PEP 3141.</font>
<font color="black">   5. </font>
<font color="green">   6. TODO: Fill out more detailed documentation on the operators.&quot;&quot;&quot;</font>
<font color="black">   7. </font>
<font color="green">   8. from __future__ import division</font>
<font color="green">   9. from abc import ABCMeta, abstractmethod, abstractproperty</font>
<font color="black">  10. </font>
<font color="green">  11. __all__ = [&quot;Number&quot;, &quot;Complex&quot;, &quot;Real&quot;, &quot;Rational&quot;, &quot;Integral&quot;]</font>
<font color="black">  12. </font>
<font color="green">  13. class Number(object):</font>
<font color="black">  14.     &quot;&quot;&quot;All numbers inherit from this class.</font>
<font color="black">  15. </font>
<font color="black">  16.     If you just want to check if an argument x is a number, without</font>
<font color="black">  17.     caring what kind, use isinstance(x, Number).</font>
<font color="green">  18.     &quot;&quot;&quot;</font>
<font color="green">  19.     __metaclass__ = ABCMeta</font>
<font color="green">  20.     __slots__ = ()</font>
<font color="black">  21. </font>
<font color="black">  22.     # Concrete numeric types must provide their own hash implementation</font>
<font color="green">  23.     __hash__ = None</font>
<font color="black">  24. </font>
<font color="black">  25. </font>
<font color="black">  26. ## Notes on Decimal</font>
<font color="black">  27. ## ----------------</font>
<font color="black">  28. ## Decimal has all of the methods specified by the Real abc, but it should</font>
<font color="black">  29. ## not be registered as a Real because decimals do not interoperate with</font>
<font color="black">  30. ## binary floats (i.e.  Decimal('3.14') + 2.71828 is undefined).  But,</font>
<font color="black">  31. ## abstract reals are expected to interoperate (i.e. R1 + R2 should be</font>
<font color="black">  32. ## expected to work if R1 and R2 are both Reals).</font>
<font color="black">  33. </font>
<font color="green">  34. class Complex(Number):</font>
<font color="black">  35.     &quot;&quot;&quot;Complex defines the operations that work on the builtin complex type.</font>
<font color="black">  36. </font>
<font color="black">  37.     In short, those are: a conversion to complex, .real, .imag, +, -,</font>
<font color="black">  38.     *, /, abs(), .conjugate, ==, and !=.</font>
<font color="black">  39. </font>
<font color="black">  40.     If it is given heterogenous arguments, and doesn't have special</font>
<font color="black">  41.     knowledge about them, it should fall back to the builtin complex</font>
<font color="black">  42.     type as described below.</font>
<font color="green">  43.     &quot;&quot;&quot;</font>
<font color="black">  44. </font>
<font color="green">  45.     __slots__ = ()</font>
<font color="black">  46. </font>
<font color="green">  47.     @abstractmethod</font>
<font color="black">  48.     def __complex__(self):</font>
<font color="black">  49.         &quot;&quot;&quot;Return a builtin complex instance. Called for complex(self).&quot;&quot;&quot;</font>
<font color="black">  50. </font>
<font color="black">  51.     # Will be __bool__ in 3.0.</font>
<font color="green">  52.     def __nonzero__(self):</font>
<font color="black">  53.         &quot;&quot;&quot;True if self != 0. Called for bool(self).&quot;&quot;&quot;</font>
<font color="red">  54.         return self != 0</font>
<font color="black">  55. </font>
<font color="green">  56.     @abstractproperty</font>
<font color="black">  57.     def real(self):</font>
<font color="black">  58.         &quot;&quot;&quot;Retrieve the real component of this number.</font>
<font color="black">  59. </font>
<font color="black">  60.         This should subclass Real.</font>
<font color="black">  61.         &quot;&quot;&quot;</font>
<font color="red">  62.         raise NotImplementedError</font>
<font color="black">  63. </font>
<font color="green">  64.     @abstractproperty</font>
<font color="black">  65.     def imag(self):</font>
<font color="black">  66.         &quot;&quot;&quot;Retrieve the imaginary component of this number.</font>
<font color="black">  67. </font>
<font color="black">  68.         This should subclass Real.</font>
<font color="black">  69.         &quot;&quot;&quot;</font>
<font color="red">  70.         raise NotImplementedError</font>
<font color="black">  71. </font>
<font color="green">  72.     @abstractmethod</font>
<font color="black">  73.     def __add__(self, other):</font>
<font color="black">  74.         &quot;&quot;&quot;self + other&quot;&quot;&quot;</font>
<font color="red">  75.         raise NotImplementedError</font>
<font color="black">  76. </font>
<font color="green">  77.     @abstractmethod</font>
<font color="black">  78.     def __radd__(self, other):</font>
<font color="black">  79.         &quot;&quot;&quot;other + self&quot;&quot;&quot;</font>
<font color="red">  80.         raise NotImplementedError</font>
<font color="black">  81. </font>
<font color="green">  82.     @abstractmethod</font>
<font color="black">  83.     def __neg__(self):</font>
<font color="black">  84.         &quot;&quot;&quot;-self&quot;&quot;&quot;</font>
<font color="red">  85.         raise NotImplementedError</font>
<font color="black">  86. </font>
<font color="green">  87.     @abstractmethod</font>
<font color="black">  88.     def __pos__(self):</font>
<font color="black">  89.         &quot;&quot;&quot;+self&quot;&quot;&quot;</font>
<font color="red">  90.         raise NotImplementedError</font>
<font color="black">  91. </font>
<font color="green">  92.     def __sub__(self, other):</font>
<font color="black">  93.         &quot;&quot;&quot;self - other&quot;&quot;&quot;</font>
<font color="red">  94.         return self + -other</font>
<font color="black">  95. </font>
<font color="green">  96.     def __rsub__(self, other):</font>
<font color="black">  97.         &quot;&quot;&quot;other - self&quot;&quot;&quot;</font>
<font color="red">  98.         return -self + other</font>
<font color="black">  99. </font>
<font color="green"> 100.     @abstractmethod</font>
<font color="black"> 101.     def __mul__(self, other):</font>
<font color="black"> 102.         &quot;&quot;&quot;self * other&quot;&quot;&quot;</font>
<font color="red"> 103.         raise NotImplementedError</font>
<font color="black"> 104. </font>
<font color="green"> 105.     @abstractmethod</font>
<font color="black"> 106.     def __rmul__(self, other):</font>
<font color="black"> 107.         &quot;&quot;&quot;other * self&quot;&quot;&quot;</font>
<font color="red"> 108.         raise NotImplementedError</font>
<font color="black"> 109. </font>
<font color="green"> 110.     @abstractmethod</font>
<font color="black"> 111.     def __div__(self, other):</font>
<font color="black"> 112.         &quot;&quot;&quot;self / other without __future__ division</font>
<font color="black"> 113. </font>
<font color="black"> 114.         May promote to float.</font>
<font color="black"> 115.         &quot;&quot;&quot;</font>
<font color="red"> 116.         raise NotImplementedError</font>
<font color="black"> 117. </font>
<font color="green"> 118.     @abstractmethod</font>
<font color="black"> 119.     def __rdiv__(self, other):</font>
<font color="black"> 120.         &quot;&quot;&quot;other / self without __future__ division&quot;&quot;&quot;</font>
<font color="red"> 121.         raise NotImplementedError</font>
<font color="black"> 122. </font>
<font color="green"> 123.     @abstractmethod</font>
<font color="black"> 124.     def __truediv__(self, other):</font>
<font color="black"> 125.         &quot;&quot;&quot;self / other with __future__ division.</font>
<font color="black"> 126. </font>
<font color="black"> 127.         Should promote to float when necessary.</font>
<font color="black"> 128.         &quot;&quot;&quot;</font>
<font color="red"> 129.         raise NotImplementedError</font>
<font color="black"> 130. </font>
<font color="green"> 131.     @abstractmethod</font>
<font color="black"> 132.     def __rtruediv__(self, other):</font>
<font color="black"> 133.         &quot;&quot;&quot;other / self with __future__ division&quot;&quot;&quot;</font>
<font color="red"> 134.         raise NotImplementedError</font>
<font color="black"> 135. </font>
<font color="green"> 136.     @abstractmethod</font>
<font color="black"> 137.     def __pow__(self, exponent):</font>
<font color="black"> 138.         &quot;&quot;&quot;self**exponent; should promote to float or complex when necessary.&quot;&quot;&quot;</font>
<font color="red"> 139.         raise NotImplementedError</font>
<font color="black"> 140. </font>
<font color="green"> 141.     @abstractmethod</font>
<font color="black"> 142.     def __rpow__(self, base):</font>
<font color="black"> 143.         &quot;&quot;&quot;base ** self&quot;&quot;&quot;</font>
<font color="red"> 144.         raise NotImplementedError</font>
<font color="black"> 145. </font>
<font color="green"> 146.     @abstractmethod</font>
<font color="black"> 147.     def __abs__(self):</font>
<font color="black"> 148.         &quot;&quot;&quot;Returns the Real distance from 0. Called for abs(self).&quot;&quot;&quot;</font>
<font color="red"> 149.         raise NotImplementedError</font>
<font color="black"> 150. </font>
<font color="green"> 151.     @abstractmethod</font>
<font color="black"> 152.     def conjugate(self):</font>
<font color="black"> 153.         &quot;&quot;&quot;(x+y*i).conjugate() returns (x-y*i).&quot;&quot;&quot;</font>
<font color="red"> 154.         raise NotImplementedError</font>
<font color="black"> 155. </font>
<font color="green"> 156.     @abstractmethod</font>
<font color="black"> 157.     def __eq__(self, other):</font>
<font color="black"> 158.         &quot;&quot;&quot;self == other&quot;&quot;&quot;</font>
<font color="red"> 159.         raise NotImplementedError</font>
<font color="black"> 160. </font>
<font color="green"> 161.     def __ne__(self, other):</font>
<font color="black"> 162.         &quot;&quot;&quot;self != other&quot;&quot;&quot;</font>
<font color="black"> 163.         # The default __ne__ doesn't negate __eq__ until 3.0.</font>
<font color="red"> 164.         return not (self == other)</font>
<font color="black"> 165. </font>
<font color="green"> 166. Complex.register(complex)</font>
<font color="black"> 167. </font>
<font color="black"> 168. </font>
<font color="green"> 169. class Real(Complex):</font>
<font color="black"> 170.     &quot;&quot;&quot;To Complex, Real adds the operations that work on real numbers.</font>
<font color="black"> 171. </font>
<font color="black"> 172.     In short, those are: a conversion to float, trunc(), divmod,</font>
<font color="black"> 173.     %, &lt;, &lt;=, &gt;, and &gt;=.</font>
<font color="black"> 174. </font>
<font color="black"> 175.     Real also provides defaults for the derived operations.</font>
<font color="green"> 176.     &quot;&quot;&quot;</font>
<font color="black"> 177. </font>
<font color="green"> 178.     __slots__ = ()</font>
<font color="black"> 179. </font>
<font color="green"> 180.     @abstractmethod</font>
<font color="black"> 181.     def __float__(self):</font>
<font color="black"> 182.         &quot;&quot;&quot;Any Real can be converted to a native float object.</font>
<font color="black"> 183. </font>
<font color="black"> 184.         Called for float(self).&quot;&quot;&quot;</font>
<font color="red"> 185.         raise NotImplementedError</font>
<font color="black"> 186. </font>
<font color="green"> 187.     @abstractmethod</font>
<font color="black"> 188.     def __trunc__(self):</font>
<font color="black"> 189.         &quot;&quot;&quot;trunc(self): Truncates self to an Integral.</font>
<font color="black"> 190. </font>
<font color="black"> 191.         Returns an Integral i such that:</font>
<font color="black"> 192.           * i&gt;0 iff self&gt;0;</font>
<font color="black"> 193.           * abs(i) &lt;= abs(self);</font>
<font color="black"> 194.           * for any Integral j satisfying the first two conditions,</font>
<font color="black"> 195.             abs(i) &gt;= abs(j) [i.e. i has &quot;maximal&quot; abs among those].</font>
<font color="black"> 196.         i.e. &quot;truncate towards 0&quot;.</font>
<font color="black"> 197.         &quot;&quot;&quot;</font>
<font color="red"> 198.         raise NotImplementedError</font>
<font color="black"> 199. </font>
<font color="green"> 200.     def __divmod__(self, other):</font>
<font color="black"> 201.         &quot;&quot;&quot;divmod(self, other): The pair (self // other, self % other).</font>
<font color="black"> 202. </font>
<font color="black"> 203.         Sometimes this can be computed faster than the pair of</font>
<font color="black"> 204.         operations.</font>
<font color="black"> 205.         &quot;&quot;&quot;</font>
<font color="red"> 206.         return (self // other, self % other)</font>
<font color="black"> 207. </font>
<font color="green"> 208.     def __rdivmod__(self, other):</font>
<font color="black"> 209.         &quot;&quot;&quot;divmod(other, self): The pair (self // other, self % other).</font>
<font color="black"> 210. </font>
<font color="black"> 211.         Sometimes this can be computed faster than the pair of</font>
<font color="black"> 212.         operations.</font>
<font color="black"> 213.         &quot;&quot;&quot;</font>
<font color="red"> 214.         return (other // self, other % self)</font>
<font color="black"> 215. </font>
<font color="green"> 216.     @abstractmethod</font>
<font color="black"> 217.     def __floordiv__(self, other):</font>
<font color="black"> 218.         &quot;&quot;&quot;self // other: The floor() of self/other.&quot;&quot;&quot;</font>
<font color="red"> 219.         raise NotImplementedError</font>
<font color="black"> 220. </font>
<font color="green"> 221.     @abstractmethod</font>
<font color="black"> 222.     def __rfloordiv__(self, other):</font>
<font color="black"> 223.         &quot;&quot;&quot;other // self: The floor() of other/self.&quot;&quot;&quot;</font>
<font color="red"> 224.         raise NotImplementedError</font>
<font color="black"> 225. </font>
<font color="green"> 226.     @abstractmethod</font>
<font color="black"> 227.     def __mod__(self, other):</font>
<font color="black"> 228.         &quot;&quot;&quot;self % other&quot;&quot;&quot;</font>
<font color="red"> 229.         raise NotImplementedError</font>
<font color="black"> 230. </font>
<font color="green"> 231.     @abstractmethod</font>
<font color="black"> 232.     def __rmod__(self, other):</font>
<font color="black"> 233.         &quot;&quot;&quot;other % self&quot;&quot;&quot;</font>
<font color="red"> 234.         raise NotImplementedError</font>
<font color="black"> 235. </font>
<font color="green"> 236.     @abstractmethod</font>
<font color="black"> 237.     def __lt__(self, other):</font>
<font color="black"> 238.         &quot;&quot;&quot;self &lt; other</font>
<font color="black"> 239. </font>
<font color="black"> 240.         &lt; on Reals defines a total ordering, except perhaps for NaN.&quot;&quot;&quot;</font>
<font color="red"> 241.         raise NotImplementedError</font>
<font color="black"> 242. </font>
<font color="green"> 243.     @abstractmethod</font>
<font color="black"> 244.     def __le__(self, other):</font>
<font color="black"> 245.         &quot;&quot;&quot;self &lt;= other&quot;&quot;&quot;</font>
<font color="red"> 246.         raise NotImplementedError</font>
<font color="black"> 247. </font>
<font color="black"> 248.     # Concrete implementations of Complex abstract methods.</font>
<font color="green"> 249.     def __complex__(self):</font>
<font color="black"> 250.         &quot;&quot;&quot;complex(self) == complex(float(self), 0)&quot;&quot;&quot;</font>
<font color="red"> 251.         return complex(float(self))</font>
<font color="black"> 252. </font>
<font color="green"> 253.     @property</font>
<font color="black"> 254.     def real(self):</font>
<font color="black"> 255.         &quot;&quot;&quot;Real numbers are their real component.&quot;&quot;&quot;</font>
<font color="red"> 256.         return +self</font>
<font color="black"> 257. </font>
<font color="green"> 258.     @property</font>
<font color="black"> 259.     def imag(self):</font>
<font color="black"> 260.         &quot;&quot;&quot;Real numbers have no imaginary component.&quot;&quot;&quot;</font>
<font color="red"> 261.         return 0</font>
<font color="black"> 262. </font>
<font color="green"> 263.     def conjugate(self):</font>
<font color="black"> 264.         &quot;&quot;&quot;Conjugate is a no-op for Reals.&quot;&quot;&quot;</font>
<font color="red"> 265.         return +self</font>
<font color="black"> 266. </font>
<font color="green"> 267. Real.register(float)</font>
<font color="black"> 268. </font>
<font color="black"> 269. </font>
<font color="green"> 270. class Rational(Real):</font>
<font color="green"> 271.     &quot;&quot;&quot;.numerator and .denominator should be in lowest terms.&quot;&quot;&quot;</font>
<font color="black"> 272. </font>
<font color="green"> 273.     __slots__ = ()</font>
<font color="black"> 274. </font>
<font color="green"> 275.     @abstractproperty</font>
<font color="black"> 276.     def numerator(self):</font>
<font color="red"> 277.         raise NotImplementedError</font>
<font color="black"> 278. </font>
<font color="green"> 279.     @abstractproperty</font>
<font color="black"> 280.     def denominator(self):</font>
<font color="red"> 281.         raise NotImplementedError</font>
<font color="black"> 282. </font>
<font color="black"> 283.     # Concrete implementation of Real's conversion to float.</font>
<font color="green"> 284.     def __float__(self):</font>
<font color="black"> 285.         &quot;&quot;&quot;float(self) = self.numerator / self.denominator</font>
<font color="black"> 286. </font>
<font color="black"> 287.         It's important that this conversion use the integer's &quot;true&quot;</font>
<font color="black"> 288.         division rather than casting one side to float before dividing</font>
<font color="black"> 289.         so that ratios of huge integers convert without overflowing.</font>
<font color="black"> 290. </font>
<font color="black"> 291.         &quot;&quot;&quot;</font>
<font color="red"> 292.         return self.numerator / self.denominator</font>
<font color="black"> 293. </font>
<font color="black"> 294. </font>
<font color="green"> 295. class Integral(Rational):</font>
<font color="green"> 296.     &quot;&quot;&quot;Integral adds a conversion to long and the bit-string operations.&quot;&quot;&quot;</font>
<font color="black"> 297. </font>
<font color="green"> 298.     __slots__ = ()</font>
<font color="black"> 299. </font>
<font color="green"> 300.     @abstractmethod</font>
<font color="black"> 301.     def __long__(self):</font>
<font color="black"> 302.         &quot;&quot;&quot;long(self)&quot;&quot;&quot;</font>
<font color="red"> 303.         raise NotImplementedError</font>
<font color="black"> 304. </font>
<font color="green"> 305.     def __index__(self):</font>
<font color="black"> 306.         &quot;&quot;&quot;Called whenever an index is needed, such as in slicing&quot;&quot;&quot;</font>
<font color="red"> 307.         return long(self)</font>
<font color="black"> 308. </font>
<font color="green"> 309.     @abstractmethod</font>
<font color="green"> 310.     def __pow__(self, exponent, modulus=None):</font>
<font color="black"> 311.         &quot;&quot;&quot;self ** exponent % modulus, but maybe faster.</font>
<font color="black"> 312. </font>
<font color="black"> 313.         Accept the modulus argument if you want to support the</font>
<font color="black"> 314.         3-argument version of pow(). Raise a TypeError if exponent &lt; 0</font>
<font color="black"> 315.         or any argument isn't Integral. Otherwise, just implement the</font>
<font color="black"> 316.         2-argument version described in Complex.</font>
<font color="black"> 317.         &quot;&quot;&quot;</font>
<font color="red"> 318.         raise NotImplementedError</font>
<font color="black"> 319. </font>
<font color="green"> 320.     @abstractmethod</font>
<font color="black"> 321.     def __lshift__(self, other):</font>
<font color="black"> 322.         &quot;&quot;&quot;self &lt;&lt; other&quot;&quot;&quot;</font>
<font color="red"> 323.         raise NotImplementedError</font>
<font color="black"> 324. </font>
<font color="green"> 325.     @abstractmethod</font>
<font color="black"> 326.     def __rlshift__(self, other):</font>
<font color="black"> 327.         &quot;&quot;&quot;other &lt;&lt; self&quot;&quot;&quot;</font>
<font color="red"> 328.         raise NotImplementedError</font>
<font color="black"> 329. </font>
<font color="green"> 330.     @abstractmethod</font>
<font color="black"> 331.     def __rshift__(self, other):</font>
<font color="black"> 332.         &quot;&quot;&quot;self &gt;&gt; other&quot;&quot;&quot;</font>
<font color="red"> 333.         raise NotImplementedError</font>
<font color="black"> 334. </font>
<font color="green"> 335.     @abstractmethod</font>
<font color="black"> 336.     def __rrshift__(self, other):</font>
<font color="black"> 337.         &quot;&quot;&quot;other &gt;&gt; self&quot;&quot;&quot;</font>
<font color="red"> 338.         raise NotImplementedError</font>
<font color="black"> 339. </font>
<font color="green"> 340.     @abstractmethod</font>
<font color="black"> 341.     def __and__(self, other):</font>
<font color="black"> 342.         &quot;&quot;&quot;self &amp; other&quot;&quot;&quot;</font>
<font color="red"> 343.         raise NotImplementedError</font>
<font color="black"> 344. </font>
<font color="green"> 345.     @abstractmethod</font>
<font color="black"> 346.     def __rand__(self, other):</font>
<font color="black"> 347.         &quot;&quot;&quot;other &amp; self&quot;&quot;&quot;</font>
<font color="red"> 348.         raise NotImplementedError</font>
<font color="black"> 349. </font>
<font color="green"> 350.     @abstractmethod</font>
<font color="black"> 351.     def __xor__(self, other):</font>
<font color="black"> 352.         &quot;&quot;&quot;self ^ other&quot;&quot;&quot;</font>
<font color="red"> 353.         raise NotImplementedError</font>
<font color="black"> 354. </font>
<font color="green"> 355.     @abstractmethod</font>
<font color="black"> 356.     def __rxor__(self, other):</font>
<font color="black"> 357.         &quot;&quot;&quot;other ^ self&quot;&quot;&quot;</font>
<font color="red"> 358.         raise NotImplementedError</font>
<font color="black"> 359. </font>
<font color="green"> 360.     @abstractmethod</font>
<font color="black"> 361.     def __or__(self, other):</font>
<font color="black"> 362.         &quot;&quot;&quot;self | other&quot;&quot;&quot;</font>
<font color="red"> 363.         raise NotImplementedError</font>
<font color="black"> 364. </font>
<font color="green"> 365.     @abstractmethod</font>
<font color="black"> 366.     def __ror__(self, other):</font>
<font color="black"> 367.         &quot;&quot;&quot;other | self&quot;&quot;&quot;</font>
<font color="red"> 368.         raise NotImplementedError</font>
<font color="black"> 369. </font>
<font color="green"> 370.     @abstractmethod</font>
<font color="black"> 371.     def __invert__(self):</font>
<font color="black"> 372.         &quot;&quot;&quot;~self&quot;&quot;&quot;</font>
<font color="red"> 373.         raise NotImplementedError</font>
<font color="black"> 374. </font>
<font color="black"> 375.     # Concrete implementations of Rational and Real abstract methods.</font>
<font color="green"> 376.     def __float__(self):</font>
<font color="black"> 377.         &quot;&quot;&quot;float(self) == float(long(self))&quot;&quot;&quot;</font>
<font color="red"> 378.         return float(long(self))</font>
<font color="black"> 379. </font>
<font color="green"> 380.     @property</font>
<font color="black"> 381.     def numerator(self):</font>
<font color="black"> 382.         &quot;&quot;&quot;Integers are their own numerators.&quot;&quot;&quot;</font>
<font color="red"> 383.         return +self</font>
<font color="black"> 384. </font>
<font color="green"> 385.     @property</font>
<font color="black"> 386.     def denominator(self):</font>
<font color="black"> 387.         &quot;&quot;&quot;Integers have a denominator of 1.&quot;&quot;&quot;</font>
<font color="red"> 388.         return 1</font>
<font color="black"> 389. </font>
<font color="green"> 390. Integral.register(int)</font>
<font color="green"> 391. Integral.register(long)</font>
</pre>

