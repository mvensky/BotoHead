source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/s3transfer/compat.py</b><br>


file stats: <b>38 lines, 14 executed: 36.8% covered</b>
<pre>
<font color="black">   1. # Copyright 2016 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. import inspect</font>
<font color="green">  14. import sys</font>
<font color="green">  15. import os</font>
<font color="green">  16. import errno</font>
<font color="green">  17. import socket</font>
<font color="black">  18. </font>
<font color="green">  19. from botocore.compat import six</font>
<font color="black">  20. </font>
<font color="black">  21. </font>
<font color="green">  22. if sys.platform.startswith('win'):</font>
<font color="red">  23.     def rename_file(current_filename, new_filename):</font>
<font color="red">  24.         try:</font>
<font color="red">  25.             os.remove(new_filename)</font>
<font color="red">  26.         except OSError as e:</font>
<font color="red">  27.             if not e.errno == errno.ENOENT:</font>
<font color="black">  28.                 # We only want to a ignore trying to remove</font>
<font color="black">  29.                 # a file that does not exist.  If it fails</font>
<font color="black">  30.                 # for any other reason we should be propagating</font>
<font color="black">  31.                 # that exception.</font>
<font color="red">  32.                 raise</font>
<font color="red">  33.         os.rename(current_filename, new_filename)</font>
<font color="black">  34. else:</font>
<font color="green">  35.     rename_file = os.rename</font>
<font color="black">  36. </font>
<font color="green">  37. if six.PY3:</font>
<font color="red">  38.     def accepts_kwargs(func):</font>
<font color="black">  39.         # In python3.4.1, there's backwards incompatible</font>
<font color="black">  40.         # changes when using getargspec with functools.partials.</font>
<font color="red">  41.         return inspect.getfullargspec(func)[2]</font>
<font color="black">  42. </font>
<font color="black">  43.     # In python3, socket.error is OSError, which is too general</font>
<font color="black">  44.     # for what we want (i.e FileNotFoundError is a subclass of OSError).</font>
<font color="black">  45.     # In py3 all the socket related errors are in a newly created</font>
<font color="black">  46.     # ConnectionError</font>
<font color="red">  47.     SOCKET_ERROR = ConnectionError</font>
<font color="red">  48.     MAXINT = None</font>
<font color="black">  49. else:</font>
<font color="green">  50.     def accepts_kwargs(func):</font>
<font color="red">  51.         return inspect.getargspec(func)[2]</font>
<font color="black">  52. </font>
<font color="green">  53.     SOCKET_ERROR = socket.error</font>
<font color="green">  54.     MAXINT = sys.maxint</font>
<font color="black">  55. </font>
<font color="black">  56. </font>
<font color="green">  57. def seekable(fileobj):</font>
<font color="black">  58.     &quot;&quot;&quot;Backwards compat function to determine if a fileobj is seekable</font>
<font color="black">  59. </font>
<font color="black">  60.     :param fileobj: The file-like object to determine if seekable</font>
<font color="black">  61. </font>
<font color="black">  62.     :returns: True, if seekable. False, otherwise.</font>
<font color="black">  63.     &quot;&quot;&quot;</font>
<font color="black">  64.     # If the fileobj has a seekable attr, try calling the seekable()</font>
<font color="black">  65.     # method on it.</font>
<font color="red">  66.     if hasattr(fileobj, 'seekable'):</font>
<font color="red">  67.         return fileobj.seekable()</font>
<font color="black">  68.     # If there is no seekable attr, check if the object can be seeked</font>
<font color="black">  69.     # or telled. If it can, try to seek to the current position.</font>
<font color="red">  70.     elif hasattr(fileobj, 'seek') and hasattr(fileobj, 'tell'):</font>
<font color="red">  71.         try:</font>
<font color="red">  72.             fileobj.seek(0, 1)</font>
<font color="red">  73.             return True</font>
<font color="red">  74.         except (OSError, IOError):</font>
<font color="black">  75.             # If an io related error was thrown then it is not seekable.</font>
<font color="red">  76.             return False</font>
<font color="black">  77.     # Else, the fileobj is not seekable</font>
<font color="red">  78.     return False</font>
<font color="black">  79. </font>
<font color="black">  80. </font>
<font color="green">  81. def readable(fileobj):</font>
<font color="black">  82.     &quot;&quot;&quot;Determines whether or not a file-like object is readable.</font>
<font color="black">  83. </font>
<font color="black">  84.     :param fileobj: The file-like object to determine if readable</font>
<font color="black">  85. </font>
<font color="black">  86.     :returns: True, if readable. False otherwise.</font>
<font color="black">  87.     &quot;&quot;&quot;</font>
<font color="red">  88.     if hasattr(fileobj, 'readable'):</font>
<font color="red">  89.         return fileobj.readable()</font>
<font color="black">  90. </font>
<font color="red">  91.     return hasattr(fileobj, 'read')</font>
</pre>

