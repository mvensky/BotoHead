source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/cryptography/hazmat/primitives/asymmetric/dsa.py</b><br>


file stats: <b>114 lines, 58 executed: 50.9% covered</b>
<pre>
<font color="black">   1. # This file is dual licensed under the terms of the Apache License, Version</font>
<font color="black">   2. # 2.0, and the BSD License. See the LICENSE file in the root of this repository</font>
<font color="black">   3. # for complete details.</font>
<font color="black">   4. </font>
<font color="green">   5. from __future__ import absolute_import, division, print_function</font>
<font color="black">   6. </font>
<font color="green">   7. import abc</font>
<font color="black">   8. </font>
<font color="green">   9. import six</font>
<font color="black">  10. </font>
<font color="green">  11. from cryptography import utils</font>
<font color="black">  12. </font>
<font color="black">  13. </font>
<font color="green">  14. @six.add_metaclass(abc.ABCMeta)</font>
<font color="green">  15. class DSAParameters(object):</font>
<font color="green">  16.     @abc.abstractmethod</font>
<font color="black">  17.     def generate_private_key(self):</font>
<font color="black">  18.         &quot;&quot;&quot;</font>
<font color="black">  19.         Generates and returns a DSAPrivateKey.</font>
<font color="black">  20.         &quot;&quot;&quot;</font>
<font color="black">  21. </font>
<font color="black">  22. </font>
<font color="green">  23. @six.add_metaclass(abc.ABCMeta)</font>
<font color="green">  24. class DSAParametersWithNumbers(DSAParameters):</font>
<font color="green">  25.     @abc.abstractmethod</font>
<font color="black">  26.     def parameter_numbers(self):</font>
<font color="black">  27.         &quot;&quot;&quot;</font>
<font color="black">  28.         Returns a DSAParameterNumbers.</font>
<font color="black">  29.         &quot;&quot;&quot;</font>
<font color="black">  30. </font>
<font color="black">  31. </font>
<font color="green">  32. @six.add_metaclass(abc.ABCMeta)</font>
<font color="green">  33. class DSAPrivateKey(object):</font>
<font color="green">  34.     @abc.abstractproperty</font>
<font color="black">  35.     def key_size(self):</font>
<font color="black">  36.         &quot;&quot;&quot;</font>
<font color="black">  37.         The bit length of the prime modulus.</font>
<font color="black">  38.         &quot;&quot;&quot;</font>
<font color="black">  39. </font>
<font color="green">  40.     @abc.abstractmethod</font>
<font color="black">  41.     def public_key(self):</font>
<font color="black">  42.         &quot;&quot;&quot;</font>
<font color="black">  43.         The DSAPublicKey associated with this private key.</font>
<font color="black">  44.         &quot;&quot;&quot;</font>
<font color="black">  45. </font>
<font color="green">  46.     @abc.abstractmethod</font>
<font color="black">  47.     def parameters(self):</font>
<font color="black">  48.         &quot;&quot;&quot;</font>
<font color="black">  49.         The DSAParameters object associated with this private key.</font>
<font color="black">  50.         &quot;&quot;&quot;</font>
<font color="black">  51. </font>
<font color="green">  52.     @abc.abstractmethod</font>
<font color="black">  53.     def signer(self, signature_algorithm):</font>
<font color="black">  54.         &quot;&quot;&quot;</font>
<font color="black">  55.         Returns an AsymmetricSignatureContext used for signing data.</font>
<font color="black">  56.         &quot;&quot;&quot;</font>
<font color="black">  57. </font>
<font color="green">  58.     @abc.abstractmethod</font>
<font color="black">  59.     def sign(self, data, algorithm):</font>
<font color="black">  60.         &quot;&quot;&quot;</font>
<font color="black">  61.         Signs the data</font>
<font color="black">  62.         &quot;&quot;&quot;</font>
<font color="black">  63. </font>
<font color="black">  64. </font>
<font color="green">  65. @six.add_metaclass(abc.ABCMeta)</font>
<font color="green">  66. class DSAPrivateKeyWithSerialization(DSAPrivateKey):</font>
<font color="green">  67.     @abc.abstractmethod</font>
<font color="black">  68.     def private_numbers(self):</font>
<font color="black">  69.         &quot;&quot;&quot;</font>
<font color="black">  70.         Returns a DSAPrivateNumbers.</font>
<font color="black">  71.         &quot;&quot;&quot;</font>
<font color="black">  72. </font>
<font color="green">  73.     @abc.abstractmethod</font>
<font color="black">  74.     def private_bytes(self, encoding, format, encryption_algorithm):</font>
<font color="black">  75.         &quot;&quot;&quot;</font>
<font color="black">  76.         Returns the key serialized as bytes.</font>
<font color="black">  77.         &quot;&quot;&quot;</font>
<font color="black">  78. </font>
<font color="black">  79. </font>
<font color="green">  80. @six.add_metaclass(abc.ABCMeta)</font>
<font color="green">  81. class DSAPublicKey(object):</font>
<font color="green">  82.     @abc.abstractproperty</font>
<font color="black">  83.     def key_size(self):</font>
<font color="black">  84.         &quot;&quot;&quot;</font>
<font color="black">  85.         The bit length of the prime modulus.</font>
<font color="black">  86.         &quot;&quot;&quot;</font>
<font color="black">  87. </font>
<font color="green">  88.     @abc.abstractmethod</font>
<font color="black">  89.     def parameters(self):</font>
<font color="black">  90.         &quot;&quot;&quot;</font>
<font color="black">  91.         The DSAParameters object associated with this public key.</font>
<font color="black">  92.         &quot;&quot;&quot;</font>
<font color="black">  93. </font>
<font color="green">  94.     @abc.abstractmethod</font>
<font color="black">  95.     def verifier(self, signature, signature_algorithm):</font>
<font color="black">  96.         &quot;&quot;&quot;</font>
<font color="black">  97.         Returns an AsymmetricVerificationContext used for signing data.</font>
<font color="black">  98.         &quot;&quot;&quot;</font>
<font color="black">  99. </font>
<font color="green"> 100.     @abc.abstractmethod</font>
<font color="black"> 101.     def public_numbers(self):</font>
<font color="black"> 102.         &quot;&quot;&quot;</font>
<font color="black"> 103.         Returns a DSAPublicNumbers.</font>
<font color="black"> 104.         &quot;&quot;&quot;</font>
<font color="black"> 105. </font>
<font color="green"> 106.     @abc.abstractmethod</font>
<font color="black"> 107.     def public_bytes(self, encoding, format):</font>
<font color="black"> 108.         &quot;&quot;&quot;</font>
<font color="black"> 109.         Returns the key serialized as bytes.</font>
<font color="black"> 110.         &quot;&quot;&quot;</font>
<font color="black"> 111. </font>
<font color="green"> 112.     @abc.abstractmethod</font>
<font color="black"> 113.     def verify(self, signature, data, algorithm):</font>
<font color="black"> 114.         &quot;&quot;&quot;</font>
<font color="black"> 115.         Verifies the signature of the data.</font>
<font color="black"> 116.         &quot;&quot;&quot;</font>
<font color="black"> 117. </font>
<font color="black"> 118. </font>
<font color="green"> 119. DSAPublicKeyWithSerialization = DSAPublicKey</font>
<font color="black"> 120. </font>
<font color="black"> 121. </font>
<font color="green"> 122. def generate_parameters(key_size, backend):</font>
<font color="red"> 123.     return backend.generate_dsa_parameters(key_size)</font>
<font color="black"> 124. </font>
<font color="black"> 125. </font>
<font color="green"> 126. def generate_private_key(key_size, backend):</font>
<font color="red"> 127.     return backend.generate_dsa_private_key_and_parameters(key_size)</font>
<font color="black"> 128. </font>
<font color="black"> 129. </font>
<font color="green"> 130. def _check_dsa_parameters(parameters):</font>
<font color="red"> 131.     if utils.bit_length(parameters.p) not in [1024, 2048, 3072]:</font>
<font color="red"> 132.         raise ValueError(&quot;p must be exactly 1024, 2048, or 3072 bits long&quot;)</font>
<font color="red"> 133.     if utils.bit_length(parameters.q) not in [160, 256]:</font>
<font color="red"> 134.         raise ValueError(&quot;q must be exactly 160 or 256 bits long&quot;)</font>
<font color="black"> 135. </font>
<font color="red"> 136.     if not (1 &lt; parameters.g &lt; parameters.p):</font>
<font color="red"> 137.         raise ValueError(&quot;g, p don't satisfy 1 &lt; g &lt; p.&quot;)</font>
<font color="black"> 138. </font>
<font color="black"> 139. </font>
<font color="green"> 140. def _check_dsa_private_numbers(numbers):</font>
<font color="red"> 141.     parameters = numbers.public_numbers.parameter_numbers</font>
<font color="red"> 142.     _check_dsa_parameters(parameters)</font>
<font color="red"> 143.     if numbers.x &lt;= 0 or numbers.x &gt;= parameters.q:</font>
<font color="red"> 144.         raise ValueError(&quot;x must be &gt; 0 and &lt; q.&quot;)</font>
<font color="black"> 145. </font>
<font color="red"> 146.     if numbers.public_numbers.y != pow(parameters.g, numbers.x, parameters.p):</font>
<font color="red"> 147.         raise ValueError(&quot;y must be equal to (g ** x % p).&quot;)</font>
<font color="black"> 148. </font>
<font color="black"> 149. </font>
<font color="green"> 150. class DSAParameterNumbers(object):</font>
<font color="green"> 151.     def __init__(self, p, q, g):</font>
<font color="black"> 152.         if (</font>
<font color="red"> 153.             not isinstance(p, six.integer_types) or</font>
<font color="red"> 154.             not isinstance(q, six.integer_types) or</font>
<font color="red"> 155.             not isinstance(g, six.integer_types)</font>
<font color="black"> 156.         ):</font>
<font color="red"> 157.             raise TypeError(</font>
<font color="red"> 158.                 &quot;DSAParameterNumbers p, q, and g arguments must be integers.&quot;</font>
<font color="black"> 159.             )</font>
<font color="black"> 160. </font>
<font color="red"> 161.         self._p = p</font>
<font color="red"> 162.         self._q = q</font>
<font color="red"> 163.         self._g = g</font>
<font color="black"> 164. </font>
<font color="green"> 165.     p = utils.read_only_property(&quot;_p&quot;)</font>
<font color="green"> 166.     q = utils.read_only_property(&quot;_q&quot;)</font>
<font color="green"> 167.     g = utils.read_only_property(&quot;_g&quot;)</font>
<font color="black"> 168. </font>
<font color="green"> 169.     def parameters(self, backend):</font>
<font color="red"> 170.         return backend.load_dsa_parameter_numbers(self)</font>
<font color="black"> 171. </font>
<font color="green"> 172.     def __eq__(self, other):</font>
<font color="red"> 173.         if not isinstance(other, DSAParameterNumbers):</font>
<font color="red"> 174.             return NotImplemented</font>
<font color="black"> 175. </font>
<font color="red"> 176.         return self.p == other.p and self.q == other.q and self.g == other.g</font>
<font color="black"> 177. </font>
<font color="green"> 178.     def __ne__(self, other):</font>
<font color="red"> 179.         return not self == other</font>
<font color="black"> 180. </font>
<font color="green"> 181.     def __repr__(self):</font>
<font color="black"> 182.         return (</font>
<font color="red"> 183.             &quot;&lt;DSAParameterNumbers(p={self.p}, q={self.q}, g={self.g})&gt;&quot;.format(</font>
<font color="red"> 184.                 self=self</font>
<font color="black"> 185.             )</font>
<font color="black"> 186.         )</font>
<font color="black"> 187. </font>
<font color="black"> 188. </font>
<font color="green"> 189. class DSAPublicNumbers(object):</font>
<font color="green"> 190.     def __init__(self, y, parameter_numbers):</font>
<font color="red"> 191.         if not isinstance(y, six.integer_types):</font>
<font color="red"> 192.             raise TypeError(&quot;DSAPublicNumbers y argument must be an integer.&quot;)</font>
<font color="black"> 193. </font>
<font color="red"> 194.         if not isinstance(parameter_numbers, DSAParameterNumbers):</font>
<font color="red"> 195.             raise TypeError(</font>
<font color="red"> 196.                 &quot;parameter_numbers must be a DSAParameterNumbers instance.&quot;</font>
<font color="black"> 197.             )</font>
<font color="black"> 198. </font>
<font color="red"> 199.         self._y = y</font>
<font color="red"> 200.         self._parameter_numbers = parameter_numbers</font>
<font color="black"> 201. </font>
<font color="green"> 202.     y = utils.read_only_property(&quot;_y&quot;)</font>
<font color="green"> 203.     parameter_numbers = utils.read_only_property(&quot;_parameter_numbers&quot;)</font>
<font color="black"> 204. </font>
<font color="green"> 205.     def public_key(self, backend):</font>
<font color="red"> 206.         return backend.load_dsa_public_numbers(self)</font>
<font color="black"> 207. </font>
<font color="green"> 208.     def __eq__(self, other):</font>
<font color="red"> 209.         if not isinstance(other, DSAPublicNumbers):</font>
<font color="red"> 210.             return NotImplemented</font>
<font color="black"> 211. </font>
<font color="black"> 212.         return (</font>
<font color="red"> 213.             self.y == other.y and</font>
<font color="red"> 214.             self.parameter_numbers == other.parameter_numbers</font>
<font color="black"> 215.         )</font>
<font color="black"> 216. </font>
<font color="green"> 217.     def __ne__(self, other):</font>
<font color="red"> 218.         return not self == other</font>
<font color="black"> 219. </font>
<font color="green"> 220.     def __repr__(self):</font>
<font color="black"> 221.         return (</font>
<font color="red"> 222.             &quot;&lt;DSAPublicNumbers(y={self.y}, &quot;</font>
<font color="red"> 223.             &quot;parameter_numbers={self.parameter_numbers})&gt;&quot;.format(self=self)</font>
<font color="black"> 224.         )</font>
<font color="black"> 225. </font>
<font color="black"> 226. </font>
<font color="green"> 227. class DSAPrivateNumbers(object):</font>
<font color="green"> 228.     def __init__(self, x, public_numbers):</font>
<font color="red"> 229.         if not isinstance(x, six.integer_types):</font>
<font color="red"> 230.             raise TypeError(&quot;DSAPrivateNumbers x argument must be an integer.&quot;)</font>
<font color="black"> 231. </font>
<font color="red"> 232.         if not isinstance(public_numbers, DSAPublicNumbers):</font>
<font color="red"> 233.             raise TypeError(</font>
<font color="red"> 234.                 &quot;public_numbers must be a DSAPublicNumbers instance.&quot;</font>
<font color="black"> 235.             )</font>
<font color="red"> 236.         self._public_numbers = public_numbers</font>
<font color="red"> 237.         self._x = x</font>
<font color="black"> 238. </font>
<font color="green"> 239.     x = utils.read_only_property(&quot;_x&quot;)</font>
<font color="green"> 240.     public_numbers = utils.read_only_property(&quot;_public_numbers&quot;)</font>
<font color="black"> 241. </font>
<font color="green"> 242.     def private_key(self, backend):</font>
<font color="red"> 243.         return backend.load_dsa_private_numbers(self)</font>
<font color="black"> 244. </font>
<font color="green"> 245.     def __eq__(self, other):</font>
<font color="red"> 246.         if not isinstance(other, DSAPrivateNumbers):</font>
<font color="red"> 247.             return NotImplemented</font>
<font color="black"> 248. </font>
<font color="black"> 249.         return (</font>
<font color="red"> 250.             self.x == other.x and self.public_numbers == other.public_numbers</font>
<font color="black"> 251.         )</font>
<font color="black"> 252. </font>
<font color="green"> 253.     def __ne__(self, other):</font>
<font color="red"> 254.         return not self == other</font>
</pre>

