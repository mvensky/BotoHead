source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/boto3/resources/model.py</b><br>


file stats: <b>214 lines, 49 executed: 22.9% covered</b>
<pre>
<font color="black">   1. # Copyright 2014 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="black">  13. </font>
<font color="black">  14. &quot;&quot;&quot;</font>
<font color="black">  15. The models defined in this file represent the resource JSON description</font>
<font color="black">  16. format and provide a layer of abstraction from the raw JSON. The advantages</font>
<font color="black">  17. of this are:</font>
<font color="black">  18. </font>
<font color="black">  19. * Pythonic interface (e.g. ``action.request.operation``)</font>
<font color="black">  20. * Consumers need not change for minor JSON changes (e.g. renamed field)</font>
<font color="black">  21. </font>
<font color="black">  22. These models are used both by the resource factory to generate resource</font>
<font color="black">  23. classes as well as by the documentation generator.</font>
<font color="green">  24. &quot;&quot;&quot;</font>
<font color="black">  25. </font>
<font color="green">  26. import logging</font>
<font color="black">  27. </font>
<font color="green">  28. from botocore import xform_name</font>
<font color="black">  29. </font>
<font color="black">  30. </font>
<font color="green">  31. logger = logging.getLogger(__name__)</font>
<font color="black">  32. </font>
<font color="black">  33. </font>
<font color="green">  34. class Identifier(object):</font>
<font color="black">  35.     &quot;&quot;&quot;</font>
<font color="black">  36.     A resource identifier, given by its name.</font>
<font color="black">  37. </font>
<font color="black">  38.     :type name: string</font>
<font color="black">  39.     :param name: The name of the identifier</font>
<font color="green">  40.     &quot;&quot;&quot;</font>
<font color="green">  41.     def __init__(self, name, member_name=None):</font>
<font color="black">  42.         #: (``string``) The name of the identifier</font>
<font color="red">  43.         self.name = name</font>
<font color="red">  44.         self.member_name = member_name</font>
<font color="black">  45. </font>
<font color="black">  46. </font>
<font color="green">  47. class Action(object):</font>
<font color="black">  48.     &quot;&quot;&quot;</font>
<font color="black">  49.     A service operation action.</font>
<font color="black">  50. </font>
<font color="black">  51.     :type name: string</font>
<font color="black">  52.     :param name: The name of the action</font>
<font color="black">  53.     :type definition: dict</font>
<font color="black">  54.     :param definition: The JSON definition</font>
<font color="black">  55.     :type resource_defs: dict</font>
<font color="black">  56.     :param resource_defs: All resources defined in the service</font>
<font color="green">  57.     &quot;&quot;&quot;</font>
<font color="green">  58.     def __init__(self, name, definition, resource_defs):</font>
<font color="red">  59.         self._definition = definition</font>
<font color="black">  60. </font>
<font color="black">  61.         #: (``string``) The name of the action</font>
<font color="red">  62.         self.name = name</font>
<font color="black">  63.         #: (:py:class:`Request`) This action's request or ``None``</font>
<font color="red">  64.         self.request = None</font>
<font color="red">  65.         if 'request' in definition:</font>
<font color="red">  66.             self.request = Request(definition.get('request', {}))</font>
<font color="black">  67.         #: (:py:class:`ResponseResource`) This action's resource or ``None``</font>
<font color="red">  68.         self.resource = None</font>
<font color="red">  69.         if 'resource' in definition:</font>
<font color="red">  70.             self.resource = ResponseResource(definition.get('resource', {}),</font>
<font color="red">  71.                                              resource_defs)</font>
<font color="black">  72.         #: (``string``) The JMESPath search path or ``None``</font>
<font color="red">  73.         self.path = definition.get('path')</font>
<font color="black">  74. </font>
<font color="black">  75. </font>
<font color="green">  76. class DefinitionWithParams(object):</font>
<font color="black">  77.     &quot;&quot;&quot;</font>
<font color="black">  78.     An item which has parameters exposed via the ``params`` property.</font>
<font color="black">  79.     A request has an operation and parameters, while a waiter has</font>
<font color="black">  80.     a name, a low-level waiter name and parameters.</font>
<font color="black">  81. </font>
<font color="black">  82.     :type definition: dict</font>
<font color="black">  83.     :param definition: The JSON definition</font>
<font color="green">  84.     &quot;&quot;&quot;</font>
<font color="green">  85.     def __init__(self, definition):</font>
<font color="red">  86.         self._definition = definition</font>
<font color="black">  87. </font>
<font color="green">  88.     @property</font>
<font color="black">  89.     def params(self):</font>
<font color="black">  90.         &quot;&quot;&quot;</font>
<font color="black">  91.         Get a list of auto-filled parameters for this request.</font>
<font color="black">  92. </font>
<font color="black">  93.         :type: list(:py:class:`Parameter`)</font>
<font color="black">  94.         &quot;&quot;&quot;</font>
<font color="red">  95.         params = []</font>
<font color="black">  96. </font>
<font color="red">  97.         for item in self._definition.get('params', []):</font>
<font color="red">  98.             params.append(Parameter(**item))</font>
<font color="black">  99. </font>
<font color="red"> 100.         return params</font>
<font color="black"> 101. </font>
<font color="black"> 102. </font>
<font color="green"> 103. class Parameter(object):</font>
<font color="black"> 104.     &quot;&quot;&quot;</font>
<font color="black"> 105.     An auto-filled parameter which has a source and target. For example,</font>
<font color="black"> 106.     the ``QueueUrl`` may be auto-filled from a resource's ``url`` identifier</font>
<font color="black"> 107.     when making calls to ``queue.receive_messages``.</font>
<font color="black"> 108. </font>
<font color="black"> 109.     :type target: string</font>
<font color="black"> 110.     :param target: The destination parameter name, e.g. ``QueueUrl``</font>
<font color="black"> 111.     :type source_type: string</font>
<font color="black"> 112.     :param source_type: Where the source is defined.</font>
<font color="black"> 113.     :type source: string</font>
<font color="black"> 114.     :param source: The source name, e.g. ``Url``</font>
<font color="green"> 115.     &quot;&quot;&quot;</font>
<font color="green"> 116.     def __init__(self, target, source, name=None, path=None, value=None,</font>
<font color="black"> 117.                  **kwargs):</font>
<font color="black"> 118.         #: (``string``) The destination parameter name</font>
<font color="red"> 119.         self.target = target</font>
<font color="black"> 120.         #: (``string``) Where the source is defined</font>
<font color="red"> 121.         self.source = source</font>
<font color="black"> 122.         #: (``string``) The name of the source, if given</font>
<font color="red"> 123.         self.name = name</font>
<font color="black"> 124.         #: (``string``) The JMESPath query of the source</font>
<font color="red"> 125.         self.path = path</font>
<font color="black"> 126.         #: (``string|int|float|bool``) The source constant value</font>
<font color="red"> 127.         self.value = value</font>
<font color="black"> 128. </font>
<font color="black"> 129.         # Complain if we encounter any unknown values.</font>
<font color="red"> 130.         if kwargs:</font>
<font color="red"> 131.             logger.warning('Unknown parameter options found: %s', kwargs)</font>
<font color="black"> 132. </font>
<font color="black"> 133. </font>
<font color="green"> 134. class Request(DefinitionWithParams):</font>
<font color="black"> 135.     &quot;&quot;&quot;</font>
<font color="black"> 136.     A service operation action request.</font>
<font color="black"> 137. </font>
<font color="black"> 138.     :type definition: dict</font>
<font color="black"> 139.     :param definition: The JSON definition</font>
<font color="green"> 140.     &quot;&quot;&quot;</font>
<font color="green"> 141.     def __init__(self, definition):</font>
<font color="red"> 142.         super(Request, self).__init__(definition)</font>
<font color="black"> 143. </font>
<font color="black"> 144.         #: (``string``) The name of the low-level service operation</font>
<font color="red"> 145.         self.operation = definition.get('operation')</font>
<font color="black"> 146. </font>
<font color="black"> 147. </font>
<font color="green"> 148. class Waiter(DefinitionWithParams):</font>
<font color="black"> 149.     &quot;&quot;&quot;</font>
<font color="black"> 150.     An event waiter specification.</font>
<font color="black"> 151. </font>
<font color="black"> 152.     :type name: string</font>
<font color="black"> 153.     :param name: Name of the waiter</font>
<font color="black"> 154.     :type definition: dict</font>
<font color="black"> 155.     :param definition: The JSON definition</font>
<font color="green"> 156.     &quot;&quot;&quot;</font>
<font color="green"> 157.     PREFIX = 'WaitUntil'</font>
<font color="black"> 158. </font>
<font color="green"> 159.     def __init__(self, name, definition):</font>
<font color="red"> 160.         super(Waiter, self).__init__(definition)</font>
<font color="black"> 161. </font>
<font color="black"> 162.         #: (``string``) The name of this waiter</font>
<font color="red"> 163.         self.name = name</font>
<font color="black"> 164. </font>
<font color="black"> 165.         #: (``string``) The name of the underlying event waiter</font>
<font color="red"> 166.         self.waiter_name = definition.get('waiterName')</font>
<font color="black"> 167. </font>
<font color="black"> 168. </font>
<font color="green"> 169. class ResponseResource(object):</font>
<font color="black"> 170.     &quot;&quot;&quot;</font>
<font color="black"> 171.     A resource response to create after performing an action.</font>
<font color="black"> 172. </font>
<font color="black"> 173.     :type definition: dict</font>
<font color="black"> 174.     :param definition: The JSON definition</font>
<font color="black"> 175.     :type resource_defs: dict</font>
<font color="black"> 176.     :param resource_defs: All resources defined in the service</font>
<font color="green"> 177.     &quot;&quot;&quot;</font>
<font color="green"> 178.     def __init__(self, definition, resource_defs):</font>
<font color="red"> 179.         self._definition = definition</font>
<font color="red"> 180.         self._resource_defs = resource_defs</font>
<font color="black"> 181. </font>
<font color="black"> 182.         #: (``string``) The name of the response resource type</font>
<font color="red"> 183.         self.type = definition.get('type')</font>
<font color="black"> 184. </font>
<font color="black"> 185.         #: (``string``) The JMESPath search query or ``None``</font>
<font color="red"> 186.         self.path = definition.get('path')</font>
<font color="black"> 187. </font>
<font color="green"> 188.     @property</font>
<font color="black"> 189.     def identifiers(self):</font>
<font color="black"> 190.         &quot;&quot;&quot;</font>
<font color="black"> 191.         A list of resource identifiers.</font>
<font color="black"> 192. </font>
<font color="black"> 193.         :type: list(:py:class:`Identifier`)</font>
<font color="black"> 194.         &quot;&quot;&quot;</font>
<font color="red"> 195.         identifiers = []</font>
<font color="black"> 196. </font>
<font color="red"> 197.         for item in self._definition.get('identifiers', []):</font>
<font color="red"> 198.             identifiers.append(</font>
<font color="red"> 199.                 Parameter(**item))</font>
<font color="black"> 200. </font>
<font color="red"> 201.         return identifiers</font>
<font color="black"> 202. </font>
<font color="green"> 203.     @property</font>
<font color="black"> 204.     def model(self):</font>
<font color="black"> 205.         &quot;&quot;&quot;</font>
<font color="black"> 206.         Get the resource model for the response resource.</font>
<font color="black"> 207. </font>
<font color="black"> 208.         :type: :py:class:`ResourceModel`</font>
<font color="black"> 209.         &quot;&quot;&quot;</font>
<font color="red"> 210.         return ResourceModel(self.type, self._resource_defs[self.type],</font>
<font color="red"> 211.                              self._resource_defs)</font>
<font color="black"> 212. </font>
<font color="black"> 213. </font>
<font color="green"> 214. class Collection(Action):</font>
<font color="black"> 215.     &quot;&quot;&quot;</font>
<font color="black"> 216.     A group of resources. See :py:class:`Action`.</font>
<font color="black"> 217. </font>
<font color="black"> 218.     :type name: string</font>
<font color="black"> 219.     :param name: The name of the collection</font>
<font color="black"> 220.     :type definition: dict</font>
<font color="black"> 221.     :param definition: The JSON definition</font>
<font color="black"> 222.     :type resource_defs: dict</font>
<font color="black"> 223.     :param resource_defs: All resources defined in the service</font>
<font color="green"> 224.     &quot;&quot;&quot;</font>
<font color="green"> 225.     @property</font>
<font color="black"> 226.     def batch_actions(self):</font>
<font color="black"> 227.         &quot;&quot;&quot;</font>
<font color="black"> 228.         Get a list of batch actions supported by the resource type</font>
<font color="black"> 229.         contained in this action. This is a shortcut for accessing</font>
<font color="black"> 230.         the same information through the resource model.</font>
<font color="black"> 231. </font>
<font color="black"> 232.         :rtype: list(:py:class:`Action`)</font>
<font color="black"> 233.         &quot;&quot;&quot;</font>
<font color="red"> 234.         return self.resource.model.batch_actions</font>
<font color="black"> 235. </font>
<font color="black"> 236. </font>
<font color="green"> 237. class ResourceModel(object):</font>
<font color="black"> 238.     &quot;&quot;&quot;</font>
<font color="black"> 239.     A model representing a resource, defined via a JSON description</font>
<font color="black"> 240.     format. A resource has identifiers, attributes, actions,</font>
<font color="black"> 241.     sub-resources, references and collections. For more information</font>
<font color="black"> 242.     on resources, see :ref:`guide_resources`.</font>
<font color="black"> 243. </font>
<font color="black"> 244.     :type name: string</font>
<font color="black"> 245.     :param name: The name of this resource, e.g. ``sqs`` or ``Queue``</font>
<font color="black"> 246.     :type definition: dict</font>
<font color="black"> 247.     :param definition: The JSON definition</font>
<font color="black"> 248.     :type resource_defs: dict</font>
<font color="black"> 249.     :param resource_defs: All resources defined in the service</font>
<font color="green"> 250.     &quot;&quot;&quot;</font>
<font color="green"> 251.     def __init__(self, name, definition, resource_defs):</font>
<font color="red"> 252.         self._definition = definition</font>
<font color="red"> 253.         self._resource_defs = resource_defs</font>
<font color="red"> 254.         self._renamed = {}</font>
<font color="black"> 255. </font>
<font color="black"> 256.         #: (``string``) The name of this resource</font>
<font color="red"> 257.         self.name = name</font>
<font color="black"> 258.         #: (``string``) The service shape name for this resource or ``None``</font>
<font color="red"> 259.         self.shape = definition.get('shape')</font>
<font color="black"> 260. </font>
<font color="green"> 261.     def load_rename_map(self, shape=None):</font>
<font color="black"> 262.         &quot;&quot;&quot;</font>
<font color="black"> 263.         Load a name translation map given a shape. This will set</font>
<font color="black"> 264.         up renamed values for any collisions, e.g. if the shape,</font>
<font color="black"> 265.         an action, and a subresource all are all named ``foo``</font>
<font color="black"> 266.         then the resource will have an action ``foo``, a subresource</font>
<font color="black"> 267.         named ``Foo`` and a property named ``foo_attribute``.</font>
<font color="black"> 268.         This is the order of precedence, from most important to</font>
<font color="black"> 269.         least important:</font>
<font color="black"> 270. </font>
<font color="black"> 271.         * Load action (resource.load)</font>
<font color="black"> 272.         * Identifiers</font>
<font color="black"> 273.         * Actions</font>
<font color="black"> 274.         * Subresources</font>
<font color="black"> 275.         * References</font>
<font color="black"> 276.         * Collections</font>
<font color="black"> 277.         * Waiters</font>
<font color="black"> 278.         * Attributes (shape members)</font>
<font color="black"> 279. </font>
<font color="black"> 280.         Batch actions are only exposed on collections, so do not</font>
<font color="black"> 281.         get modified here. Subresources use upper camel casing, so</font>
<font color="black"> 282.         are unlikely to collide with anything but other subresources.</font>
<font color="black"> 283. </font>
<font color="black"> 284.         Creates a structure like this::</font>
<font color="black"> 285. </font>
<font color="black"> 286.             renames = {</font>
<font color="black"> 287.                 ('action', 'id'): 'id_action',</font>
<font color="black"> 288.                 ('collection', 'id'): 'id_collection',</font>
<font color="black"> 289.                 ('attribute', 'id'): 'id_attribute'</font>
<font color="black"> 290.             }</font>
<font color="black"> 291. </font>
<font color="black"> 292.             # Get the final name for an action named 'id'</font>
<font color="black"> 293.             name = renames.get(('action', 'id'), 'id')</font>
<font color="black"> 294. </font>
<font color="black"> 295.         :type shape: botocore.model.Shape</font>
<font color="black"> 296.         :param shape: The underlying shape for this resource.</font>
<font color="black"> 297.         &quot;&quot;&quot;</font>
<font color="black"> 298.         # Meta is a reserved name for resources</font>
<font color="red"> 299.         names = set(['meta'])</font>
<font color="red"> 300.         self._renamed = {}</font>
<font color="black"> 301. </font>
<font color="red"> 302.         if self._definition.get('load'):</font>
<font color="red"> 303.             names.add('load')</font>
<font color="black"> 304. </font>
<font color="red"> 305.         for item in self._definition.get('identifiers', []):</font>
<font color="red"> 306.             self._load_name_with_category(names, item['name'], 'identifier')</font>
<font color="black"> 307. </font>
<font color="red"> 308.         for name in self._definition.get('actions', {}):</font>
<font color="red"> 309.             self._load_name_with_category(names, name, 'action')</font>
<font color="black"> 310. </font>
<font color="red"> 311.         for name, ref in self._get_has_definition().items():</font>
<font color="black"> 312.             # Subresources require no data members, just typically</font>
<font color="black"> 313.             # identifiers and user input.</font>
<font color="red"> 314.             data_required = False</font>
<font color="red"> 315.             for identifier in ref['resource']['identifiers']:</font>
<font color="red"> 316.                 if identifier['source'] == 'data':</font>
<font color="red"> 317.                     data_required = True</font>
<font color="red"> 318.                     break</font>
<font color="black"> 319. </font>
<font color="red"> 320.             if not data_required:</font>
<font color="red"> 321.                 self._load_name_with_category(names, name, 'subresource',</font>
<font color="red"> 322.                                               snake_case=False)</font>
<font color="black"> 323.             else:</font>
<font color="red"> 324.                 self._load_name_with_category(names, name, 'reference')</font>
<font color="black"> 325. </font>
<font color="red"> 326.         for name in self._definition.get('hasMany', {}):</font>
<font color="red"> 327.             self._load_name_with_category(names, name, 'collection')</font>
<font color="black"> 328. </font>
<font color="red"> 329.         for name in self._definition.get('waiters', {}):</font>
<font color="red"> 330.             self._load_name_with_category(names, Waiter.PREFIX + name,</font>
<font color="red"> 331.                                           'waiter')</font>
<font color="black"> 332. </font>
<font color="red"> 333.         if shape is not None:</font>
<font color="red"> 334.             for name in shape.members.keys():</font>
<font color="red"> 335.                 self._load_name_with_category(names, name, 'attribute')</font>
<font color="black"> 336. </font>
<font color="black"> 337.     def _load_name_with_category(self, names, name, category,</font>
<font color="green"> 338.                                  snake_case=True):</font>
<font color="black"> 339.         &quot;&quot;&quot;</font>
<font color="black"> 340.         Load a name with a given category, possibly renaming it</font>
<font color="black"> 341.         if that name is already in use. The name will be stored</font>
<font color="black"> 342.         in ``names`` and possibly be set up in ``self._renamed``.</font>
<font color="black"> 343. </font>
<font color="black"> 344.         :type names: set</font>
<font color="black"> 345.         :param names: Existing names (Python attributes, properties, or</font>
<font color="black"> 346.                       methods) on the resource.</font>
<font color="black"> 347.         :type name: string</font>
<font color="black"> 348.         :param name: The original name of the value.</font>
<font color="black"> 349.         :type category: string</font>
<font color="black"> 350.         :param category: The value type, such as 'identifier' or 'action'</font>
<font color="black"> 351.         :type snake_case: bool</font>
<font color="black"> 352.         :param snake_case: True (default) if the name should be snake cased.</font>
<font color="black"> 353.         &quot;&quot;&quot;</font>
<font color="red"> 354.         if snake_case:</font>
<font color="red"> 355.             name = xform_name(name)</font>
<font color="black"> 356. </font>
<font color="red"> 357.         if name in names:</font>
<font color="red"> 358.             logger.debug('Renaming %s %s %s' % (self.name, category, name))</font>
<font color="red"> 359.             self._renamed[(category, name)] = name + '_' + category</font>
<font color="red"> 360.             name += '_' + category</font>
<font color="black"> 361. </font>
<font color="red"> 362.             if name in names:</font>
<font color="black"> 363.                 # This isn't good, let's raise instead of trying to keep</font>
<font color="black"> 364.                 # renaming this value.</font>
<font color="red"> 365.                 raise ValueError('Problem renaming {0} {1} to {2}!'.format(</font>
<font color="red"> 366.                     self.name, category, name))</font>
<font color="black"> 367. </font>
<font color="red"> 368.         names.add(name)</font>
<font color="black"> 369. </font>
<font color="green"> 370.     def _get_name(self, category, name, snake_case=True):</font>
<font color="black"> 371.         &quot;&quot;&quot;</font>
<font color="black"> 372.         Get a possibly renamed value given a category and name. This</font>
<font color="black"> 373.         uses the rename map set up in ``load_rename_map``, so that</font>
<font color="black"> 374.         method must be called once first.</font>
<font color="black"> 375. </font>
<font color="black"> 376.         :type category: string</font>
<font color="black"> 377.         :param category: The value type, such as 'identifier' or 'action'</font>
<font color="black"> 378.         :type name: string</font>
<font color="black"> 379.         :param name: The original name of the value</font>
<font color="black"> 380.         :type snake_case: bool</font>
<font color="black"> 381.         :param snake_case: True (default) if the name should be snake cased.</font>
<font color="black"> 382.         :rtype: string</font>
<font color="black"> 383.         :return: Either the renamed value if it is set, otherwise the</font>
<font color="black"> 384.                  original name.</font>
<font color="black"> 385.         &quot;&quot;&quot;</font>
<font color="red"> 386.         if snake_case:</font>
<font color="red"> 387.             name = xform_name(name)</font>
<font color="black"> 388. </font>
<font color="red"> 389.         return self._renamed.get((category, name), name)</font>
<font color="black"> 390. </font>
<font color="green"> 391.     def get_attributes(self, shape):</font>
<font color="black"> 392.         &quot;&quot;&quot;</font>
<font color="black"> 393.         Get a dictionary of attribute names to original name and shape</font>
<font color="black"> 394.         models that represent the attributes of this resource. Looks</font>
<font color="black"> 395.         like the following:</font>
<font color="black"> 396. </font>
<font color="black"> 397.             {</font>
<font color="black"> 398.                 'some_name': ('SomeName', &lt;Shape...&gt;)</font>
<font color="black"> 399.             }</font>
<font color="black"> 400. </font>
<font color="black"> 401.         :type shape: botocore.model.Shape</font>
<font color="black"> 402.         :param shape: The underlying shape for this resource.</font>
<font color="black"> 403.         :rtype: dict</font>
<font color="black"> 404.         :return: Mapping of resource attributes.</font>
<font color="black"> 405.         &quot;&quot;&quot;</font>
<font color="red"> 406.         attributes = {}</font>
<font color="red"> 407.         identifier_names = [i.name for i in self.identifiers]</font>
<font color="black"> 408. </font>
<font color="red"> 409.         for name, member in shape.members.items():</font>
<font color="red"> 410.             snake_cased = xform_name(name)</font>
<font color="red"> 411.             if snake_cased in identifier_names:</font>
<font color="black"> 412.                 # Skip identifiers, these are set through other means</font>
<font color="red"> 413.                 continue</font>
<font color="red"> 414.             snake_cased = self._get_name('attribute', snake_cased,</font>
<font color="red"> 415.                                          snake_case=False)</font>
<font color="red"> 416.             attributes[snake_cased] = (name, member)</font>
<font color="black"> 417. </font>
<font color="red"> 418.         return attributes</font>
<font color="black"> 419. </font>
<font color="green"> 420.     @property</font>
<font color="black"> 421.     def identifiers(self):</font>
<font color="black"> 422.         &quot;&quot;&quot;</font>
<font color="black"> 423.         Get a list of resource identifiers.</font>
<font color="black"> 424. </font>
<font color="black"> 425.         :type: list(:py:class:`Identifier`)</font>
<font color="black"> 426.         &quot;&quot;&quot;</font>
<font color="red"> 427.         identifiers = []</font>
<font color="black"> 428. </font>
<font color="red"> 429.         for item in self._definition.get('identifiers', []):</font>
<font color="red"> 430.             name = self._get_name('identifier', item['name'])</font>
<font color="red"> 431.             member_name = item.get('memberName', None)</font>
<font color="red"> 432.             if member_name:</font>
<font color="red"> 433.                 member_name = self._get_name('attribute', member_name)</font>
<font color="red"> 434.             identifiers.append(Identifier(name, member_name))</font>
<font color="black"> 435. </font>
<font color="red"> 436.         return identifiers</font>
<font color="black"> 437. </font>
<font color="green"> 438.     @property</font>
<font color="black"> 439.     def load(self):</font>
<font color="black"> 440.         &quot;&quot;&quot;</font>
<font color="black"> 441.         Get the load action for this resource, if it is defined.</font>
<font color="black"> 442. </font>
<font color="black"> 443.         :type: :py:class:`Action` or ``None``</font>
<font color="black"> 444.         &quot;&quot;&quot;</font>
<font color="red"> 445.         action = self._definition.get('load')</font>
<font color="black"> 446. </font>
<font color="red"> 447.         if action is not None:</font>
<font color="red"> 448.             action = Action('load', action, self._resource_defs)</font>
<font color="black"> 449. </font>
<font color="red"> 450.         return action</font>
<font color="black"> 451. </font>
<font color="green"> 452.     @property</font>
<font color="black"> 453.     def actions(self):</font>
<font color="black"> 454.         &quot;&quot;&quot;</font>
<font color="black"> 455.         Get a list of actions for this resource.</font>
<font color="black"> 456. </font>
<font color="black"> 457.         :type: list(:py:class:`Action`)</font>
<font color="black"> 458.         &quot;&quot;&quot;</font>
<font color="red"> 459.         actions = []</font>
<font color="black"> 460. </font>
<font color="red"> 461.         for name, item in self._definition.get('actions', {}).items():</font>
<font color="red"> 462.             name = self._get_name('action', name)</font>
<font color="red"> 463.             actions.append(Action(name, item, self._resource_defs))</font>
<font color="black"> 464. </font>
<font color="red"> 465.         return actions</font>
<font color="black"> 466. </font>
<font color="green"> 467.     @property</font>
<font color="black"> 468.     def batch_actions(self):</font>
<font color="black"> 469.         &quot;&quot;&quot;</font>
<font color="black"> 470.         Get a list of batch actions for this resource.</font>
<font color="black"> 471. </font>
<font color="black"> 472.         :type: list(:py:class:`Action`)</font>
<font color="black"> 473.         &quot;&quot;&quot;</font>
<font color="red"> 474.         actions = []</font>
<font color="black"> 475. </font>
<font color="red"> 476.         for name, item in self._definition.get('batchActions', {}).items():</font>
<font color="red"> 477.             name = self._get_name('batch_action', name)</font>
<font color="red"> 478.             actions.append(Action(name, item, self._resource_defs))</font>
<font color="black"> 479. </font>
<font color="red"> 480.         return actions</font>
<font color="black"> 481. </font>
<font color="green"> 482.     def _get_has_definition(self):</font>
<font color="black"> 483.         &quot;&quot;&quot;</font>
<font color="black"> 484.         Get a ``has`` relationship definition from a model, where the</font>
<font color="black"> 485.         service resource model is treated special in that it contains</font>
<font color="black"> 486.         a relationship to every resource defined for the service. This</font>
<font color="black"> 487.         allows things like ``s3.Object('bucket-name', 'key')`` to</font>
<font color="black"> 488.         work even though the JSON doesn't define it explicitly.</font>
<font color="black"> 489. </font>
<font color="black"> 490.         :rtype: dict</font>
<font color="black"> 491.         :return: Mapping of names to subresource and reference</font>
<font color="black"> 492.                  definitions.</font>
<font color="black"> 493.         &quot;&quot;&quot;</font>
<font color="red"> 494.         if self.name not in self._resource_defs:</font>
<font color="black"> 495.             # This is the service resource, so let us expose all of</font>
<font color="black"> 496.             # the defined resources as subresources.</font>
<font color="red"> 497.             definition = {}</font>
<font color="black"> 498. </font>
<font color="red"> 499.             for name, resource_def in self._resource_defs.items():</font>
<font color="black"> 500.                 # It's possible for the service to have renamed a</font>
<font color="black"> 501.                 # resource or to have defined multiple names that</font>
<font color="black"> 502.                 # point to the same resource type, so we need to</font>
<font color="black"> 503.                 # take that into account.</font>
<font color="red"> 504.                 found = False</font>
<font color="red"> 505.                 has_items = self._definition.get('has', {}).items()</font>
<font color="red"> 506.                 for has_name, has_def in has_items:</font>
<font color="red"> 507.                     if has_def.get('resource', {}).get('type') == name:</font>
<font color="red"> 508.                         definition[has_name] = has_def</font>
<font color="red"> 509.                         found = True</font>
<font color="black"> 510. </font>
<font color="red"> 511.                 if not found:</font>
<font color="black"> 512.                     # Create a relationship definition and attach it</font>
<font color="black"> 513.                     # to the model, such that all identifiers must be</font>
<font color="black"> 514.                     # supplied by the user. It will look something like:</font>
<font color="black"> 515.                     #</font>
<font color="black"> 516.                     # {</font>
<font color="black"> 517.                     #   'resource': {</font>
<font color="black"> 518.                     #     'type': 'ResourceName',</font>
<font color="black"> 519.                     #     'identifiers': [</font>
<font color="black"> 520.                     #       {'target': 'Name1', 'source': 'input'},</font>
<font color="black"> 521.                     #       {'target': 'Name2', 'source': 'input'},</font>
<font color="black"> 522.                     #       ...</font>
<font color="black"> 523.                     #     ]</font>
<font color="black"> 524.                     #   }</font>
<font color="black"> 525.                     # }</font>
<font color="black"> 526.                     #</font>
<font color="red"> 527.                     fake_has = {</font>
<font color="red"> 528.                         'resource': {</font>
<font color="red"> 529.                             'type': name,</font>
<font color="red"> 530.                             'identifiers': []</font>
<font color="black"> 531.                         }</font>
<font color="black"> 532.                     }</font>
<font color="black"> 533. </font>
<font color="red"> 534.                     for identifier in resource_def.get('identifiers', []):</font>
<font color="red"> 535.                         fake_has['resource']['identifiers'].append({</font>
<font color="red"> 536.                             'target': identifier['name'], 'source': 'input'</font>
<font color="black"> 537.                         })</font>
<font color="black"> 538. </font>
<font color="red"> 539.                     definition[name] = fake_has</font>
<font color="black"> 540.         else:</font>
<font color="red"> 541.             definition = self._definition.get('has', {})</font>
<font color="black"> 542. </font>
<font color="red"> 543.         return definition</font>
<font color="black"> 544. </font>
<font color="green"> 545.     def _get_related_resources(self, subresources):</font>
<font color="black"> 546.         &quot;&quot;&quot;</font>
<font color="black"> 547.         Get a list of sub-resources or references.</font>
<font color="black"> 548. </font>
<font color="black"> 549.         :type subresources: bool</font>
<font color="black"> 550.         :param subresources: ``True`` to get sub-resources, ``False`` to</font>
<font color="black"> 551.                              get references.</font>
<font color="black"> 552.         :rtype: list(:py:class:`ResponseResource`)</font>
<font color="black"> 553.         &quot;&quot;&quot;</font>
<font color="red"> 554.         resources = []</font>
<font color="black"> 555. </font>
<font color="red"> 556.         for name, definition in self._get_has_definition().items():</font>
<font color="red"> 557.             if subresources:</font>
<font color="red"> 558.                 name = self._get_name('subresource', name, snake_case=False)</font>
<font color="black"> 559.             else:</font>
<font color="red"> 560.                 name = self._get_name('reference', name)</font>
<font color="red"> 561.             action = Action(name, definition, self._resource_defs)</font>
<font color="black"> 562. </font>
<font color="red"> 563.             data_required = False</font>
<font color="red"> 564.             for identifier in action.resource.identifiers:</font>
<font color="red"> 565.                 if identifier.source == 'data':</font>
<font color="red"> 566.                     data_required = True</font>
<font color="red"> 567.                     break</font>
<font color="black"> 568. </font>
<font color="red"> 569.             if subresources and not data_required:</font>
<font color="red"> 570.                 resources.append(action)</font>
<font color="red"> 571.             elif not subresources and data_required:</font>
<font color="red"> 572.                 resources.append(action)</font>
<font color="black"> 573. </font>
<font color="red"> 574.         return resources</font>
<font color="black"> 575. </font>
<font color="green"> 576.     @property</font>
<font color="black"> 577.     def subresources(self):</font>
<font color="black"> 578.         &quot;&quot;&quot;</font>
<font color="black"> 579.         Get a list of sub-resources.</font>
<font color="black"> 580. </font>
<font color="black"> 581.         :type: list(:py:class:`ResponseResource`)</font>
<font color="black"> 582.         &quot;&quot;&quot;</font>
<font color="red"> 583.         return self._get_related_resources(True)</font>
<font color="black"> 584. </font>
<font color="green"> 585.     @property</font>
<font color="black"> 586.     def references(self):</font>
<font color="black"> 587.         &quot;&quot;&quot;</font>
<font color="black"> 588.         Get a list of reference resources.</font>
<font color="black"> 589. </font>
<font color="black"> 590.         :type: list(:py:class:`ResponseResource`)</font>
<font color="black"> 591.         &quot;&quot;&quot;</font>
<font color="red"> 592.         return self._get_related_resources(False)</font>
<font color="black"> 593. </font>
<font color="green"> 594.     @property</font>
<font color="black"> 595.     def collections(self):</font>
<font color="black"> 596.         &quot;&quot;&quot;</font>
<font color="black"> 597.         Get a list of collections for this resource.</font>
<font color="black"> 598. </font>
<font color="black"> 599.         :type: list(:py:class:`Collection`)</font>
<font color="black"> 600.         &quot;&quot;&quot;</font>
<font color="red"> 601.         collections = []</font>
<font color="black"> 602. </font>
<font color="red"> 603.         for name, item in self._definition.get('hasMany', {}).items():</font>
<font color="red"> 604.             name = self._get_name('collection', name)</font>
<font color="red"> 605.             collections.append(Collection(name, item, self._resource_defs))</font>
<font color="black"> 606. </font>
<font color="red"> 607.         return collections</font>
<font color="black"> 608. </font>
<font color="green"> 609.     @property</font>
<font color="black"> 610.     def waiters(self):</font>
<font color="black"> 611.         &quot;&quot;&quot;</font>
<font color="black"> 612.         Get a list of waiters for this resource.</font>
<font color="black"> 613. </font>
<font color="black"> 614.         :type: list(:py:class:`Waiter`)</font>
<font color="black"> 615.         &quot;&quot;&quot;</font>
<font color="red"> 616.         waiters = []</font>
<font color="black"> 617. </font>
<font color="red"> 618.         for name, item in self._definition.get('waiters', {}).items():</font>
<font color="red"> 619.             name = self._get_name('waiter', Waiter.PREFIX + name)</font>
<font color="red"> 620.             waiters.append(Waiter(name, item))</font>
<font color="black"> 621. </font>
<font color="red"> 622.         return waiters</font>
</pre>

