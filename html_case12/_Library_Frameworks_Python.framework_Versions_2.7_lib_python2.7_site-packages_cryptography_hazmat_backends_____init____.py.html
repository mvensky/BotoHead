source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/cryptography/hazmat/backends/__init__.py</b><br>


file stats: <b>28 lines, 7 executed: 25.0% covered</b>
<pre>
<font color="black">   1. # This file is dual licensed under the terms of the Apache License, Version</font>
<font color="black">   2. # 2.0, and the BSD License. See the LICENSE file in the root of this repository</font>
<font color="black">   3. # for complete details.</font>
<font color="black">   4. </font>
<font color="green">   5. from __future__ import absolute_import, division, print_function</font>
<font color="black">   6. </font>
<font color="green">   7. from cryptography.hazmat.backends.multibackend import MultiBackend</font>
<font color="black">   8. </font>
<font color="black">   9. </font>
<font color="green">  10. _available_backends_list = None</font>
<font color="black">  11. </font>
<font color="black">  12. </font>
<font color="green">  13. def _available_backends():</font>
<font color="black">  14.     global _available_backends_list</font>
<font color="black">  15. </font>
<font color="red">  16.     if _available_backends_list is None:</font>
<font color="black">  17.         # Lazy import pkg_resources here to avoid the performance issue</font>
<font color="black">  18.         # on systems with many packages detailed in</font>
<font color="black">  19.         # https://github.com/pypa/setuptools/issues/926</font>
<font color="red">  20.         import pkg_resources</font>
<font color="black">  21. </font>
<font color="black">  22.         entry_point_backends = [</font>
<font color="black">  23.             # DeprecatedIn16</font>
<font color="black">  24.             # setuptools 11.3 deprecated support for the require parameter to</font>
<font color="black">  25.             # load(), and introduced the new resolve() method instead.</font>
<font color="black">  26.             # We previously removed this fallback, but users are having issues</font>
<font color="black">  27.             # where Python loads an older setuptools due to various syspath</font>
<font color="black">  28.             # weirdness.</font>
<font color="red">  29.             ep.resolve() if hasattr(ep, &quot;resolve&quot;) else ep.load(require=False)</font>
<font color="red">  30.             for ep in pkg_resources.iter_entry_points(</font>
<font color="red">  31.                 &quot;cryptography.backends&quot;</font>
<font color="black">  32.             )</font>
<font color="black">  33.         ]</font>
<font color="black">  34. </font>
<font color="red">  35.         _available_backends_list = _backend_import_fallback(</font>
<font color="red">  36.             entry_point_backends</font>
<font color="black">  37.         )</font>
<font color="black">  38. </font>
<font color="red">  39.     return _available_backends_list</font>
<font color="black">  40. </font>
<font color="black">  41. </font>
<font color="green">  42. def _backend_import_fallback(backends):</font>
<font color="black">  43.     # If backends already exist just return them. This branch is here</font>
<font color="black">  44.     # to get full line coverage from our tests.</font>
<font color="red">  45.     if backends:</font>
<font color="red">  46.         return backends</font>
<font color="black">  47. </font>
<font color="black">  48.     # if iter_entry_points fails to find any backends then manually try to</font>
<font color="black">  49.     # import our current backends as a workaround for issues with application</font>
<font color="black">  50.     # bundlers like pyinstaller, cx_freeze, etc</font>
<font color="black">  51. </font>
<font color="black">  52.     # OpenSSL is guaranteed to be present until we unbundle the backends.</font>
<font color="red">  53.     from cryptography.hazmat.backends.openssl.backend import backend as be_ossl</font>
<font color="red">  54.     backends = [be_ossl]</font>
<font color="red">  55.     try:</font>
<font color="red">  56.         from cryptography.hazmat.backends.commoncrypto.backend import (</font>
<font color="black">  57.             backend as be_cc</font>
<font color="black">  58.         )</font>
<font color="red">  59.     except ImportError:</font>
<font color="red">  60.         pass</font>
<font color="black">  61.     else:</font>
<font color="red">  62.         backends.append(be_cc)</font>
<font color="black">  63. </font>
<font color="red">  64.     return backends</font>
<font color="black">  65. </font>
<font color="black">  66. </font>
<font color="green">  67. _default_backend = None</font>
<font color="black">  68. </font>
<font color="black">  69. </font>
<font color="green">  70. def default_backend():</font>
<font color="black">  71.     global _default_backend</font>
<font color="black">  72. </font>
<font color="red">  73.     if _default_backend is None:</font>
<font color="red">  74.         _default_backend = MultiBackend(_available_backends())</font>
<font color="black">  75. </font>
<font color="red">  76.     return _default_backend</font>
</pre>

