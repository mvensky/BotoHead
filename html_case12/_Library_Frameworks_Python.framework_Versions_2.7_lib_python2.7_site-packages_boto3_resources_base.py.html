source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/boto3/resources/base.py</b><br>


file stats: <b>65 lines, 17 executed: 26.2% covered</b>
<pre>
<font color="black">   1. # Copyright 2014 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="black">  13. </font>
<font color="green">  14. import logging</font>
<font color="black">  15. </font>
<font color="green">  16. import boto3</font>
<font color="black">  17. </font>
<font color="black">  18. </font>
<font color="green">  19. logger = logging.getLogger(__name__)</font>
<font color="black">  20. </font>
<font color="black">  21. </font>
<font color="green">  22. class ResourceMeta(object):</font>
<font color="black">  23.     &quot;&quot;&quot;</font>
<font color="black">  24.     An object containing metadata about a resource.</font>
<font color="green">  25.     &quot;&quot;&quot;</font>
<font color="green">  26.     def __init__(self, service_name, identifiers=None, client=None,</font>
<font color="green">  27.                  data=None, resource_model=None):</font>
<font color="black">  28.         #: (``string``) The service name, e.g. 's3'</font>
<font color="red">  29.         self.service_name = service_name</font>
<font color="black">  30. </font>
<font color="red">  31.         if identifiers is None:</font>
<font color="red">  32.             identifiers = []</font>
<font color="black">  33.         #: (``list``) List of identifier names</font>
<font color="red">  34.         self.identifiers = identifiers</font>
<font color="black">  35. </font>
<font color="black">  36.         #: (:py:class:`~botocore.client.BaseClient`) Low-level Botocore client</font>
<font color="red">  37.         self.client = client</font>
<font color="black">  38.         #: (``dict``) Loaded resource data attributes</font>
<font color="red">  39.         self.data = data</font>
<font color="black">  40. </font>
<font color="black">  41.         # The resource model for that resource</font>
<font color="red">  42.         self.resource_model = resource_model</font>
<font color="black">  43. </font>
<font color="green">  44.     def __repr__(self):</font>
<font color="red">  45.         return 'ResourceMeta(\'{0}\', identifiers={1})'.format(</font>
<font color="red">  46.             self.service_name, self.identifiers)</font>
<font color="black">  47. </font>
<font color="green">  48.     def __eq__(self, other):</font>
<font color="black">  49.         # Two metas are equal if their components are all equal</font>
<font color="red">  50.         if other.__class__.__name__ != self.__class__.__name__:</font>
<font color="red">  51.             return False</font>
<font color="black">  52. </font>
<font color="red">  53.         return self.__dict__ == other.__dict__</font>
<font color="black">  54. </font>
<font color="green">  55.     def copy(self):</font>
<font color="black">  56.         &quot;&quot;&quot;</font>
<font color="black">  57.         Create a copy of this metadata object.</font>
<font color="black">  58.         &quot;&quot;&quot;</font>
<font color="red">  59.         params = self.__dict__.copy()</font>
<font color="red">  60.         service_name = params.pop('service_name')</font>
<font color="red">  61.         return ResourceMeta(service_name, **params)</font>
<font color="black">  62. </font>
<font color="black">  63. </font>
<font color="green">  64. class ServiceResource(object):</font>
<font color="black">  65.     &quot;&quot;&quot;</font>
<font color="black">  66.     A base class for resources.</font>
<font color="black">  67. </font>
<font color="black">  68.     :type client: botocore.client</font>
<font color="black">  69.     :param client: A low-level Botocore client instance</font>
<font color="green">  70.     &quot;&quot;&quot;</font>
<font color="black">  71. </font>
<font color="green">  72.     meta = None</font>
<font color="black">  73.     &quot;&quot;&quot;</font>
<font color="black">  74.     Stores metadata about this resource instance, such as the</font>
<font color="black">  75.     ``service_name``, the low-level ``client`` and any cached ``data``</font>
<font color="black">  76.     from when the instance was hydrated. For example::</font>
<font color="black">  77. </font>
<font color="black">  78.         # Get a low-level client from a resource instance</font>
<font color="black">  79.         client = resource.meta.client</font>
<font color="black">  80.         response = client.operation(Param='foo')</font>
<font color="black">  81. </font>
<font color="black">  82.         # Print the resource instance's service short name</font>
<font color="black">  83.         print(resource.meta.service_name)</font>
<font color="black">  84. </font>
<font color="black">  85.     See :py:class:`ResourceMeta` for more information.</font>
<font color="black">  86.     &quot;&quot;&quot;</font>
<font color="black">  87. </font>
<font color="green">  88.     def __init__(self, *args, **kwargs):</font>
<font color="black">  89.         # Always work on a copy of meta, otherwise we would affect other</font>
<font color="black">  90.         # instances of the same subclass.</font>
<font color="red">  91.         self.meta = self.meta.copy()</font>
<font color="black">  92. </font>
<font color="black">  93.         # Create a default client if none was passed</font>
<font color="red">  94.         if kwargs.get('client') is not None:</font>
<font color="red">  95.             self.meta.client = kwargs.get('client')</font>
<font color="black">  96.         else:</font>
<font color="red">  97.             self.meta.client = boto3.client(self.meta.service_name)</font>
<font color="black">  98. </font>
<font color="black">  99.         # Allow setting identifiers as positional arguments in the order</font>
<font color="black"> 100.         # in which they were defined in the ResourceJSON.</font>
<font color="red"> 101.         for i, value in enumerate(args):</font>
<font color="red"> 102.             setattr(self, '_' + self.meta.identifiers[i], value)</font>
<font color="black"> 103. </font>
<font color="black"> 104.         # Allow setting identifiers via keyword arguments. Here we need</font>
<font color="black"> 105.         # extra logic to ignore other keyword arguments like ``client``.</font>
<font color="red"> 106.         for name, value in kwargs.items():</font>
<font color="red"> 107.             if name == 'client':</font>
<font color="red"> 108.                 continue</font>
<font color="black"> 109. </font>
<font color="red"> 110.             if name not in self.meta.identifiers:</font>
<font color="red"> 111.                 raise ValueError('Unknown keyword argument: {0}'.format(name))</font>
<font color="black"> 112. </font>
<font color="red"> 113.             setattr(self, '_' + name, value)</font>
<font color="black"> 114. </font>
<font color="black"> 115.         # Validate that all identifiers have been set.</font>
<font color="red"> 116.         for identifier in self.meta.identifiers:</font>
<font color="red"> 117.             if getattr(self, identifier) is None:</font>
<font color="red"> 118.                 raise ValueError(</font>
<font color="red"> 119.                     'Required parameter {0} not set'.format(identifier))</font>
<font color="black"> 120. </font>
<font color="green"> 121.     def __repr__(self):</font>
<font color="red"> 122.         identifiers = []</font>
<font color="red"> 123.         for identifier in self.meta.identifiers:</font>
<font color="red"> 124.             identifiers.append('{0}={1}'.format(</font>
<font color="red"> 125.                 identifier, repr(getattr(self, identifier))))</font>
<font color="red"> 126.         return &quot;{0}({1})&quot;.format(</font>
<font color="red"> 127.             self.__class__.__name__,</font>
<font color="red"> 128.             ', '.join(identifiers),</font>
<font color="black"> 129.         )</font>
<font color="black"> 130. </font>
<font color="green"> 131.     def __eq__(self, other):</font>
<font color="black"> 132.         # Should be instances of the same resource class</font>
<font color="red"> 133.         if other.__class__.__name__ != self.__class__.__name__:</font>
<font color="red"> 134.             return False</font>
<font color="black"> 135. </font>
<font color="black"> 136.         # Each of the identifiers should have the same value in both</font>
<font color="black"> 137.         # instances, e.g. two buckets need the same name to be equal.</font>
<font color="red"> 138.         for identifier in self.meta.identifiers:</font>
<font color="red"> 139.             if getattr(self, identifier) != getattr(other, identifier):</font>
<font color="red"> 140.                 return False</font>
<font color="black"> 141. </font>
<font color="red"> 142.         return True</font>
<font color="black"> 143. </font>
<font color="green"> 144.     def __hash__(self):</font>
<font color="red"> 145.         identifiers = []</font>
<font color="red"> 146.         for identifier in self.meta.identifiers:</font>
<font color="red"> 147.             identifiers.append(getattr(self, identifier))</font>
<font color="red"> 148.         return hash((self.__class__.__name__, tuple(identifiers)))</font>
</pre>

