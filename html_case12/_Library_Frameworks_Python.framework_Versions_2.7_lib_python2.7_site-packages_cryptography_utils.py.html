source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/cryptography/utils.py</b><br>


file stats: <b>90 lines, 45 executed: 50.0% covered</b>
<pre>
<font color="black">   1. # This file is dual licensed under the terms of the Apache License, Version</font>
<font color="black">   2. # 2.0, and the BSD License. See the LICENSE file in the root of this repository</font>
<font color="black">   3. # for complete details.</font>
<font color="black">   4. </font>
<font color="green">   5. from __future__ import absolute_import, division, print_function</font>
<font color="black">   6. </font>
<font color="green">   7. import abc</font>
<font color="green">   8. import binascii</font>
<font color="green">   9. import inspect</font>
<font color="green">  10. import sys</font>
<font color="green">  11. import warnings</font>
<font color="black">  12. </font>
<font color="green">  13. from packaging.version import parse</font>
<font color="black">  14. </font>
<font color="black">  15. </font>
<font color="black">  16. # the functions deprecated in 1.0 and 1.4 are on an arbitrarily extended</font>
<font color="black">  17. # deprecation cycle and should not be removed until we agree on when that cycle</font>
<font color="black">  18. # ends.</font>
<font color="green">  19. DeprecatedIn10 = DeprecationWarning</font>
<font color="green">  20. DeprecatedIn14 = DeprecationWarning</font>
<font color="green">  21. DeprecatedIn16 = DeprecationWarning</font>
<font color="black">  22. </font>
<font color="black">  23. </font>
<font color="green">  24. def read_only_property(name):</font>
<font color="green">  25.     return property(lambda self: getattr(self, name))</font>
<font color="black">  26. </font>
<font color="black">  27. </font>
<font color="green">  28. def register_interface(iface):</font>
<font color="green">  29.     def register_decorator(klass):</font>
<font color="green">  30.         verify_interface(iface, klass)</font>
<font color="green">  31.         iface.register(klass)</font>
<font color="green">  32.         return klass</font>
<font color="green">  33.     return register_decorator</font>
<font color="black">  34. </font>
<font color="black">  35. </font>
<font color="green">  36. def register_interface_if(predicate, iface):</font>
<font color="red">  37.     def register_decorator(klass):</font>
<font color="red">  38.         if predicate:</font>
<font color="red">  39.             verify_interface(iface, klass)</font>
<font color="red">  40.             iface.register(klass)</font>
<font color="red">  41.         return klass</font>
<font color="red">  42.     return register_decorator</font>
<font color="black">  43. </font>
<font color="black">  44. </font>
<font color="green">  45. if hasattr(int, &quot;from_bytes&quot;):</font>
<font color="red">  46.     int_from_bytes = int.from_bytes</font>
<font color="black">  47. else:</font>
<font color="green">  48.     def int_from_bytes(data, byteorder, signed=False):</font>
<font color="red">  49.         assert byteorder == 'big'</font>
<font color="red">  50.         assert not signed</font>
<font color="black">  51. </font>
<font color="black">  52.         # call bytes() on data to allow the use of bytearrays</font>
<font color="red">  53.         return int(bytes(data).encode('hex'), 16)</font>
<font color="black">  54. </font>
<font color="black">  55. </font>
<font color="green">  56. def int_to_bytes(integer, length=None):</font>
<font color="red">  57.     hex_string = '%x' % integer</font>
<font color="red">  58.     if length is None:</font>
<font color="red">  59.         n = len(hex_string)</font>
<font color="black">  60.     else:</font>
<font color="red">  61.         n = length * 2</font>
<font color="red">  62.     return binascii.unhexlify(hex_string.zfill(n + (n &amp; 1)))</font>
<font color="black">  63. </font>
<font color="black">  64. </font>
<font color="green">  65. class InterfaceNotImplemented(Exception):</font>
<font color="green">  66.     pass</font>
<font color="black">  67. </font>
<font color="black">  68. </font>
<font color="green">  69. if hasattr(inspect, &quot;signature&quot;):</font>
<font color="red">  70.     signature = inspect.signature</font>
<font color="black">  71. else:</font>
<font color="green">  72.     signature = inspect.getargspec</font>
<font color="black">  73. </font>
<font color="black">  74. </font>
<font color="green">  75. def verify_interface(iface, klass):</font>
<font color="green">  76.     for method in iface.__abstractmethods__:</font>
<font color="green">  77.         if not hasattr(klass, method):</font>
<font color="red">  78.             raise InterfaceNotImplemented(</font>
<font color="red">  79.                 &quot;{0} is missing a {1!r} method&quot;.format(klass, method)</font>
<font color="black">  80.             )</font>
<font color="green">  81.         if isinstance(getattr(iface, method), abc.abstractproperty):</font>
<font color="black">  82.             # Can't properly verify these yet.</font>
<font color="red">  83.             continue</font>
<font color="green">  84.         sig = signature(getattr(iface, method))</font>
<font color="green">  85.         actual = signature(getattr(klass, method))</font>
<font color="green">  86.         if sig != actual:</font>
<font color="red">  87.             raise InterfaceNotImplemented(</font>
<font color="red">  88.                 &quot;{0}.{1}'s signature differs from the expected. Expected: &quot;</font>
<font color="black">  89.                 &quot;{2!r}. Received: {3!r}&quot;.format(</font>
<font color="red">  90.                     klass, method, sig, actual</font>
<font color="black">  91.                 )</font>
<font color="black">  92.             )</font>
<font color="black">  93. </font>
<font color="black">  94. </font>
<font color="green">  95. if sys.version_info &gt;= (2, 7):</font>
<font color="green">  96.     def bit_length(x):</font>
<font color="red">  97.         return x.bit_length()</font>
<font color="black">  98. else:</font>
<font color="red">  99.     def bit_length(x):</font>
<font color="red"> 100.         return len(bin(x)) - (2 + (x &lt;= 0))</font>
<font color="black"> 101. </font>
<font color="black"> 102. </font>
<font color="green"> 103. def _version_check(version, required_version):</font>
<font color="black"> 104.     # This is used to check if we support update_into on CipherContext.</font>
<font color="red"> 105.     return parse(version) &gt;= parse(required_version)</font>
<font color="black"> 106. </font>
<font color="black"> 107. </font>
<font color="green"> 108. class _DeprecatedValue(object):</font>
<font color="green"> 109.     def __init__(self, value, message, warning_class):</font>
<font color="red"> 110.         self.value = value</font>
<font color="red"> 111.         self.message = message</font>
<font color="red"> 112.         self.warning_class = warning_class</font>
<font color="black"> 113. </font>
<font color="black"> 114. </font>
<font color="green"> 115. class _ModuleWithDeprecations(object):</font>
<font color="green"> 116.     def __init__(self, module):</font>
<font color="red"> 117.         self.__dict__[&quot;_module&quot;] = module</font>
<font color="black"> 118. </font>
<font color="green"> 119.     def __getattr__(self, attr):</font>
<font color="red"> 120.         obj = getattr(self._module, attr)</font>
<font color="red"> 121.         if isinstance(obj, _DeprecatedValue):</font>
<font color="red"> 122.             warnings.warn(obj.message, obj.warning_class, stacklevel=2)</font>
<font color="red"> 123.             obj = obj.value</font>
<font color="red"> 124.         return obj</font>
<font color="black"> 125. </font>
<font color="green"> 126.     def __setattr__(self, attr, value):</font>
<font color="red"> 127.         setattr(self._module, attr, value)</font>
<font color="black"> 128. </font>
<font color="green"> 129.     def __delattr__(self, attr):</font>
<font color="red"> 130.         obj = getattr(self._module, attr)</font>
<font color="red"> 131.         if isinstance(obj, _DeprecatedValue):</font>
<font color="red"> 132.             warnings.warn(obj.message, obj.warning_class, stacklevel=2)</font>
<font color="black"> 133. </font>
<font color="red"> 134.         delattr(self._module, attr)</font>
<font color="black"> 135. </font>
<font color="green"> 136.     def __dir__(self):</font>
<font color="red"> 137.         return [&quot;_module&quot;] + dir(self._module)</font>
<font color="black"> 138. </font>
<font color="black"> 139. </font>
<font color="green"> 140. def deprecated(value, module_name, message, warning_class):</font>
<font color="red"> 141.     module = sys.modules[module_name]</font>
<font color="red"> 142.     if not isinstance(module, _ModuleWithDeprecations):</font>
<font color="red"> 143.         sys.modules[module_name] = module = _ModuleWithDeprecations(module)</font>
<font color="red"> 144.     return _DeprecatedValue(value, message, warning_class)</font>
</pre>

