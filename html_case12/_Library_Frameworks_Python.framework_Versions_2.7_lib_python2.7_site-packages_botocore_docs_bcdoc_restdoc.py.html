source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/docs/bcdoc/restdoc.py</b><br>


file stats: <b>108 lines, 33 executed: 30.6% covered</b>
<pre>
<font color="black">   1. # Copyright 2012-2013 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. #     http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. import logging</font>
<font color="black">  14. </font>
<font color="green">  15. from botocore.compat import OrderedDict</font>
<font color="green">  16. from botocore.docs.bcdoc.docstringparser import DocStringParser</font>
<font color="green">  17. from botocore.docs.bcdoc.style import ReSTStyle</font>
<font color="black">  18. </font>
<font color="green">  19. LOG = logging.getLogger('bcdocs')</font>
<font color="black">  20. </font>
<font color="black">  21. </font>
<font color="green">  22. class ReSTDocument(object):</font>
<font color="black">  23. </font>
<font color="green">  24.     def __init__(self, target='man'):</font>
<font color="red">  25.         self.style = ReSTStyle(self)</font>
<font color="red">  26.         self.target = target</font>
<font color="red">  27.         self.parser = DocStringParser(self)</font>
<font color="red">  28.         self.keep_data = True</font>
<font color="red">  29.         self.do_translation = False</font>
<font color="red">  30.         self.translation_map = {}</font>
<font color="red">  31.         self.hrefs = {}</font>
<font color="red">  32.         self._writes = []</font>
<font color="red">  33.         self._last_doc_string = None</font>
<font color="black">  34. </font>
<font color="green">  35.     def _write(self, s):</font>
<font color="red">  36.         if self.keep_data and s is not None:</font>
<font color="red">  37.             self._writes.append(s)</font>
<font color="black">  38. </font>
<font color="green">  39.     def write(self, content):</font>
<font color="black">  40.         &quot;&quot;&quot;</font>
<font color="black">  41.         Write content into the document.</font>
<font color="black">  42.         &quot;&quot;&quot;</font>
<font color="red">  43.         self._write(content)</font>
<font color="black">  44. </font>
<font color="green">  45.     def writeln(self, content):</font>
<font color="black">  46.         &quot;&quot;&quot;</font>
<font color="black">  47.         Write content on a newline.</font>
<font color="black">  48.         &quot;&quot;&quot;</font>
<font color="red">  49.         self._write('%s%s\n' % (self.style.spaces(), content))</font>
<font color="black">  50. </font>
<font color="green">  51.     def peek_write(self):</font>
<font color="black">  52.         &quot;&quot;&quot;</font>
<font color="black">  53.         Returns the last content written to the document without</font>
<font color="black">  54.         removing it from the stack.</font>
<font color="black">  55.         &quot;&quot;&quot;</font>
<font color="red">  56.         return self._writes[-1]</font>
<font color="black">  57. </font>
<font color="green">  58.     def pop_write(self):</font>
<font color="black">  59.         &quot;&quot;&quot;</font>
<font color="black">  60.         Removes and returns the last content written to the stack.</font>
<font color="black">  61.         &quot;&quot;&quot;</font>
<font color="red">  62.         return self._writes.pop()</font>
<font color="black">  63. </font>
<font color="green">  64.     def push_write(self, s):</font>
<font color="black">  65.         &quot;&quot;&quot;</font>
<font color="black">  66.         Places new content on the stack.</font>
<font color="black">  67.         &quot;&quot;&quot;</font>
<font color="red">  68.         self._writes.append(s)</font>
<font color="black">  69. </font>
<font color="green">  70.     def getvalue(self):</font>
<font color="black">  71.         &quot;&quot;&quot;</font>
<font color="black">  72.         Returns the current content of the document as a string.</font>
<font color="black">  73.         &quot;&quot;&quot;</font>
<font color="red">  74.         if self.hrefs:</font>
<font color="red">  75.             self.style.new_paragraph()</font>
<font color="red">  76.             for refname, link in self.hrefs.items():</font>
<font color="red">  77.                 self.style.link_target_definition(refname, link)</font>
<font color="red">  78.         return ''.join(self._writes).encode('utf-8')</font>
<font color="black">  79. </font>
<font color="green">  80.     def translate_words(self, words):</font>
<font color="red">  81.         return [self.translation_map.get(w, w) for w in words]</font>
<font color="black">  82. </font>
<font color="green">  83.     def handle_data(self, data):</font>
<font color="red">  84.         if data and self.keep_data:</font>
<font color="red">  85.             self._write(data)</font>
<font color="black">  86. </font>
<font color="green">  87.     def include_doc_string(self, doc_string):</font>
<font color="red">  88.         if doc_string:</font>
<font color="red">  89.             try:</font>
<font color="red">  90.                 start = len(self._writes)</font>
<font color="red">  91.                 self.parser.feed(doc_string)</font>
<font color="red">  92.                 self.parser.close()</font>
<font color="red">  93.                 end = len(self._writes)</font>
<font color="red">  94.                 self._last_doc_string = (start, end)</font>
<font color="red">  95.             except Exception:</font>
<font color="red">  96.                 LOG.debug('Error parsing doc string', exc_info=True)</font>
<font color="red">  97.                 LOG.debug(doc_string)</font>
<font color="black">  98. </font>
<font color="green">  99.     def remove_last_doc_string(self):</font>
<font color="black"> 100.         # Removes all writes inserted by last doc string</font>
<font color="red"> 101.         if self._last_doc_string is not None:</font>
<font color="red"> 102.             start, end = self._last_doc_string</font>
<font color="red"> 103.             del self._writes[start:end]</font>
<font color="black"> 104. </font>
<font color="black"> 105. </font>
<font color="green"> 106. class DocumentStructure(ReSTDocument):</font>
<font color="green"> 107.     def __init__(self, name, section_names=None, target='man', context=None):</font>
<font color="black"> 108.         &quot;&quot;&quot;Provides a Hierarichial structure to a ReSTDocument</font>
<font color="black"> 109. </font>
<font color="black"> 110.         You can write to it similiar to as you can to a ReSTDocument but</font>
<font color="black"> 111.         has an innate structure for more orginaztion and abstraction.</font>
<font color="black"> 112. </font>
<font color="black"> 113.         :param name: The name of the document</font>
<font color="black"> 114.         :param section_names: A list of sections to be included</font>
<font color="black"> 115.             in the document.</font>
<font color="black"> 116.         :param target: The target documentation of the Document structure</font>
<font color="black"> 117.         :param context: A dictionary of data to store with the strucuture. These</font>
<font color="black"> 118.             are only stored per section not the entire structure.</font>
<font color="black"> 119.         &quot;&quot;&quot;</font>
<font color="red"> 120.         super(DocumentStructure, self).__init__(target=target)</font>
<font color="red"> 121.         self._name = name</font>
<font color="red"> 122.         self._structure = OrderedDict()</font>
<font color="red"> 123.         self._path = [self._name]</font>
<font color="red"> 124.         self._context = {}</font>
<font color="red"> 125.         if context is not None:</font>
<font color="red"> 126.             self._context = context</font>
<font color="red"> 127.         if section_names is not None:</font>
<font color="red"> 128.             self._generate_structure(section_names)</font>
<font color="black"> 129. </font>
<font color="green"> 130.     @property</font>
<font color="black"> 131.     def name(self):</font>
<font color="black"> 132.         &quot;&quot;&quot;The name of the document structure&quot;&quot;&quot;</font>
<font color="red"> 133.         return self._name</font>
<font color="black"> 134. </font>
<font color="green"> 135.     @property</font>
<font color="black"> 136.     def path(self):</font>
<font color="black"> 137.         &quot;&quot;&quot;</font>
<font color="black"> 138.         A list of where to find a particular document structure in the</font>
<font color="black"> 139.         overlying document structure.</font>
<font color="black"> 140.         &quot;&quot;&quot;</font>
<font color="red"> 141.         return self._path</font>
<font color="black"> 142. </font>
<font color="green"> 143.     @path.setter</font>
<font color="black"> 144.     def path(self, value):</font>
<font color="red"> 145.         self._path = value</font>
<font color="black"> 146. </font>
<font color="green"> 147.     @property</font>
<font color="black"> 148.     def available_sections(self):</font>
<font color="red"> 149.         return list(self._structure)</font>
<font color="black"> 150. </font>
<font color="green"> 151.     @property</font>
<font color="black"> 152.     def context(self):</font>
<font color="red"> 153.         return self._context</font>
<font color="black"> 154. </font>
<font color="green"> 155.     def _generate_structure(self, section_names):</font>
<font color="red"> 156.         for section_name in section_names:</font>
<font color="red"> 157.             self.add_new_section(section_name)</font>
<font color="black"> 158. </font>
<font color="green"> 159.     def add_new_section(self, name, context=None):</font>
<font color="black"> 160.         &quot;&quot;&quot;Adds a new section to the current document structure</font>
<font color="black"> 161. </font>
<font color="black"> 162.         This document structure will be considered a section to the</font>
<font color="black"> 163.         current document structure but will in itself be an entirely</font>
<font color="black"> 164.         new document structure that can be written to and have sections</font>
<font color="black"> 165.         as well</font>
<font color="black"> 166. </font>
<font color="black"> 167.         :param name: The name of the section.</font>
<font color="black"> 168.         :param context: A dictionary of data to store with the strucuture. These</font>
<font color="black"> 169.             are only stored per section not the entire structure.</font>
<font color="black"> 170.         :rtype: DocumentStructure</font>
<font color="black"> 171.         :returns: A new document structure to add to but lives as a section</font>
<font color="black"> 172.             to the document structure it was instantiated from.</font>
<font color="black"> 173.         &quot;&quot;&quot;</font>
<font color="black"> 174.         # Add a new section</font>
<font color="red"> 175.         section = self.__class__(name=name, target=self.target,</font>
<font color="red"> 176.                                  context=context)</font>
<font color="red"> 177.         section.path = self.path + [name]</font>
<font color="black"> 178.         # Indent the section apporpriately as well</font>
<font color="red"> 179.         section.style.indentation = self.style.indentation</font>
<font color="red"> 180.         section.translation_map = self.translation_map</font>
<font color="red"> 181.         section.hrefs = self.hrefs</font>
<font color="red"> 182.         self._structure[name] = section</font>
<font color="red"> 183.         return section</font>
<font color="black"> 184. </font>
<font color="green"> 185.     def get_section(self, name):</font>
<font color="black"> 186.         &quot;&quot;&quot;Retrieve a section&quot;&quot;&quot;</font>
<font color="red"> 187.         return self._structure[name]</font>
<font color="black"> 188. </font>
<font color="green"> 189.     def delete_section(self, name):</font>
<font color="black"> 190.         &quot;&quot;&quot;Delete a section&quot;&quot;&quot;</font>
<font color="red"> 191.         del self._structure[name]</font>
<font color="black"> 192. </font>
<font color="green"> 193.     def flush_structure(self):</font>
<font color="black"> 194.         &quot;&quot;&quot;Flushes a doc structure to a ReSTructed string</font>
<font color="black"> 195. </font>
<font color="black"> 196.         The document is flushed out in a DFS style where sections and their</font>
<font color="black"> 197.         subsections' values are added to the string as they are visited.</font>
<font color="black"> 198.         &quot;&quot;&quot;</font>
<font color="black"> 199.         # We are at the root flush the links at the beginning of the</font>
<font color="black"> 200.         # document</font>
<font color="red"> 201.         if len(self.path) == 1:</font>
<font color="red"> 202.             if self.hrefs:</font>
<font color="red"> 203.                 self.style.new_paragraph()</font>
<font color="red"> 204.                 for refname, link in self.hrefs.items():</font>
<font color="red"> 205.                     self.style.link_target_definition(refname, link)</font>
<font color="red"> 206.         value = self.getvalue()</font>
<font color="red"> 207.         for name, section in self._structure.items():</font>
<font color="red"> 208.             value += section.flush_structure()</font>
<font color="red"> 209.         return value</font>
<font color="black"> 210. </font>
<font color="green"> 211.     def getvalue(self):</font>
<font color="red"> 212.         return ''.join(self._writes).encode('utf-8')</font>
<font color="black"> 213. </font>
<font color="green"> 214.     def remove_all_sections(self):</font>
<font color="red"> 215.         self._structure = OrderedDict()</font>
<font color="black"> 216. </font>
<font color="green"> 217.     def clear_text(self):</font>
<font color="red"> 218.         self._writes = []</font>
</pre>

