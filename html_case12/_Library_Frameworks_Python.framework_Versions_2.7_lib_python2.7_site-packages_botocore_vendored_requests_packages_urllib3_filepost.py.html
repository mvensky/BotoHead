source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/vendored/requests/packages/urllib3/filepost.py</b><br>


file stats: <b>38 lines, 11 executed: 28.9% covered</b>
<pre>
<font color="green">   1. import codecs</font>
<font color="black">   2. </font>
<font color="green">   3. from uuid import uuid4</font>
<font color="green">   4. from io import BytesIO</font>
<font color="black">   5. </font>
<font color="green">   6. from .packages import six</font>
<font color="green">   7. from .packages.six import b</font>
<font color="green">   8. from .fields import RequestField</font>
<font color="black">   9. </font>
<font color="green">  10. writer = codecs.lookup('utf-8')[3]</font>
<font color="black">  11. </font>
<font color="black">  12. </font>
<font color="green">  13. def choose_boundary():</font>
<font color="black">  14.     &quot;&quot;&quot;</font>
<font color="black">  15.     Our embarassingly-simple replacement for mimetools.choose_boundary.</font>
<font color="black">  16.     &quot;&quot;&quot;</font>
<font color="red">  17.     return uuid4().hex</font>
<font color="black">  18. </font>
<font color="black">  19. </font>
<font color="green">  20. def iter_field_objects(fields):</font>
<font color="black">  21.     &quot;&quot;&quot;</font>
<font color="black">  22.     Iterate over fields.</font>
<font color="black">  23. </font>
<font color="black">  24.     Supports list of (k, v) tuples and dicts, and lists of</font>
<font color="black">  25.     :class:`~urllib3.fields.RequestField`.</font>
<font color="black">  26. </font>
<font color="black">  27.     &quot;&quot;&quot;</font>
<font color="red">  28.     if isinstance(fields, dict):</font>
<font color="red">  29.         i = six.iteritems(fields)</font>
<font color="black">  30.     else:</font>
<font color="red">  31.         i = iter(fields)</font>
<font color="black">  32. </font>
<font color="red">  33.     for field in i:</font>
<font color="red">  34.         if isinstance(field, RequestField):</font>
<font color="red">  35.             yield field</font>
<font color="black">  36.         else:</font>
<font color="red">  37.             yield RequestField.from_tuples(*field)</font>
<font color="black">  38. </font>
<font color="black">  39. </font>
<font color="green">  40. def iter_fields(fields):</font>
<font color="black">  41.     &quot;&quot;&quot;</font>
<font color="black">  42.     .. deprecated:: 1.6</font>
<font color="black">  43. </font>
<font color="black">  44.     Iterate over fields.</font>
<font color="black">  45. </font>
<font color="black">  46.     The addition of :class:`~urllib3.fields.RequestField` makes this function</font>
<font color="black">  47.     obsolete. Instead, use :func:`iter_field_objects`, which returns</font>
<font color="black">  48.     :class:`~urllib3.fields.RequestField` objects.</font>
<font color="black">  49. </font>
<font color="black">  50.     Supports list of (k, v) tuples and dicts.</font>
<font color="black">  51.     &quot;&quot;&quot;</font>
<font color="red">  52.     if isinstance(fields, dict):</font>
<font color="red">  53.         return ((k, v) for k, v in six.iteritems(fields))</font>
<font color="black">  54. </font>
<font color="red">  55.     return ((k, v) for k, v in fields)</font>
<font color="black">  56. </font>
<font color="black">  57. </font>
<font color="green">  58. def encode_multipart_formdata(fields, boundary=None):</font>
<font color="black">  59.     &quot;&quot;&quot;</font>
<font color="black">  60.     Encode a dictionary of ``fields`` using the multipart/form-data MIME format.</font>
<font color="black">  61. </font>
<font color="black">  62.     :param fields:</font>
<font color="black">  63.         Dictionary of fields or list of (key, :class:`~urllib3.fields.RequestField`).</font>
<font color="black">  64. </font>
<font color="black">  65.     :param boundary:</font>
<font color="black">  66.         If not specified, then a random boundary will be generated using</font>
<font color="black">  67.         :func:`mimetools.choose_boundary`.</font>
<font color="black">  68.     &quot;&quot;&quot;</font>
<font color="red">  69.     body = BytesIO()</font>
<font color="red">  70.     if boundary is None:</font>
<font color="red">  71.         boundary = choose_boundary()</font>
<font color="black">  72. </font>
<font color="red">  73.     for field in iter_field_objects(fields):</font>
<font color="red">  74.         body.write(b('--%s\r\n' % (boundary)))</font>
<font color="black">  75. </font>
<font color="red">  76.         writer(body).write(field.render_headers())</font>
<font color="red">  77.         data = field.data</font>
<font color="black">  78. </font>
<font color="red">  79.         if isinstance(data, int):</font>
<font color="red">  80.             data = str(data)  # Backwards compatibility</font>
<font color="black">  81. </font>
<font color="red">  82.         if isinstance(data, six.text_type):</font>
<font color="red">  83.             writer(body).write(data)</font>
<font color="black">  84.         else:</font>
<font color="red">  85.             body.write(data)</font>
<font color="black">  86. </font>
<font color="red">  87.         body.write(b'\r\n')</font>
<font color="black">  88. </font>
<font color="red">  89.     body.write(b('--%s--\r\n' % (boundary)))</font>
<font color="black">  90. </font>
<font color="red">  91.     content_type = str('multipart/form-data; boundary=%s' % boundary)</font>
<font color="black">  92. </font>
<font color="red">  93.     return body.getvalue(), content_type</font>
</pre>

