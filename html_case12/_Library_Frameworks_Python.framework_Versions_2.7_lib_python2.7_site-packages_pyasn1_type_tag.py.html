source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pyasn1/type/tag.py</b><br>


file stats: <b>126 lines, 81 executed: 64.3% covered</b>
<pre>
<font color="black">   1. #</font>
<font color="black">   2. # This file is part of pyasn1 software.</font>
<font color="black">   3. #</font>
<font color="black">   4. # Copyright (c) 2005-2017, Ilya Etingof &lt;etingof@gmail.com&gt;</font>
<font color="black">   5. # License: http://pyasn1.sf.net/license.html</font>
<font color="black">   6. #</font>
<font color="green">   7. from operator import getitem</font>
<font color="green">   8. from pyasn1 import error</font>
<font color="black">   9. </font>
<font color="green">  10. __all__ = ['tagClassUniversal', 'tagClassApplication', 'tagClassContext',</font>
<font color="green">  11.            'tagClassPrivate', 'tagFormatSimple', 'tagFormatConstructed',</font>
<font color="green">  12.            'tagCategoryImplicit', 'tagCategoryExplicit', 'tagCategoryUntagged',</font>
<font color="green">  13.            'Tag', 'TagSet']</font>
<font color="black">  14. </font>
<font color="green">  15. tagClassUniversal = 0x00</font>
<font color="green">  16. tagClassApplication = 0x40</font>
<font color="green">  17. tagClassContext = 0x80</font>
<font color="green">  18. tagClassPrivate = 0xC0</font>
<font color="black">  19. </font>
<font color="green">  20. tagFormatSimple = 0x00</font>
<font color="green">  21. tagFormatConstructed = 0x20</font>
<font color="black">  22. </font>
<font color="green">  23. tagCategoryImplicit = 0x01</font>
<font color="green">  24. tagCategoryExplicit = 0x02</font>
<font color="green">  25. tagCategoryUntagged = 0x04</font>
<font color="black">  26. </font>
<font color="black">  27. </font>
<font color="green">  28. class Tag(object):</font>
<font color="green">  29.     &quot;&quot;&quot;ASN.1 types tags&quot;&quot;&quot;</font>
<font color="black">  30. </font>
<font color="green">  31.     def __init__(self, tagClass, tagFormat, tagId):</font>
<font color="green">  32.         if tagId &lt; 0:</font>
<font color="red">  33.             raise error.PyAsn1Error(</font>
<font color="red">  34.                 'Negative tag ID (%s) not allowed' % (tagId,)</font>
<font color="black">  35.             )</font>
<font color="green">  36.         self.__tag = (tagClass, tagFormat, tagId)</font>
<font color="green">  37.         self.uniq = (tagClass, tagId)</font>
<font color="green">  38.         self.__hashedUniqTag = hash(self.uniq)</font>
<font color="black">  39. </font>
<font color="green">  40.     def __str__(self):</font>
<font color="red">  41.         return '[%s:%s:%s]' % self.__tag</font>
<font color="black">  42. </font>
<font color="green">  43.     def __repr__(self):</font>
<font color="red">  44.         return '%s(tagClass=%s, tagFormat=%s, tagId=%s)' % (</font>
<font color="red">  45.             (self.__class__.__name__,) + self.__tag</font>
<font color="black">  46.         )</font>
<font color="black">  47. </font>
<font color="black">  48.     # These is really a hotspot -- expose public &quot;uniq&quot; attribute to save on</font>
<font color="black">  49.     # function calls</font>
<font color="green">  50.     def __eq__(self, other):</font>
<font color="red">  51.         return self.uniq == other.uniq</font>
<font color="black">  52. </font>
<font color="green">  53.     def __ne__(self, other):</font>
<font color="red">  54.         return self.uniq != other.uniq</font>
<font color="black">  55. </font>
<font color="green">  56.     def __lt__(self, other):</font>
<font color="red">  57.         return self.uniq &lt; other.uniq</font>
<font color="black">  58. </font>
<font color="green">  59.     def __le__(self, other):</font>
<font color="red">  60.         return self.uniq &lt;= other.uniq</font>
<font color="black">  61. </font>
<font color="green">  62.     def __gt__(self, other):</font>
<font color="red">  63.         return self.uniq &gt; other.uniq</font>
<font color="black">  64. </font>
<font color="green">  65.     def __ge__(self, other):</font>
<font color="red">  66.         return self.uniq &gt;= other.uniq</font>
<font color="black">  67. </font>
<font color="green">  68.     def __hash__(self):</font>
<font color="green">  69.         return self.__hashedUniqTag</font>
<font color="black">  70. </font>
<font color="green">  71.     def __getitem__(self, idx):</font>
<font color="green">  72.         return self.__tag[idx]</font>
<font color="black">  73. </font>
<font color="green">  74.     def __and__(self, otherTag):</font>
<font color="red">  75.         (tagClass, tagFormat, tagId) = otherTag</font>
<font color="red">  76.         return self.__class__(</font>
<font color="red">  77.             self.__tag &amp; tagClass, self.__tag &amp; tagFormat, self.__tag &amp; tagId</font>
<font color="black">  78.         )</font>
<font color="black">  79. </font>
<font color="green">  80.     def __or__(self, otherTag):</font>
<font color="red">  81.         (tagClass, tagFormat, tagId) = otherTag</font>
<font color="red">  82.         return self.__class__(</font>
<font color="red">  83.             self.__tag[0] | tagClass,</font>
<font color="red">  84.             self.__tag[1] | tagFormat,</font>
<font color="red">  85.             self.__tag[2] | tagId</font>
<font color="black">  86.         )</font>
<font color="black">  87. </font>
<font color="green">  88.     def asTuple(self):</font>
<font color="red">  89.         return self.__tag  # __getitem__() is slow</font>
<font color="black">  90. </font>
<font color="black">  91. </font>
<font color="green">  92. class TagSet(object):</font>
<font color="green">  93.     def __init__(self, baseTag=(), *superTags):</font>
<font color="green">  94.         self.__baseTag = baseTag</font>
<font color="green">  95.         self.__superTags = superTags</font>
<font color="green">  96.         self.__hashedSuperTags = hash(superTags)</font>
<font color="green">  97.         _uniq = ()</font>
<font color="green">  98.         for t in superTags:</font>
<font color="green">  99.             _uniq = _uniq + t.uniq</font>
<font color="green"> 100.         self.uniq = _uniq</font>
<font color="green"> 101.         self.__lenOfSuperTags = len(superTags)</font>
<font color="black"> 102. </font>
<font color="green"> 103.     def __str__(self):</font>
<font color="red"> 104.         return self.__superTags and '+'.join([str(x) for x in self.__superTags]) or '[untagged]'</font>
<font color="black"> 105. </font>
<font color="green"> 106.     def __repr__(self):</font>
<font color="red"> 107.         return '%s(%s)' % (</font>
<font color="red"> 108.             self.__class__.__name__,</font>
<font color="red"> 109.             '(), ' + ', '.join([repr(x) for x in self.__superTags])</font>
<font color="black"> 110.         )</font>
<font color="black"> 111. </font>
<font color="green"> 112.     def __add__(self, superTag):</font>
<font color="green"> 113.         return self.__class__(</font>
<font color="green"> 114.             self.__baseTag, *self.__superTags + (superTag,)</font>
<font color="black"> 115.         )</font>
<font color="black"> 116. </font>
<font color="green"> 117.     def __radd__(self, superTag):</font>
<font color="red"> 118.         return self.__class__(</font>
<font color="red"> 119.             self.__baseTag, *(superTag,) + self.__superTags</font>
<font color="black"> 120.         )</font>
<font color="black"> 121. </font>
<font color="green"> 122.     def tagExplicitly(self, superTag):</font>
<font color="green"> 123.         tagClass, tagFormat, tagId = superTag</font>
<font color="green"> 124.         if tagClass == tagClassUniversal:</font>
<font color="red"> 125.             raise error.PyAsn1Error(</font>
<font color="red"> 126.                 'Can\'t tag with UNIVERSAL-class tag'</font>
<font color="black"> 127.             )</font>
<font color="green"> 128.         if tagFormat != tagFormatConstructed:</font>
<font color="green"> 129.             superTag = Tag(tagClass, tagFormatConstructed, tagId)</font>
<font color="green"> 130.         return self + superTag</font>
<font color="black"> 131. </font>
<font color="green"> 132.     def tagImplicitly(self, superTag):</font>
<font color="green"> 133.         tagClass, tagFormat, tagId = superTag</font>
<font color="green"> 134.         if self.__superTags:</font>
<font color="green"> 135.             superTag = Tag(tagClass, self.__superTags[-1][1], tagId)</font>
<font color="green"> 136.         return self[:-1] + superTag</font>
<font color="black"> 137. </font>
<font color="green"> 138.     def getBaseTag(self):</font>
<font color="red"> 139.         return self.__baseTag</font>
<font color="black"> 140. </font>
<font color="green"> 141.     def __getitem__(self, idx):</font>
<font color="green"> 142.         if isinstance(idx, slice):</font>
<font color="green"> 143.             return self.__class__(</font>
<font color="green"> 144.                 self.__baseTag, *getitem(self.__superTags, idx)</font>
<font color="black"> 145.             )</font>
<font color="red"> 146.         return self.__superTags[idx]</font>
<font color="black"> 147. </font>
<font color="green"> 148.     def __eq__(self, other):</font>
<font color="red"> 149.         return self.uniq == other.uniq</font>
<font color="black"> 150. </font>
<font color="green"> 151.     def __ne__(self, other):</font>
<font color="red"> 152.         return self.uniq != other.uniq</font>
<font color="black"> 153. </font>
<font color="green"> 154.     def __lt__(self, other):</font>
<font color="red"> 155.         return self.uniq &lt; other.uniq</font>
<font color="black"> 156. </font>
<font color="green"> 157.     def __le__(self, other):</font>
<font color="red"> 158.         return self.uniq &lt;= other.uniq</font>
<font color="black"> 159. </font>
<font color="green"> 160.     def __gt__(self, other):</font>
<font color="red"> 161.         return self.uniq &gt; other.uniq</font>
<font color="black"> 162. </font>
<font color="green"> 163.     def __ge__(self, other):</font>
<font color="red"> 164.         return self.uniq &gt;= other.uniq</font>
<font color="black"> 165. </font>
<font color="green"> 166.     def __hash__(self):</font>
<font color="green"> 167.         return self.__hashedSuperTags</font>
<font color="black"> 168. </font>
<font color="green"> 169.     def __len__(self):</font>
<font color="red"> 170.         return self.__lenOfSuperTags</font>
<font color="black"> 171. </font>
<font color="green"> 172.     def isSuperTagSetOf(self, tagSet):</font>
<font color="red"> 173.         if len(tagSet) &lt; self.__lenOfSuperTags:</font>
<font color="red"> 174.             return False</font>
<font color="red"> 175.         idx = self.__lenOfSuperTags - 1</font>
<font color="red"> 176.         while idx &gt;= 0:</font>
<font color="red"> 177.             if self.__superTags[idx] != tagSet[idx]:</font>
<font color="red"> 178.                 return</font>
<font color="red"> 179.             idx -= 1</font>
<font color="red"> 180.         return True</font>
<font color="black"> 181. </font>
<font color="black"> 182. </font>
<font color="green"> 183. def initTagSet(tag):</font>
<font color="green"> 184.     return TagSet(tag, tag)</font>
</pre>

