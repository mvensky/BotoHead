source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/docs/bcdoc/docstringparser.py</b><br>


file stats: <b>123 lines, 40 executed: 32.5% covered</b>
<pre>
<font color="black">   1. # Copyright 2012-2013 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. #     http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="green">  13. from botocore.compat import six</font>
<font color="black">  14. </font>
<font color="black">  15. </font>
<font color="green">  16. class DocStringParser(six.moves.html_parser.HTMLParser):</font>
<font color="black">  17.     &quot;&quot;&quot;</font>
<font color="black">  18.     A simple HTML parser.  Focused on converting the subset of HTML</font>
<font color="black">  19.     that appears in the documentation strings of the JSON models into</font>
<font color="black">  20.     simple ReST format.</font>
<font color="green">  21.     &quot;&quot;&quot;</font>
<font color="black">  22. </font>
<font color="green">  23.     def __init__(self, doc):</font>
<font color="red">  24.         self.tree = None</font>
<font color="red">  25.         self.doc = doc</font>
<font color="red">  26.         six.moves.html_parser.HTMLParser.__init__(self)</font>
<font color="black">  27. </font>
<font color="green">  28.     def reset(self):</font>
<font color="red">  29.         six.moves.html_parser.HTMLParser.reset(self)</font>
<font color="red">  30.         self.tree = HTMLTree(self.doc)</font>
<font color="black">  31. </font>
<font color="green">  32.     def feed(self, data):</font>
<font color="black">  33.         # HTMLParser is an old style class, so the super() method will not work.</font>
<font color="red">  34.         six.moves.html_parser.HTMLParser.feed(self, data)</font>
<font color="red">  35.         self.tree.write()</font>
<font color="red">  36.         self.tree = HTMLTree(self.doc)</font>
<font color="black">  37. </font>
<font color="green">  38.     def close(self):</font>
<font color="red">  39.         six.moves.html_parser.HTMLParser.close(self)</font>
<font color="black">  40.         # Write if there is anything remaining.</font>
<font color="red">  41.         self.tree.write()</font>
<font color="red">  42.         self.tree = HTMLTree(self.doc)</font>
<font color="black">  43. </font>
<font color="green">  44.     def handle_starttag(self, tag, attrs):</font>
<font color="red">  45.         self.tree.add_tag(tag, attrs=attrs)</font>
<font color="black">  46. </font>
<font color="green">  47.     def handle_endtag(self, tag):</font>
<font color="red">  48.         self.tree.add_tag(tag, is_start=False)</font>
<font color="black">  49. </font>
<font color="green">  50.     def handle_data(self, data):</font>
<font color="red">  51.         self.tree.add_data(data)</font>
<font color="black">  52. </font>
<font color="black">  53. </font>
<font color="green">  54. class HTMLTree(object):</font>
<font color="black">  55.     &quot;&quot;&quot;</font>
<font color="black">  56.     A tree which handles HTML nodes. Designed to work with a python HTML parser,</font>
<font color="black">  57.     meaning that the current_node will be the most recently opened tag. When</font>
<font color="black">  58.     a tag is closed, the current_node moves up to the parent node.</font>
<font color="green">  59.     &quot;&quot;&quot;</font>
<font color="green">  60.     def __init__(self, doc):</font>
<font color="red">  61.         self.doc = doc</font>
<font color="red">  62.         self.head = StemNode()</font>
<font color="red">  63.         self.current_node = self.head</font>
<font color="red">  64.         self.unhandled_tags = []</font>
<font color="black">  65. </font>
<font color="green">  66.     def add_tag(self, tag, attrs=None, is_start=True):</font>
<font color="red">  67.         if not self._doc_has_handler(tag, is_start):</font>
<font color="red">  68.             self.unhandled_tags.append(tag)</font>
<font color="red">  69.             return</font>
<font color="black">  70. </font>
<font color="red">  71.         if is_start:</font>
<font color="red">  72.             if tag == 'li':</font>
<font color="red">  73.                 node = LineItemNode(attrs)</font>
<font color="black">  74.             else:</font>
<font color="red">  75.                 node = TagNode(tag, attrs)</font>
<font color="red">  76.             self.current_node.add_child(node)</font>
<font color="red">  77.             self.current_node = node</font>
<font color="black">  78.         else:</font>
<font color="red">  79.             self.current_node = self.current_node.parent</font>
<font color="black">  80. </font>
<font color="green">  81.     def _doc_has_handler(self, tag, is_start):</font>
<font color="red">  82.         if is_start:</font>
<font color="red">  83.             handler_name = 'start_%s' % tag</font>
<font color="black">  84.         else:</font>
<font color="red">  85.             handler_name = 'end_%s' % tag</font>
<font color="black">  86. </font>
<font color="red">  87.         return hasattr(self.doc.style, handler_name)</font>
<font color="black">  88. </font>
<font color="green">  89.     def add_data(self, data):</font>
<font color="red">  90.         self.current_node.add_child(DataNode(data))</font>
<font color="black">  91. </font>
<font color="green">  92.     def write(self):</font>
<font color="red">  93.         self.head.write(self.doc)</font>
<font color="black">  94. </font>
<font color="black">  95. </font>
<font color="green">  96. class Node(object):</font>
<font color="green">  97.     def __init__(self, parent=None):</font>
<font color="red">  98.         self.parent = parent</font>
<font color="black">  99. </font>
<font color="green"> 100.     def write(self, doc):</font>
<font color="red"> 101.         raise NotImplementedError</font>
<font color="black"> 102. </font>
<font color="black"> 103. </font>
<font color="green"> 104. class StemNode(Node):</font>
<font color="green"> 105.     def __init__(self, parent=None):</font>
<font color="red"> 106.         super(StemNode, self).__init__(parent)</font>
<font color="red"> 107.         self.children = []</font>
<font color="black"> 108. </font>
<font color="green"> 109.     def add_child(self, child):</font>
<font color="red"> 110.         child.parent = self</font>
<font color="red"> 111.         self.children.append(child)</font>
<font color="black"> 112. </font>
<font color="green"> 113.     def write(self, doc):</font>
<font color="red"> 114.         self._write_children(doc)</font>
<font color="black"> 115. </font>
<font color="green"> 116.     def _write_children(self, doc):</font>
<font color="red"> 117.         for child in self.children:</font>
<font color="red"> 118.             child.write(doc)</font>
<font color="black"> 119. </font>
<font color="black"> 120. </font>
<font color="green"> 121. class TagNode(StemNode):</font>
<font color="black"> 122.     &quot;&quot;&quot;</font>
<font color="black"> 123.     A generic Tag node. It will verify that handlers exist before writing.</font>
<font color="green"> 124.     &quot;&quot;&quot;</font>
<font color="green"> 125.     def __init__(self, tag, attrs=None, parent=None):</font>
<font color="red"> 126.         super(TagNode, self).__init__(parent)</font>
<font color="red"> 127.         self.attrs = attrs</font>
<font color="red"> 128.         self.tag = tag</font>
<font color="black"> 129. </font>
<font color="green"> 130.     def write(self, doc):</font>
<font color="red"> 131.         self._write_start(doc)</font>
<font color="red"> 132.         self._write_children(doc)</font>
<font color="red"> 133.         self._write_end(doc)</font>
<font color="black"> 134. </font>
<font color="green"> 135.     def _write_start(self, doc):</font>
<font color="red"> 136.         handler_name = 'start_%s' % self.tag</font>
<font color="red"> 137.         if hasattr(doc.style, handler_name):</font>
<font color="red"> 138.             getattr(doc.style, handler_name)(self.attrs)</font>
<font color="black"> 139. </font>
<font color="green"> 140.     def _write_end(self, doc):</font>
<font color="red"> 141.         handler_name = 'end_%s' % self.tag</font>
<font color="red"> 142.         if hasattr(doc.style, handler_name):</font>
<font color="red"> 143.             getattr(doc.style, handler_name)()</font>
<font color="black"> 144. </font>
<font color="black"> 145. </font>
<font color="green"> 146. class LineItemNode(TagNode):</font>
<font color="green"> 147.     def __init__(self, attrs=None, parent=None):</font>
<font color="red"> 148.         super(LineItemNode, self).__init__('li', attrs, parent)</font>
<font color="black"> 149. </font>
<font color="green"> 150.     def write(self, doc):</font>
<font color="red"> 151.         self._lstrip(self)</font>
<font color="red"> 152.         super(LineItemNode, self).write(doc)</font>
<font color="black"> 153. </font>
<font color="green"> 154.     def _lstrip(self, node):</font>
<font color="black"> 155.         &quot;&quot;&quot;</font>
<font color="black"> 156.         Traverses the tree, stripping out whitespace until text data is found</font>
<font color="black"> 157.         :param node: The node to strip</font>
<font color="black"> 158.         :return: True if non-whitespace data was found, False otherwise</font>
<font color="black"> 159.         &quot;&quot;&quot;</font>
<font color="red"> 160.         for child in node.children:</font>
<font color="red"> 161.             if isinstance(child, DataNode):</font>
<font color="red"> 162.                 child.lstrip()</font>
<font color="red"> 163.                 if child.data:</font>
<font color="red"> 164.                     return True</font>
<font color="black"> 165.             else:</font>
<font color="red"> 166.                 found = self._lstrip(child)</font>
<font color="red"> 167.                 if found:</font>
<font color="red"> 168.                     return True</font>
<font color="black"> 169. </font>
<font color="red"> 170.         return False</font>
<font color="black"> 171. </font>
<font color="black"> 172. </font>
<font color="green"> 173. class DataNode(Node):</font>
<font color="black"> 174.     &quot;&quot;&quot;</font>
<font color="black"> 175.     A Node that contains only string data.</font>
<font color="green"> 176.     &quot;&quot;&quot;</font>
<font color="green"> 177.     def __init__(self, data, parent=None):</font>
<font color="red"> 178.         super(DataNode, self).__init__(parent)</font>
<font color="red"> 179.         if not isinstance(data, six.string_types):</font>
<font color="red"> 180.             raise ValueError(&quot;Expecting string type, %s given.&quot; % type(data))</font>
<font color="red"> 181.         self.data = data</font>
<font color="black"> 182. </font>
<font color="green"> 183.     def lstrip(self):</font>
<font color="red"> 184.         self.data = self.data.lstrip()</font>
<font color="black"> 185. </font>
<font color="green"> 186.     def write(self, doc):</font>
<font color="red"> 187.         if not self.data:</font>
<font color="red"> 188.             return</font>
<font color="black"> 189. </font>
<font color="red"> 190.         if self.data.isspace():</font>
<font color="red"> 191.             str_data = ' '</font>
<font color="black"> 192.         else:</font>
<font color="red"> 193.             end_space = self.data[-1].isspace()</font>
<font color="red"> 194.             words = self.data.split()</font>
<font color="red"> 195.             words = doc.translate_words(words)</font>
<font color="red"> 196.             str_data = ' '.join(words)</font>
<font color="red"> 197.             if end_space:</font>
<font color="red"> 198.                 str_data += ' '</font>
<font color="black"> 199. </font>
<font color="red"> 200.         doc.handle_data(str_data)</font>
</pre>

