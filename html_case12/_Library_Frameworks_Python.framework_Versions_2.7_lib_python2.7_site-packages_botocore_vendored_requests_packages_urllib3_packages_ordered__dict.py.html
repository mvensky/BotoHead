source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/vendored/requests/packages/urllib3/packages/ordered_dict.py</b><br>


file stats: <b>157 lines, 70 executed: 44.6% covered</b>
<pre>
<font color="black">   1. # Backport of OrderedDict() class that runs on Python 2.4, 2.5, 2.6, 2.7 and pypy.</font>
<font color="black">   2. # Passes Python2.7's test suite and incorporates all the latest updates.</font>
<font color="black">   3. # Copyright 2009 Raymond Hettinger, released under the MIT License.</font>
<font color="black">   4. # http://code.activestate.com/recipes/576693/</font>
<font color="green">   5. try:</font>
<font color="green">   6.     from thread import get_ident as _get_ident</font>
<font color="red">   7. except ImportError:</font>
<font color="red">   8.     from dummy_thread import get_ident as _get_ident</font>
<font color="black">   9. </font>
<font color="green">  10. try:</font>
<font color="green">  11.     from _abcoll import KeysView, ValuesView, ItemsView</font>
<font color="red">  12. except ImportError:</font>
<font color="red">  13.     pass</font>
<font color="black">  14. </font>
<font color="black">  15. </font>
<font color="green">  16. class OrderedDict(dict):</font>
<font color="green">  17.     'Dictionary that remembers insertion order'</font>
<font color="black">  18.     # An inherited dict maps keys to values.</font>
<font color="black">  19.     # The inherited dict provides __getitem__, __len__, __contains__, and get.</font>
<font color="black">  20.     # The remaining methods are order-aware.</font>
<font color="black">  21.     # Big-O running times for all methods are the same as for regular dictionaries.</font>
<font color="black">  22. </font>
<font color="black">  23.     # The internal self.__map dictionary maps keys to links in a doubly linked list.</font>
<font color="black">  24.     # The circular doubly linked list starts and ends with a sentinel element.</font>
<font color="black">  25.     # The sentinel element never gets deleted (this simplifies the algorithm).</font>
<font color="black">  26.     # Each link is stored as a list of length three:  [PREV, NEXT, KEY].</font>
<font color="black">  27. </font>
<font color="green">  28.     def __init__(self, *args, **kwds):</font>
<font color="black">  29.         '''Initialize an ordered dictionary.  Signature is the same as for</font>
<font color="black">  30.         regular dictionaries, but keyword arguments are not recommended</font>
<font color="black">  31.         because their insertion order is arbitrary.</font>
<font color="black">  32. </font>
<font color="black">  33.         '''</font>
<font color="green">  34.         if len(args) &gt; 1:</font>
<font color="red">  35.             raise TypeError('expected at most 1 arguments, got %d' % len(args))</font>
<font color="green">  36.         try:</font>
<font color="green">  37.             self.__root</font>
<font color="green">  38.         except AttributeError:</font>
<font color="green">  39.             self.__root = root = []                     # sentinel node</font>
<font color="green">  40.             root[:] = [root, root, None]</font>
<font color="green">  41.             self.__map = {}</font>
<font color="green">  42.         self.__update(*args, **kwds)</font>
<font color="black">  43. </font>
<font color="green">  44.     def __setitem__(self, key, value, dict_setitem=dict.__setitem__):</font>
<font color="black">  45.         'od.__setitem__(i, y) &lt;==&gt; od[i]=y'</font>
<font color="black">  46.         # Setting a new item creates a new link which goes at the end of the linked</font>
<font color="black">  47.         # list, and the inherited dictionary is updated with the new key/value pair.</font>
<font color="green">  48.         if key not in self:</font>
<font color="green">  49.             root = self.__root</font>
<font color="green">  50.             last = root[0]</font>
<font color="green">  51.             last[1] = root[0] = self.__map[key] = [last, root, key]</font>
<font color="green">  52.         dict_setitem(self, key, value)</font>
<font color="black">  53. </font>
<font color="green">  54.     def __delitem__(self, key, dict_delitem=dict.__delitem__):</font>
<font color="black">  55.         'od.__delitem__(y) &lt;==&gt; del od[y]'</font>
<font color="black">  56.         # Deleting an existing item uses self.__map to find the link which is</font>
<font color="black">  57.         # then removed by updating the links in the predecessor and successor nodes.</font>
<font color="green">  58.         dict_delitem(self, key)</font>
<font color="green">  59.         link_prev, link_next, key = self.__map.pop(key)</font>
<font color="green">  60.         link_prev[1] = link_next</font>
<font color="green">  61.         link_next[0] = link_prev</font>
<font color="black">  62. </font>
<font color="green">  63.     def __iter__(self):</font>
<font color="black">  64.         'od.__iter__() &lt;==&gt; iter(od)'</font>
<font color="green">  65.         root = self.__root</font>
<font color="green">  66.         curr = root[1]</font>
<font color="green">  67.         while curr is not root:</font>
<font color="green">  68.             yield curr[2]</font>
<font color="green">  69.             curr = curr[1]</font>
<font color="black">  70. </font>
<font color="green">  71.     def __reversed__(self):</font>
<font color="black">  72.         'od.__reversed__() &lt;==&gt; reversed(od)'</font>
<font color="red">  73.         root = self.__root</font>
<font color="red">  74.         curr = root[0]</font>
<font color="red">  75.         while curr is not root:</font>
<font color="red">  76.             yield curr[2]</font>
<font color="red">  77.             curr = curr[0]</font>
<font color="black">  78. </font>
<font color="green">  79.     def clear(self):</font>
<font color="black">  80.         'od.clear() -&gt; None.  Remove all items from od.'</font>
<font color="red">  81.         try:</font>
<font color="red">  82.             for node in self.__map.itervalues():</font>
<font color="red">  83.                 del node[:]</font>
<font color="red">  84.             root = self.__root</font>
<font color="red">  85.             root[:] = [root, root, None]</font>
<font color="red">  86.             self.__map.clear()</font>
<font color="red">  87.         except AttributeError:</font>
<font color="red">  88.             pass</font>
<font color="red">  89.         dict.clear(self)</font>
<font color="black">  90. </font>
<font color="green">  91.     def popitem(self, last=True):</font>
<font color="black">  92.         '''od.popitem() -&gt; (k, v), return and remove a (key, value) pair.</font>
<font color="black">  93.         Pairs are returned in LIFO order if last is true or FIFO order if false.</font>
<font color="black">  94. </font>
<font color="black">  95.         '''</font>
<font color="red">  96.         if not self:</font>
<font color="red">  97.             raise KeyError('dictionary is empty')</font>
<font color="red">  98.         root = self.__root</font>
<font color="red">  99.         if last:</font>
<font color="red"> 100.             link = root[0]</font>
<font color="red"> 101.             link_prev = link[0]</font>
<font color="red"> 102.             link_prev[1] = root</font>
<font color="red"> 103.             root[0] = link_prev</font>
<font color="black"> 104.         else:</font>
<font color="red"> 105.             link = root[1]</font>
<font color="red"> 106.             link_next = link[1]</font>
<font color="red"> 107.             root[1] = link_next</font>
<font color="red"> 108.             link_next[0] = root</font>
<font color="red"> 109.         key = link[2]</font>
<font color="red"> 110.         del self.__map[key]</font>
<font color="red"> 111.         value = dict.pop(self, key)</font>
<font color="red"> 112.         return key, value</font>
<font color="black"> 113. </font>
<font color="black"> 114.     # -- the following methods do not depend on the internal structure --</font>
<font color="black"> 115. </font>
<font color="green"> 116.     def keys(self):</font>
<font color="black"> 117.         'od.keys() -&gt; list of keys in od'</font>
<font color="red"> 118.         return list(self)</font>
<font color="black"> 119. </font>
<font color="green"> 120.     def values(self):</font>
<font color="black"> 121.         'od.values() -&gt; list of values in od'</font>
<font color="red"> 122.         return [self[key] for key in self]</font>
<font color="black"> 123. </font>
<font color="green"> 124.     def items(self):</font>
<font color="black"> 125.         'od.items() -&gt; list of (key, value) pairs in od'</font>
<font color="green"> 126.         return [(key, self[key]) for key in self]</font>
<font color="black"> 127. </font>
<font color="green"> 128.     def iterkeys(self):</font>
<font color="black"> 129.         'od.iterkeys() -&gt; an iterator over the keys in od'</font>
<font color="red"> 130.         return iter(self)</font>
<font color="black"> 131. </font>
<font color="green"> 132.     def itervalues(self):</font>
<font color="black"> 133.         'od.itervalues -&gt; an iterator over the values in od'</font>
<font color="red"> 134.         for k in self:</font>
<font color="red"> 135.             yield self[k]</font>
<font color="black"> 136. </font>
<font color="green"> 137.     def iteritems(self):</font>
<font color="black"> 138.         'od.iteritems -&gt; an iterator over the (key, value) items in od'</font>
<font color="red"> 139.         for k in self:</font>
<font color="red"> 140.             yield (k, self[k])</font>
<font color="black"> 141. </font>
<font color="green"> 142.     def update(*args, **kwds):</font>
<font color="black"> 143.         '''od.update(E, **F) -&gt; None.  Update od from dict/iterable E and F.</font>
<font color="black"> 144. </font>
<font color="black"> 145.         If E is a dict instance, does:           for k in E: od[k] = E[k]</font>
<font color="black"> 146.         If E has a .keys() method, does:         for k in E.keys(): od[k] = E[k]</font>
<font color="black"> 147.         Or if E is an iterable of items, does:   for k, v in E: od[k] = v</font>
<font color="black"> 148.         In either case, this is followed by:     for k, v in F.items(): od[k] = v</font>
<font color="black"> 149. </font>
<font color="black"> 150.         '''</font>
<font color="green"> 151.         if len(args) &gt; 2:</font>
<font color="red"> 152.             raise TypeError('update() takes at most 2 positional '</font>
<font color="red"> 153.                             'arguments (%d given)' % (len(args),))</font>
<font color="green"> 154.         elif not args:</font>
<font color="red"> 155.             raise TypeError('update() takes at least 1 argument (0 given)')</font>
<font color="green"> 156.         self = args[0]</font>
<font color="black"> 157.         # Make progressively weaker assumptions about &quot;other&quot;</font>
<font color="green"> 158.         other = ()</font>
<font color="green"> 159.         if len(args) == 2:</font>
<font color="red"> 160.             other = args[1]</font>
<font color="green"> 161.         if isinstance(other, dict):</font>
<font color="red"> 162.             for key in other:</font>
<font color="red"> 163.                 self[key] = other[key]</font>
<font color="green"> 164.         elif hasattr(other, 'keys'):</font>
<font color="red"> 165.             for key in other.keys():</font>
<font color="red"> 166.                 self[key] = other[key]</font>
<font color="black"> 167.         else:</font>
<font color="green"> 168.             for key, value in other:</font>
<font color="red"> 169.                 self[key] = value</font>
<font color="green"> 170.         for key, value in kwds.items():</font>
<font color="red"> 171.             self[key] = value</font>
<font color="black"> 172. </font>
<font color="green"> 173.     __update = update  # let subclasses override update without breaking __init__</font>
<font color="black"> 174. </font>
<font color="green"> 175.     __marker = object()</font>
<font color="black"> 176. </font>
<font color="green"> 177.     def pop(self, key, default=__marker):</font>
<font color="black"> 178.         '''od.pop(k[,d]) -&gt; v, remove specified key and return the corresponding value.</font>
<font color="black"> 179.         If key is not found, d is returned if given, otherwise KeyError is raised.</font>
<font color="black"> 180. </font>
<font color="black"> 181.         '''</font>
<font color="green"> 182.         if key in self:</font>
<font color="green"> 183.             result = self[key]</font>
<font color="green"> 184.             del self[key]</font>
<font color="green"> 185.             return result</font>
<font color="red"> 186.         if default is self.__marker:</font>
<font color="red"> 187.             raise KeyError(key)</font>
<font color="red"> 188.         return default</font>
<font color="black"> 189. </font>
<font color="green"> 190.     def setdefault(self, key, default=None):</font>
<font color="black"> 191.         'od.setdefault(k[,d]) -&gt; od.get(k,d), also set od[k]=d if k not in od'</font>
<font color="red"> 192.         if key in self:</font>
<font color="red"> 193.             return self[key]</font>
<font color="red"> 194.         self[key] = default</font>
<font color="red"> 195.         return default</font>
<font color="black"> 196. </font>
<font color="green"> 197.     def __repr__(self, _repr_running={}):</font>
<font color="black"> 198.         'od.__repr__() &lt;==&gt; repr(od)'</font>
<font color="red"> 199.         call_key = id(self), _get_ident()</font>
<font color="red"> 200.         if call_key in _repr_running:</font>
<font color="red"> 201.             return '...'</font>
<font color="red"> 202.         _repr_running[call_key] = 1</font>
<font color="red"> 203.         try:</font>
<font color="red"> 204.             if not self:</font>
<font color="red"> 205.                 return '%s()' % (self.__class__.__name__,)</font>
<font color="red"> 206.             return '%s(%r)' % (self.__class__.__name__, self.items())</font>
<font color="black"> 207.         finally:</font>
<font color="red"> 208.             del _repr_running[call_key]</font>
<font color="black"> 209. </font>
<font color="green"> 210.     def __reduce__(self):</font>
<font color="black"> 211.         'Return state information for pickling'</font>
<font color="red"> 212.         items = [[k, self[k]] for k in self]</font>
<font color="red"> 213.         inst_dict = vars(self).copy()</font>
<font color="red"> 214.         for k in vars(OrderedDict()):</font>
<font color="red"> 215.             inst_dict.pop(k, None)</font>
<font color="red"> 216.         if inst_dict:</font>
<font color="red"> 217.             return (self.__class__, (items,), inst_dict)</font>
<font color="red"> 218.         return self.__class__, (items,)</font>
<font color="black"> 219. </font>
<font color="green"> 220.     def copy(self):</font>
<font color="black"> 221.         'od.copy() -&gt; a shallow copy of od'</font>
<font color="red"> 222.         return self.__class__(self)</font>
<font color="black"> 223. </font>
<font color="green"> 224.     @classmethod</font>
<font color="green"> 225.     def fromkeys(cls, iterable, value=None):</font>
<font color="black"> 226.         '''OD.fromkeys(S[, v]) -&gt; New ordered dictionary with keys from S</font>
<font color="black"> 227.         and values equal to v (which defaults to None).</font>
<font color="black"> 228. </font>
<font color="black"> 229.         '''</font>
<font color="red"> 230.         d = cls()</font>
<font color="red"> 231.         for key in iterable:</font>
<font color="red"> 232.             d[key] = value</font>
<font color="red"> 233.         return d</font>
<font color="black"> 234. </font>
<font color="green"> 235.     def __eq__(self, other):</font>
<font color="black"> 236.         '''od.__eq__(y) &lt;==&gt; od==y.  Comparison to another OD is order-sensitive</font>
<font color="black"> 237.         while comparison to a regular mapping is order-insensitive.</font>
<font color="black"> 238. </font>
<font color="black"> 239.         '''</font>
<font color="red"> 240.         if isinstance(other, OrderedDict):</font>
<font color="red"> 241.             return len(self)==len(other) and self.items() == other.items()</font>
<font color="red"> 242.         return dict.__eq__(self, other)</font>
<font color="black"> 243. </font>
<font color="green"> 244.     def __ne__(self, other):</font>
<font color="red"> 245.         return not self == other</font>
<font color="black"> 246. </font>
<font color="black"> 247.     # -- the following methods are only used in Python 2.7 --</font>
<font color="black"> 248. </font>
<font color="green"> 249.     def viewkeys(self):</font>
<font color="black"> 250.         &quot;od.viewkeys() -&gt; a set-like object providing a view on od's keys&quot;</font>
<font color="red"> 251.         return KeysView(self)</font>
<font color="black"> 252. </font>
<font color="green"> 253.     def viewvalues(self):</font>
<font color="black"> 254.         &quot;od.viewvalues() -&gt; an object providing a view on od's values&quot;</font>
<font color="red"> 255.         return ValuesView(self)</font>
<font color="black"> 256. </font>
<font color="green"> 257.     def viewitems(self):</font>
<font color="black"> 258.         &quot;od.viewitems() -&gt; a set-like object providing a view on od's items&quot;</font>
<font color="red"> 259.         return ItemsView(self)</font>
</pre>

