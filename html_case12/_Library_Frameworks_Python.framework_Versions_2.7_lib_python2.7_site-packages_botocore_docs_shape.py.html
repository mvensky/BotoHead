source file: <b>/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/botocore/docs/shape.py</b><br>


file stats: <b>64 lines, 9 executed: 14.1% covered</b>
<pre>
<font color="black">   1. # Copyright 2015 Amazon.com, Inc. or its affiliates. All Rights Reserved.</font>
<font color="black">   2. #</font>
<font color="black">   3. # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;). You</font>
<font color="black">   4. # may not use this file except in compliance with the License. A copy of</font>
<font color="black">   5. # the License is located at</font>
<font color="black">   6. #</font>
<font color="black">   7. # http://aws.amazon.com/apache2.0/</font>
<font color="black">   8. #</font>
<font color="black">   9. # or in the &quot;license&quot; file accompanying this file. This file is</font>
<font color="black">  10. # distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF</font>
<font color="black">  11. # ANY KIND, either express or implied. See the License for the specific</font>
<font color="black">  12. # language governing permissions and limitations under the License.</font>
<font color="black">  13. </font>
<font color="black">  14. </font>
<font color="black">  15. # NOTE: This class should not be instantiated and its</font>
<font color="black">  16. # ``traverse_and_document_shape`` method called directly. It should be</font>
<font color="black">  17. # inherited from a Documenter class with the appropriate methods</font>
<font color="black">  18. # and attributes.</font>
<font color="green">  19. from botocore.utils import is_json_value_header</font>
<font color="black">  20. </font>
<font color="black">  21. </font>
<font color="green">  22. class ShapeDocumenter(object):</font>
<font color="green">  23.     EVENT_NAME = ''</font>
<font color="black">  24. </font>
<font color="black">  25.     def __init__(self, service_name, operation_name, event_emitter,</font>
<font color="green">  26.                  context=None):</font>
<font color="red">  27.         self._service_name = service_name</font>
<font color="red">  28.         self._operation_name = operation_name</font>
<font color="red">  29.         self._event_emitter = event_emitter</font>
<font color="red">  30.         self._context = context</font>
<font color="red">  31.         if context is None:</font>
<font color="red">  32.             self._context = {</font>
<font color="red">  33.                 'special_shape_types': {}</font>
<font color="black">  34.             }</font>
<font color="black">  35. </font>
<font color="black">  36.     def traverse_and_document_shape(self, section, shape, history,</font>
<font color="green">  37.                                     include=None, exclude=None, name=None,</font>
<font color="green">  38.                                     is_required=False):</font>
<font color="black">  39.         &quot;&quot;&quot;Traverses and documents a shape</font>
<font color="black">  40. </font>
<font color="black">  41.         Will take a self class and call its appropriate methods as a shape</font>
<font color="black">  42.         is traversed.</font>
<font color="black">  43. </font>
<font color="black">  44.         :param section: The section to document.</font>
<font color="black">  45. </font>
<font color="black">  46.         :param history: A list of the names of the shapes that have been</font>
<font color="black">  47.             traversed.</font>
<font color="black">  48. </font>
<font color="black">  49.         :type include: Dictionary where keys are parameter names and</font>
<font color="black">  50.             values are the shapes of the parameter names.</font>
<font color="black">  51.         :param include: The parameter shapes to include in the documentation.</font>
<font color="black">  52. </font>
<font color="black">  53.         :type exclude: List of the names of the parameters to exclude.</font>
<font color="black">  54.         :param exclude: The names of the parameters to exclude from</font>
<font color="black">  55.             documentation.</font>
<font color="black">  56. </font>
<font color="black">  57.         :param name: The name of the shape.</font>
<font color="black">  58. </font>
<font color="black">  59.         :param is_required: If the shape is a required member.</font>
<font color="black">  60.         &quot;&quot;&quot;</font>
<font color="red">  61.         param_type = shape.type_name</font>
<font color="red">  62.         if getattr(shape, 'serialization', {}).get('eventstream'):</font>
<font color="red">  63.             param_type = 'event_stream'</font>
<font color="red">  64.         if shape.name in history:</font>
<font color="red">  65.             self.document_recursive_shape(section, shape, name=name)</font>
<font color="black">  66.         else:</font>
<font color="red">  67.             history.append(shape.name)</font>
<font color="red">  68.             is_top_level_param = (len(history) == 2)</font>
<font color="red">  69.             getattr(self, 'document_shape_type_%s' % param_type,</font>
<font color="red">  70.                     self.document_shape_default)(</font>
<font color="red">  71.                         section, shape, history=history, name=name,</font>
<font color="red">  72.                         include=include, exclude=exclude,</font>
<font color="red">  73.                         is_top_level_param=is_top_level_param,</font>
<font color="red">  74.                         is_required=is_required)</font>
<font color="red">  75.             if is_top_level_param:</font>
<font color="red">  76.                 self._event_emitter.emit(</font>
<font color="red">  77.                     'docs.%s.%s.%s.%s' % (self.EVENT_NAME,</font>
<font color="red">  78.                                           self._service_name,</font>
<font color="red">  79.                                           self._operation_name,</font>
<font color="red">  80.                                           name),</font>
<font color="red">  81.                     section=section)</font>
<font color="red">  82.             at_overlying_method_section = (len(history) == 1)</font>
<font color="red">  83.             if at_overlying_method_section:</font>
<font color="red">  84.                 self._event_emitter.emit(</font>
<font color="red">  85.                     'docs.%s.%s.%s.complete-section' % (self.EVENT_NAME,</font>
<font color="red">  86.                                                         self._service_name,</font>
<font color="red">  87.                                                         self._operation_name),</font>
<font color="red">  88.                     section=section)</font>
<font color="red">  89.             history.pop()</font>
<font color="black">  90. </font>
<font color="green">  91.     def _get_special_py_default(self, shape):</font>
<font color="red">  92.         special_defaults = {</font>
<font color="red">  93.             'jsonvalue_header': '{...}|[...]|123|123.4|\'string\'|True|None',</font>
<font color="red">  94.             'streaming_input_shape': 'b\'bytes\'|file',</font>
<font color="red">  95.             'streaming_output_shape': 'StreamingBody()',</font>
<font color="red">  96.             'eventstream_output_shape': 'EventStream()',</font>
<font color="black">  97.         }</font>
<font color="red">  98.         return self._get_value_for_special_type(shape, special_defaults)</font>
<font color="black">  99. </font>
<font color="green"> 100.     def _get_special_py_type_name(self, shape):</font>
<font color="red"> 101.         special_type_names = {</font>
<font color="red"> 102.             'jsonvalue_header': 'JSON serializable',</font>
<font color="red"> 103.             'streaming_input_shape': 'bytes or seekable file-like object',</font>
<font color="red"> 104.             'streaming_output_shape': ':class:`.StreamingBody`',</font>
<font color="red"> 105.             'eventstream_output_shape': ':class:`.EventStream`',</font>
<font color="black"> 106.         }</font>
<font color="red"> 107.         return self._get_value_for_special_type(shape, special_type_names)</font>
<font color="black"> 108. </font>
<font color="green"> 109.     def _get_value_for_special_type(self, shape, special_type_map):</font>
<font color="red"> 110.         if is_json_value_header(shape):</font>
<font color="red"> 111.             return special_type_map['jsonvalue_header']</font>
<font color="red"> 112.         for special_type, marked_shape in self._context[</font>
<font color="red"> 113.                 'special_shape_types'].items():</font>
<font color="red"> 114.             if special_type in special_type_map:</font>
<font color="red"> 115.                 if shape == marked_shape:</font>
<font color="red"> 116.                     return special_type_map[special_type]</font>
<font color="red"> 117.         return None</font>
</pre>

